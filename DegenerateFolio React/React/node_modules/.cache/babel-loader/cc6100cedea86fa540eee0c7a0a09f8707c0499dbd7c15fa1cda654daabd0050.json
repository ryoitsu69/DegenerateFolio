{"ast":null,"code":"import { LoaderParserPriority } from '../../../assets/loader/parsers/LoaderParser.mjs';\nimport { copySearchParams } from '../../../assets/utils/copySearchParams.mjs';\nimport { DOMAdapter } from '../../../environment/adapter.mjs';\nimport { ExtensionType } from '../../../extensions/Extensions.mjs';\nimport { path } from '../../../utils/path.mjs';\nimport { BitmapFont } from '../BitmapFont.mjs';\nimport { bitmapFontTextParser } from './bitmapFontTextParser.mjs';\nimport { bitmapFontXMLStringParser } from './bitmapFontXMLStringParser.mjs';\n\"use strict\";\nconst validExtensions = [\".xml\", \".fnt\"];\nconst bitmapFontCachePlugin = {\n  extension: ExtensionType.CacheParser,\n  test: asset => asset instanceof BitmapFont,\n  getCacheableAssets(keys, asset) {\n    const out = {};\n    keys.forEach(key => {\n      out[key] = asset;\n    });\n    out[`${asset.fontFamily}-bitmap`] = asset;\n    return out;\n  }\n};\nconst loadBitmapFont = {\n  extension: {\n    type: ExtensionType.LoadParser,\n    priority: LoaderParserPriority.Normal\n  },\n  test(url) {\n    return validExtensions.includes(path.extname(url).toLowerCase());\n  },\n  async testParse(data) {\n    return bitmapFontTextParser.test(data) || bitmapFontXMLStringParser.test(data);\n  },\n  async parse(asset, data, loader) {\n    const bitmapFontData = bitmapFontTextParser.test(asset) ? bitmapFontTextParser.parse(asset) : bitmapFontXMLStringParser.parse(asset);\n    const {\n      src\n    } = data;\n    const {\n      pages\n    } = bitmapFontData;\n    const textureUrls = [];\n    for (let i = 0; i < pages.length; ++i) {\n      const pageFile = pages[i].file;\n      let imagePath = path.join(path.dirname(src), pageFile);\n      imagePath = copySearchParams(imagePath, src);\n      textureUrls.push(imagePath);\n    }\n    const loadedTextures = await loader.load(textureUrls);\n    const textures = textureUrls.map(url => loadedTextures[url]);\n    const bitmapFont = new BitmapFont({\n      data: bitmapFontData,\n      textures\n    }, src);\n    return bitmapFont;\n  },\n  async load(url, _options) {\n    const response = await DOMAdapter.get().fetch(url);\n    return await response.text();\n  },\n  async unload(bitmapFont, _resolvedAsset, loader) {\n    await Promise.all(bitmapFont.pages.map(page => loader.unload(page.texture.source._sourceOrigin)));\n    bitmapFont.destroy();\n  }\n};\nexport { bitmapFontCachePlugin, loadBitmapFont };","map":{"version":3,"names":["validExtensions","bitmapFontCachePlugin","extension","ExtensionType","CacheParser","test","asset","BitmapFont","getCacheableAssets","keys","out","forEach","key","fontFamily","loadBitmapFont","type","LoadParser","priority","LoaderParserPriority","Normal","url","includes","path","extname","toLowerCase","testParse","data","bitmapFontTextParser","bitmapFontXMLStringParser","parse","loader","bitmapFontData","src","pages","textureUrls","i","length","pageFile","file","imagePath","join","dirname","copySearchParams","push","loadedTextures","load","textures","map","bitmapFont","_options","response","DOMAdapter","get","fetch","text","unload","_resolvedAsset","Promise","all","page","texture","source","_sourceOrigin","destroy"],"sources":["/home/ryoitsu/node_modules/pixi.js/src/scene/text-bitmap/asset/loadBitmapFont.ts"],"sourcesContent":["import { LoaderParserPriority } from '../../../assets/loader/parsers/LoaderParser';\nimport { copySearchParams } from '../../../assets/utils/copySearchParams';\nimport { DOMAdapter } from '../../../environment/adapter';\nimport { ExtensionType } from '../../../extensions/Extensions';\nimport { path } from '../../../utils/path';\nimport { BitmapFont } from '../BitmapFont';\nimport { bitmapFontTextParser } from './bitmapFontTextParser';\nimport { bitmapFontXMLStringParser } from './bitmapFontXMLStringParser';\n\nimport type { Loader } from '../../../assets/loader/Loader';\nimport type { LoaderParser } from '../../../assets/loader/parsers/LoaderParser';\nimport type { ResolvedAsset } from '../../../assets/types';\nimport type { Texture } from '../../../rendering/renderers/shared/texture/Texture';\n\nconst validExtensions = ['.xml', '.fnt'];\n\n/** simple loader plugin for loading in bitmap fonts! */\nexport const bitmapFontCachePlugin = {\n    extension: ExtensionType.CacheParser,\n    test: (asset: BitmapFont) => asset instanceof BitmapFont,\n    getCacheableAssets(keys: string[], asset: BitmapFont)\n    {\n        const out: Record<string, BitmapFont> = {};\n\n        keys.forEach((key) =>\n        {\n            out[key] = asset;\n        });\n\n        out[`${asset.fontFamily}-bitmap`] = asset;\n\n        return out;\n    }\n};\n\nexport const loadBitmapFont = {\n    extension: {\n        type: ExtensionType.LoadParser,\n        priority: LoaderParserPriority.Normal,\n    },\n\n    test(url: string): boolean\n    {\n        return validExtensions.includes(path.extname(url).toLowerCase());\n    },\n\n    async testParse(data: string): Promise<boolean>\n    {\n        return bitmapFontTextParser.test(data) || bitmapFontXMLStringParser.test(data);\n    },\n\n    async parse(asset: string, data: ResolvedAsset, loader: Loader): Promise<BitmapFont>\n    {\n        const bitmapFontData = bitmapFontTextParser.test(asset)\n            ? bitmapFontTextParser.parse(asset)\n            : bitmapFontXMLStringParser.parse(asset);\n\n        const { src } = data;\n        const { pages } = bitmapFontData;\n        const textureUrls = [];\n\n        for (let i = 0; i < pages.length; ++i)\n        {\n            const pageFile = pages[i].file;\n            let imagePath = path.join(path.dirname(src), pageFile);\n\n            imagePath = copySearchParams(imagePath, src);\n\n            textureUrls.push(imagePath);\n        }\n\n        const loadedTextures = await loader.load<Texture>(textureUrls);\n        const textures = textureUrls.map((url) => loadedTextures[url]);\n\n        const bitmapFont = new BitmapFont({\n            data: bitmapFontData,\n            textures\n        }, src);\n\n        return bitmapFont;\n    },\n\n    async load(url: string, _options: ResolvedAsset): Promise<string>\n    {\n        const response = await DOMAdapter.get().fetch(url);\n\n        return await response.text();\n    },\n\n    async unload(bitmapFont: BitmapFont, _resolvedAsset, loader): Promise<void>\n    {\n        await Promise.all(bitmapFont.pages.map((page) => loader.unload(page.texture.source._sourceOrigin)));\n\n        bitmapFont.destroy();\n    }\n} as LoaderParser;\n"],"mappings":";;;;;;;;;AAcA,MAAMA,eAAA,GAAkB,CAAC,QAAQ,MAAM;AAGhC,MAAMC,qBAAwB;EACjCC,SAAA,EAAWC,aAAc,CAAAC,WAAA;EACzBC,IAAA,EAAOC,KAAA,IAAsBA,KAAiB,YAAAC,UAAA;EAC9CC,mBAAmBC,IAAA,EAAgBH,KACnC;IACI,MAAMI,GAAA,GAAkC,EAAC;IAEpCD,IAAA,CAAAE,OAAA,CAASC,GACd;MACIF,GAAA,CAAIE,GAAG,CAAI,GAAAN,KAAA;IAAA,CACd;IAEDI,GAAA,CAAO,GAAAJ,KAAA,CAAMO,UAAU,SAAS,CAAI,GAAAP,KAAA;IAE7B,OAAAI,GAAA;EAAA;AAEf;AAEO,MAAMI,cAAiB;EAC1BZ,SAAW;IACPa,IAAA,EAAMZ,aAAc,CAAAa,UAAA;IACpBC,QAAA,EAAUC,oBAAqB,CAAAC;EAAA,CACnC;EAEAd,KAAKe,GACL;IACI,OAAOpB,eAAA,CAAgBqB,QAAS,CAAAC,IAAA,CAAKC,OAAA,CAAQH,GAAG,EAAEI,WAAA,EAAa;EAAA,CACnE;EAEA,MAAMC,UAAUC,IAChB;IACI,OAAOC,oBAAA,CAAqBtB,IAAK,CAAAqB,IAAI,CAAK,IAAAE,yBAAA,CAA0BvB,IAAA,CAAKqB,IAAI;EAAA,CACjF;EAEA,MAAMG,MAAMvB,KAAe,EAAAoB,IAAA,EAAqBI,MAChD;IACU,MAAAC,cAAA,GAAiBJ,oBAAqB,CAAAtB,IAAA,CAAKC,KAAK,IAChDqB,oBAAqB,CAAAE,KAAA,CAAMvB,KAAK,IAChCsB,yBAA0B,CAAAC,KAAA,CAAMvB,KAAK;IAErC;MAAE0B;IAAA,CAAQ,GAAAN,IAAA;IACV;MAAEO;IAAA,CAAU,GAAAF,cAAA;IAClB,MAAMG,WAAA,GAAc,EAAC;IAErB,SAASC,CAAA,GAAI,CAAG,EAAAA,CAAA,GAAIF,KAAM,CAAAG,MAAA,EAAQ,EAAED,CACpC;MACU,MAAAE,QAAA,GAAWJ,KAAM,CAAAE,CAAC,CAAE,CAAAG,IAAA;MAC1B,IAAIC,SAAA,GAAYjB,IAAK,CAAAkB,IAAA,CAAKlB,IAAA,CAAKmB,OAAQ,CAAAT,GAAG,GAAGK,QAAQ;MAEzCE,SAAA,GAAAG,gBAAA,CAAiBH,SAAA,EAAWP,GAAG;MAE3CE,WAAA,CAAYS,IAAA,CAAKJ,SAAS;IAAA;IAG9B,MAAMK,cAAiB,SAAMd,MAAO,CAAAe,IAAA,CAAcX,WAAW;IAC7D,MAAMY,QAAA,GAAWZ,WAAY,CAAAa,GAAA,CAAK3B,GAAQ,IAAAwB,cAAA,CAAexB,GAAG,CAAC;IAEvD,MAAA4B,UAAA,GAAa,IAAIzC,UAAW;MAC9BmB,IAAM,EAAAK,cAAA;MACNe;IAAA,GACDd,GAAG;IAEC,OAAAgB,UAAA;EAAA,CACX;EAEA,MAAMH,IAAKA,CAAAzB,GAAA,EAAa6B,QACxB;IACI,MAAMC,QAAA,GAAW,MAAMC,UAAA,CAAWC,GAAI,GAAEC,KAAA,CAAMjC,GAAG;IAE1C,aAAM8B,QAAA,CAASI,IAAK;EAAA,CAC/B;EAEA,MAAMC,OAAOP,UAAwB,EAAAQ,cAAA,EAAgB1B,MACrD;IACI,MAAM2B,OAAQ,CAAAC,GAAA,CAAIV,UAAW,CAAAf,KAAA,CAAMc,GAAA,CAAKY,IAAA,IAAS7B,MAAO,CAAAyB,MAAA,CAAOI,IAAK,CAAAC,OAAA,CAAQC,MAAO,CAAAC,aAAa,CAAC,CAAC;IAElGd,UAAA,CAAWe,OAAQ;EAAA;AAE3B","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}