{"ast":null,"code":"import { BehaviorSubject, combineLatest, map, of, switchMap, tap, toArray } from 'rxjs';\nimport { arrayChunk, arrayFlatten, nextTick } from '@polkadot/util';\nimport { memo } from '../util/index.js';\nconst ERA_CHUNK_SIZE = 14;\nfunction chunkEras(eras, fn) {\n  const chunked = arrayChunk(eras, ERA_CHUNK_SIZE);\n  let index = 0;\n  const subject = new BehaviorSubject(chunked[index]);\n  return subject.pipe(switchMap(fn), tap(() => {\n    nextTick(() => {\n      index++;\n      index === chunked.length ? subject.complete() : subject.next(chunked[index]);\n    });\n  }), toArray(), map(arrayFlatten));\n}\nexport function filterEras(eras, list) {\n  return eras.filter(e => !list.some(({\n    era\n  }) => e.eq(era)));\n}\nexport function erasHistoricApply(fn) {\n  return (instanceId, api) =>\n  // Cannot quite get the typing right, but it is right in the code\n  // eslint-disable-next-line @typescript-eslint/no-unsafe-return\n  memo(instanceId, (withActive = false) => api.derive.staking.erasHistoric(withActive).pipe(switchMap(e => api.derive.staking[fn](e, withActive))));\n}\nexport function erasHistoricApplyAccount(fn) {\n  return (instanceId, api) =>\n  // Cannot quite get the typing right, but it is right in the code\n  // eslint-disable-next-line @typescript-eslint/no-unsafe-return\n  memo(instanceId, (accountId, withActive = false) => api.derive.staking.erasHistoric(withActive).pipe(switchMap(e => api.derive.staking[fn](accountId, e, withActive))));\n}\nexport function singleEra(fn) {\n  return (instanceId, api) =>\n  // Cannot quite get the typing right, but it is right in the code\n  // eslint-disable-next-line @typescript-eslint/no-unsafe-return\n  memo(instanceId, era => api.derive.staking[fn](era, true));\n}\nexport function combineEras(fn) {\n  return (instanceId, api) =>\n  // Cannot quite get the typing right, but it is right in the code\n  // eslint-disable-next-line @typescript-eslint/no-unsafe-return\n  memo(instanceId, (eras, withActive) => !eras.length ? of([]) : chunkEras(eras, eras => combineLatest(eras.map(e => api.derive.staking[fn](e, withActive)))));\n}","map":{"version":3,"names":["BehaviorSubject","combineLatest","map","of","switchMap","tap","toArray","arrayChunk","arrayFlatten","nextTick","memo","ERA_CHUNK_SIZE","chunkEras","eras","fn","chunked","index","subject","pipe","length","complete","next","filterEras","list","filter","e","some","era","eq","erasHistoricApply","instanceId","api","withActive","derive","staking","erasHistoric","erasHistoricApplyAccount","accountId","singleEra","combineEras"],"sources":["/home/ryoitsu/Documents/test/react-todo-app/node_modules/@polkadot/api-derive/staking/util.js"],"sourcesContent":["import { BehaviorSubject, combineLatest, map, of, switchMap, tap, toArray } from 'rxjs';\nimport { arrayChunk, arrayFlatten, nextTick } from '@polkadot/util';\nimport { memo } from '../util/index.js';\nconst ERA_CHUNK_SIZE = 14;\nfunction chunkEras(eras, fn) {\n    const chunked = arrayChunk(eras, ERA_CHUNK_SIZE);\n    let index = 0;\n    const subject = new BehaviorSubject(chunked[index]);\n    return subject.pipe(switchMap(fn), tap(() => {\n        nextTick(() => {\n            index++;\n            index === chunked.length\n                ? subject.complete()\n                : subject.next(chunked[index]);\n        });\n    }), toArray(), map(arrayFlatten));\n}\nexport function filterEras(eras, list) {\n    return eras.filter((e) => !list.some(({ era }) => e.eq(era)));\n}\nexport function erasHistoricApply(fn) {\n    return (instanceId, api) => \n    // Cannot quite get the typing right, but it is right in the code\n    // eslint-disable-next-line @typescript-eslint/no-unsafe-return\n    memo(instanceId, (withActive = false) => api.derive.staking.erasHistoric(withActive).pipe(switchMap((e) => api.derive.staking[fn](e, withActive))));\n}\nexport function erasHistoricApplyAccount(fn) {\n    return (instanceId, api) => \n    // Cannot quite get the typing right, but it is right in the code\n    // eslint-disable-next-line @typescript-eslint/no-unsafe-return\n    memo(instanceId, (accountId, withActive = false) => api.derive.staking.erasHistoric(withActive).pipe(switchMap((e) => api.derive.staking[fn](accountId, e, withActive))));\n}\nexport function singleEra(fn) {\n    return (instanceId, api) => \n    // Cannot quite get the typing right, but it is right in the code\n    // eslint-disable-next-line @typescript-eslint/no-unsafe-return\n    memo(instanceId, (era) => api.derive.staking[fn](era, true));\n}\nexport function combineEras(fn) {\n    return (instanceId, api) => \n    // Cannot quite get the typing right, but it is right in the code\n    // eslint-disable-next-line @typescript-eslint/no-unsafe-return\n    memo(instanceId, (eras, withActive) => !eras.length\n        ? of([])\n        : chunkEras(eras, (eras) => combineLatest(eras.map((e) => api.derive.staking[fn](e, withActive)))));\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}