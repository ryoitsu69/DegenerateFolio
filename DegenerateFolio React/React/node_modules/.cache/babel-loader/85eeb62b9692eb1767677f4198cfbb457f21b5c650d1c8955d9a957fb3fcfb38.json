{"ast":null,"code":"import { map, of } from 'rxjs';\nimport { memo } from '../util/index.js';\nimport { getEraCache, setEraCache } from './cache.js';\nimport { combineEras, erasHistoricApply, singleEra } from './util.js';\nconst CACHE_KEY = 'eraExposure';\nfunction mapStakersClipped(era, stakers) {\n  const nominators = {};\n  const validators = {};\n  stakers.forEach(_ref => {\n    let [key, exposure] = _ref;\n    const validatorId = key.args[1].toString();\n    validators[validatorId] = exposure;\n    exposure.others.forEach((_ref2, validatorIndex) => {\n      let {\n        who\n      } = _ref2;\n      const nominatorId = who.toString();\n      nominators[nominatorId] = nominators[nominatorId] || [];\n      nominators[nominatorId].push({\n        validatorId,\n        validatorIndex\n      });\n    });\n  });\n  return {\n    era,\n    nominators,\n    validators\n  };\n}\nfunction mapStakersPaged(era, stakers) {\n  const nominators = {};\n  const validators = {};\n  stakers.forEach(_ref3 => {\n    let [key, exposureOpt] = _ref3;\n    if (exposureOpt.isSome) {\n      const validatorId = key.args[1].toString();\n      const exposure = exposureOpt.unwrap();\n      validators[validatorId] = exposure;\n      exposure.others.forEach((_ref4, validatorIndex) => {\n        let {\n          who\n        } = _ref4;\n        const nominatorId = who.toString();\n        nominators[nominatorId] = nominators[nominatorId] || [];\n        nominators[nominatorId].push({\n          validatorId,\n          validatorIndex\n        });\n      });\n    }\n  });\n  return {\n    era,\n    nominators,\n    validators\n  };\n}\n/**\n * erasStakersClipped will be deprecated and replaced with erasStakersPaged. Therefore support is given for both\n * storage queries until erasStakersClipped has been completely out of use.\n */\nexport function _eraExposure(instanceId, api) {\n  return memo(instanceId, function (era) {\n    let withActive = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n    const [cacheKey, cached] = getEraCache(CACHE_KEY, era, withActive);\n    return cached ? of(cached) : api.query.staking.erasStakersPaged ? api.query.staking.erasStakersPaged.entries(era).pipe(map(r => setEraCache(cacheKey, withActive, mapStakersPaged(era, r)))) : api.query.staking.erasStakersClipped.entries(era).pipe(map(r => setEraCache(cacheKey, withActive, mapStakersClipped(era, r))));\n  });\n}\nexport const eraExposure = /*#__PURE__*/singleEra('_eraExposure');\nexport const _erasExposure = /*#__PURE__*/combineEras('_eraExposure');\nexport const erasExposure = /*#__PURE__*/erasHistoricApply('_erasExposure');","map":{"version":3,"names":["map","of","memo","getEraCache","setEraCache","combineEras","erasHistoricApply","singleEra","CACHE_KEY","mapStakersClipped","era","stakers","nominators","validators","forEach","_ref","key","exposure","validatorId","args","toString","others","_ref2","validatorIndex","who","nominatorId","push","mapStakersPaged","_ref3","exposureOpt","isSome","unwrap","_ref4","_eraExposure","instanceId","api","withActive","arguments","length","undefined","cacheKey","cached","query","staking","erasStakersPaged","entries","pipe","r","erasStakersClipped","eraExposure","_erasExposure","erasExposure"],"sources":["/home/ryoitsu/Documents/test/react-todo-app/node_modules/@polkadot/api-derive/staking/erasExposure.js"],"sourcesContent":["import { map, of } from 'rxjs';\nimport { memo } from '../util/index.js';\nimport { getEraCache, setEraCache } from './cache.js';\nimport { combineEras, erasHistoricApply, singleEra } from './util.js';\nconst CACHE_KEY = 'eraExposure';\nfunction mapStakersClipped(era, stakers) {\n    const nominators = {};\n    const validators = {};\n    stakers.forEach(([key, exposure]) => {\n        const validatorId = key.args[1].toString();\n        validators[validatorId] = exposure;\n        exposure.others.forEach(({ who }, validatorIndex) => {\n            const nominatorId = who.toString();\n            nominators[nominatorId] = nominators[nominatorId] || [];\n            nominators[nominatorId].push({ validatorId, validatorIndex });\n        });\n    });\n    return { era, nominators, validators };\n}\nfunction mapStakersPaged(era, stakers) {\n    const nominators = {};\n    const validators = {};\n    stakers.forEach(([key, exposureOpt]) => {\n        if (exposureOpt.isSome) {\n            const validatorId = key.args[1].toString();\n            const exposure = exposureOpt.unwrap();\n            validators[validatorId] = exposure;\n            exposure.others.forEach(({ who }, validatorIndex) => {\n                const nominatorId = who.toString();\n                nominators[nominatorId] = nominators[nominatorId] || [];\n                nominators[nominatorId].push({ validatorId, validatorIndex });\n            });\n        }\n    });\n    return { era, nominators, validators };\n}\n/**\n * erasStakersClipped will be deprecated and replaced with erasStakersPaged. Therefore support is given for both\n * storage queries until erasStakersClipped has been completely out of use.\n */\nexport function _eraExposure(instanceId, api) {\n    return memo(instanceId, (era, withActive = false) => {\n        const [cacheKey, cached] = getEraCache(CACHE_KEY, era, withActive);\n        return cached\n            ? of(cached)\n            : api.query.staking.erasStakersPaged\n                ? api.query.staking.erasStakersPaged.entries(era).pipe(map((r) => setEraCache(cacheKey, withActive, mapStakersPaged(era, r))))\n                : api.query.staking.erasStakersClipped.entries(era).pipe(map((r) => setEraCache(cacheKey, withActive, mapStakersClipped(era, r))));\n    });\n}\nexport const eraExposure = /*#__PURE__*/ singleEra('_eraExposure');\nexport const _erasExposure = /*#__PURE__*/ combineEras('_eraExposure');\nexport const erasExposure = /*#__PURE__*/ erasHistoricApply('_erasExposure');\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}