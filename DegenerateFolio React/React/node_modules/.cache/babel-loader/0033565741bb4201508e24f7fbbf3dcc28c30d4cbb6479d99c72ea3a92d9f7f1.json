{"ast":null,"code":"import { combineLatest, map, of } from 'rxjs';\nimport { memo } from '../util/index.js';\nfunction isVoter(value) {\n  return !Array.isArray(value);\n}\nfunction retrieveStakeOf(elections) {\n  return elections['stakeOf'].entries().pipe(map(entries => entries.map(_ref => {\n    let [{\n      args: [accountId]\n    }, stake] = _ref;\n    return [accountId, stake];\n  })));\n}\nfunction retrieveVoteOf(elections) {\n  return elections['votesOf'].entries().pipe(map(entries => entries.map(_ref2 => {\n    let [{\n      args: [accountId]\n    }, votes] = _ref2;\n    return [accountId, votes];\n  })));\n}\nfunction retrievePrev(api, elections) {\n  return combineLatest([retrieveStakeOf(elections), retrieveVoteOf(elections)]).pipe(map(_ref3 => {\n    let [stakes, votes] = _ref3;\n    const result = [];\n    votes.forEach(_ref4 => {\n      let [voter, votes] = _ref4;\n      result.push([voter, {\n        stake: api.registry.createType('Balance'),\n        votes\n      }]);\n    });\n    stakes.forEach(_ref5 => {\n      let [staker, stake] = _ref5;\n      const entry = result.find(_ref6 => {\n        let [voter] = _ref6;\n        return voter.eq(staker);\n      });\n      if (entry) {\n        entry[1].stake = stake;\n      } else {\n        result.push([staker, {\n          stake,\n          votes: []\n        }]);\n      }\n    });\n    return result;\n  }));\n}\nfunction retrieveCurrent(elections) {\n  return elections.voting.entries().pipe(map(entries => entries.map(_ref7 => {\n    let [{\n      args: [accountId]\n    }, value] = _ref7;\n    return [accountId, isVoter(value) ? {\n      stake: value.stake,\n      votes: value.votes\n    } : {\n      stake: value[0],\n      votes: value[1]\n    }];\n  })));\n}\nexport function votes(instanceId, api) {\n  const elections = api.query.elections || api.query['phragmenElection'] || api.query['electionsPhragmen'];\n  return memo(instanceId, () => elections ? elections['stakeOf'] ? retrievePrev(api, elections) : retrieveCurrent(elections) : of([]));\n}","map":{"version":3,"names":["combineLatest","map","of","memo","isVoter","value","Array","isArray","retrieveStakeOf","elections","entries","pipe","_ref","args","accountId","stake","retrieveVoteOf","_ref2","votes","retrievePrev","api","_ref3","stakes","result","forEach","_ref4","voter","push","registry","createType","_ref5","staker","entry","find","_ref6","eq","retrieveCurrent","voting","_ref7","instanceId","query"],"sources":["/home/ryoitsu/Documents/test/react-todo-app/node_modules/@polkadot/api-derive/council/votes.js"],"sourcesContent":["import { combineLatest, map, of } from 'rxjs';\nimport { memo } from '../util/index.js';\nfunction isVoter(value) {\n    return !Array.isArray(value);\n}\nfunction retrieveStakeOf(elections) {\n    return elections['stakeOf'].entries().pipe(map((entries) => entries.map(([{ args: [accountId] }, stake]) => [accountId, stake])));\n}\nfunction retrieveVoteOf(elections) {\n    return elections['votesOf'].entries().pipe(map((entries) => entries.map(([{ args: [accountId] }, votes]) => [accountId, votes])));\n}\nfunction retrievePrev(api, elections) {\n    return combineLatest([\n        retrieveStakeOf(elections),\n        retrieveVoteOf(elections)\n    ]).pipe(map(([stakes, votes]) => {\n        const result = [];\n        votes.forEach(([voter, votes]) => {\n            result.push([voter, { stake: api.registry.createType('Balance'), votes }]);\n        });\n        stakes.forEach(([staker, stake]) => {\n            const entry = result.find(([voter]) => voter.eq(staker));\n            if (entry) {\n                entry[1].stake = stake;\n            }\n            else {\n                result.push([staker, { stake, votes: [] }]);\n            }\n        });\n        return result;\n    }));\n}\nfunction retrieveCurrent(elections) {\n    return elections.voting.entries().pipe(map((entries) => entries.map(([{ args: [accountId] }, value]) => [\n        accountId,\n        isVoter(value)\n            ? { stake: value.stake, votes: value.votes }\n            : { stake: value[0], votes: value[1] }\n    ])));\n}\nexport function votes(instanceId, api) {\n    const elections = api.query.elections || api.query['phragmenElection'] || api.query['electionsPhragmen'];\n    return memo(instanceId, () => elections\n        ? elections['stakeOf']\n            ? retrievePrev(api, elections)\n            : retrieveCurrent(elections)\n        : of([]));\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}