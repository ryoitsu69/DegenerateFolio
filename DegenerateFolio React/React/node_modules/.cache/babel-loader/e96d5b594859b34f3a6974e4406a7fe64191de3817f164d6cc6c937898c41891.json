{"ast":null,"code":"import { map, of } from 'rxjs';\nimport { BN_ZERO } from '@polkadot/util';\nimport { memo } from '../util/index.js';\nimport { filterCachedEras, getEraMultiCache, setEraMultiCache } from './cache.js';\nimport { erasHistoricApply, filterEras } from './util.js';\nconst CACHE_KEY = 'eraPoints';\nfunction mapValidators({\n  individual\n}) {\n  return [...individual.entries()].filter(([, points]) => points.gt(BN_ZERO)).reduce((result, [validatorId, points]) => {\n    result[validatorId.toString()] = points;\n    return result;\n  }, {});\n}\nfunction mapPoints(eras, points) {\n  return eras.map((era, index) => ({\n    era,\n    eraPoints: points[index].total,\n    validators: mapValidators(points[index])\n  }));\n}\nexport function _erasPoints(instanceId, api) {\n  return memo(instanceId, (eras, withActive) => {\n    if (!eras.length) {\n      return of([]);\n    }\n    const cached = getEraMultiCache(CACHE_KEY, eras, withActive);\n    const remaining = filterEras(eras, cached);\n    return !remaining.length ? of(cached) : api.query.staking.erasRewardPoints.multi(remaining).pipe(map(p => filterCachedEras(eras, cached, setEraMultiCache(CACHE_KEY, withActive, mapPoints(remaining, p)))));\n  });\n}\nexport const erasPoints = /*#__PURE__*/erasHistoricApply('_erasPoints');","map":{"version":3,"names":["map","of","BN_ZERO","memo","filterCachedEras","getEraMultiCache","setEraMultiCache","erasHistoricApply","filterEras","CACHE_KEY","mapValidators","individual","entries","filter","points","gt","reduce","result","validatorId","toString","mapPoints","eras","era","index","eraPoints","total","validators","_erasPoints","instanceId","api","withActive","length","cached","remaining","query","staking","erasRewardPoints","multi","pipe","p","erasPoints"],"sources":["/home/ryoitsu/Documents/test/react-todo-app/node_modules/@polkadot/api-derive/staking/erasPoints.js"],"sourcesContent":["import { map, of } from 'rxjs';\nimport { BN_ZERO } from '@polkadot/util';\nimport { memo } from '../util/index.js';\nimport { filterCachedEras, getEraMultiCache, setEraMultiCache } from './cache.js';\nimport { erasHistoricApply, filterEras } from './util.js';\nconst CACHE_KEY = 'eraPoints';\nfunction mapValidators({ individual }) {\n    return [...individual.entries()]\n        .filter(([, points]) => points.gt(BN_ZERO))\n        .reduce((result, [validatorId, points]) => {\n        result[validatorId.toString()] = points;\n        return result;\n    }, {});\n}\nfunction mapPoints(eras, points) {\n    return eras.map((era, index) => ({\n        era,\n        eraPoints: points[index].total,\n        validators: mapValidators(points[index])\n    }));\n}\nexport function _erasPoints(instanceId, api) {\n    return memo(instanceId, (eras, withActive) => {\n        if (!eras.length) {\n            return of([]);\n        }\n        const cached = getEraMultiCache(CACHE_KEY, eras, withActive);\n        const remaining = filterEras(eras, cached);\n        return !remaining.length\n            ? of(cached)\n            : api.query.staking.erasRewardPoints.multi(remaining).pipe(map((p) => filterCachedEras(eras, cached, setEraMultiCache(CACHE_KEY, withActive, mapPoints(remaining, p)))));\n    });\n}\nexport const erasPoints = /*#__PURE__*/ erasHistoricApply('_erasPoints');\n"],"mappings":"AAAA,SAASA,GAAG,EAAEC,EAAE,QAAQ,MAAM;AAC9B,SAASC,OAAO,QAAQ,gBAAgB;AACxC,SAASC,IAAI,QAAQ,kBAAkB;AACvC,SAASC,gBAAgB,EAAEC,gBAAgB,EAAEC,gBAAgB,QAAQ,YAAY;AACjF,SAASC,iBAAiB,EAAEC,UAAU,QAAQ,WAAW;AACzD,MAAMC,SAAS,GAAG,WAAW;AAC7B,SAASC,aAAaA,CAAC;EAAEC;AAAW,CAAC,EAAE;EACnC,OAAO,CAAC,GAAGA,UAAU,CAACC,OAAO,CAAC,CAAC,CAAC,CAC3BC,MAAM,CAAC,CAAC,GAAGC,MAAM,CAAC,KAAKA,MAAM,CAACC,EAAE,CAACb,OAAO,CAAC,CAAC,CAC1Cc,MAAM,CAAC,CAACC,MAAM,EAAE,CAACC,WAAW,EAAEJ,MAAM,CAAC,KAAK;IAC3CG,MAAM,CAACC,WAAW,CAACC,QAAQ,CAAC,CAAC,CAAC,GAAGL,MAAM;IACvC,OAAOG,MAAM;EACjB,CAAC,EAAE,CAAC,CAAC,CAAC;AACV;AACA,SAASG,SAASA,CAACC,IAAI,EAAEP,MAAM,EAAE;EAC7B,OAAOO,IAAI,CAACrB,GAAG,CAAC,CAACsB,GAAG,EAAEC,KAAK,MAAM;IAC7BD,GAAG;IACHE,SAAS,EAAEV,MAAM,CAACS,KAAK,CAAC,CAACE,KAAK;IAC9BC,UAAU,EAAEhB,aAAa,CAACI,MAAM,CAACS,KAAK,CAAC;EAC3C,CAAC,CAAC,CAAC;AACP;AACA,OAAO,SAASI,WAAWA,CAACC,UAAU,EAAEC,GAAG,EAAE;EACzC,OAAO1B,IAAI,CAACyB,UAAU,EAAE,CAACP,IAAI,EAAES,UAAU,KAAK;IAC1C,IAAI,CAACT,IAAI,CAACU,MAAM,EAAE;MACd,OAAO9B,EAAE,CAAC,EAAE,CAAC;IACjB;IACA,MAAM+B,MAAM,GAAG3B,gBAAgB,CAACI,SAAS,EAAEY,IAAI,EAAES,UAAU,CAAC;IAC5D,MAAMG,SAAS,GAAGzB,UAAU,CAACa,IAAI,EAAEW,MAAM,CAAC;IAC1C,OAAO,CAACC,SAAS,CAACF,MAAM,GAClB9B,EAAE,CAAC+B,MAAM,CAAC,GACVH,GAAG,CAACK,KAAK,CAACC,OAAO,CAACC,gBAAgB,CAACC,KAAK,CAACJ,SAAS,CAAC,CAACK,IAAI,CAACtC,GAAG,CAAEuC,CAAC,IAAKnC,gBAAgB,CAACiB,IAAI,EAAEW,MAAM,EAAE1B,gBAAgB,CAACG,SAAS,EAAEqB,UAAU,EAAEV,SAAS,CAACa,SAAS,EAAEM,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;EAChL,CAAC,CAAC;AACN;AACA,OAAO,MAAMC,UAAU,GAAG,aAAcjC,iBAAiB,CAAC,aAAa,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}