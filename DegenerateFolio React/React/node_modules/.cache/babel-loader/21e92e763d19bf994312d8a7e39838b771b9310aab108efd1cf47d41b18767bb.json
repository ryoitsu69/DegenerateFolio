{"ast":null,"code":"import { ExtensionType } from '../../../extensions/Extensions.mjs';\nimport { Matrix } from '../../../maths/matrix/Matrix.mjs';\nimport { MAX_TEXTURES } from '../../../rendering/batcher/shared/const.mjs';\nimport { compileHighShaderGlProgram } from '../../../rendering/high-shader/compileHighShaderToProgram.mjs';\nimport { colorBitGl } from '../../../rendering/high-shader/shader-bits/colorBit.mjs';\nimport { generateTextureBatchBitGl } from '../../../rendering/high-shader/shader-bits/generateTextureBatchBit.mjs';\nimport { localUniformBitGl } from '../../../rendering/high-shader/shader-bits/localUniformBit.mjs';\nimport { roundPixelsBitGl } from '../../../rendering/high-shader/shader-bits/roundPixelsBit.mjs';\nimport { batchSamplersUniformGroup } from '../../../rendering/renderers/gl/shader/batchSamplersUniformGroup.mjs';\nimport { Shader } from '../../../rendering/renderers/shared/shader/Shader.mjs';\nimport { UniformGroup } from '../../../rendering/renderers/shared/shader/UniformGroup.mjs';\n\"use strict\";\nclass GlGraphicsAdaptor {\n  init() {\n    const uniforms = new UniformGroup({\n      uColor: {\n        value: new Float32Array([1, 1, 1, 1]),\n        type: \"vec4<f32>\"\n      },\n      uTransformMatrix: {\n        value: new Matrix(),\n        type: \"mat3x3<f32>\"\n      },\n      uRound: {\n        value: 0,\n        type: \"f32\"\n      }\n    });\n    const glProgram = compileHighShaderGlProgram({\n      name: \"graphics\",\n      bits: [colorBitGl, generateTextureBatchBitGl(MAX_TEXTURES), localUniformBitGl, roundPixelsBitGl]\n    });\n    this.shader = new Shader({\n      glProgram,\n      resources: {\n        localUniforms: uniforms,\n        batchSamplers: batchSamplersUniformGroup\n      }\n    });\n  }\n  execute(graphicsPipe, renderable) {\n    const context = renderable.context;\n    const shader = context.customShader || this.shader;\n    const renderer = graphicsPipe.renderer;\n    const contextSystem = renderer.graphicsContext;\n    const {\n      geometry,\n      instructions\n    } = contextSystem.getContextRenderData(context);\n    shader.groups[0] = renderer.globalUniforms.bindGroup;\n    renderer.state.set(graphicsPipe.state);\n    renderer.shader.bind(shader);\n    renderer.geometry.bind(geometry, shader.glProgram);\n    const batches = instructions.instructions;\n    for (let i = 0; i < instructions.instructionSize; i++) {\n      const batch = batches[i];\n      if (batch.size) {\n        for (let j = 0; j < batch.textures.textures.length; j++) {\n          renderer.texture.bind(batch.textures.textures[j], j);\n        }\n        renderer.geometry.draw(\"triangle-list\", batch.size, batch.start);\n      }\n    }\n  }\n  destroy() {\n    this.shader.destroy(true);\n    this.shader = null;\n  }\n}\n/** @ignore */\nGlGraphicsAdaptor.extension = {\n  type: [ExtensionType.WebGLPipesAdaptor],\n  name: \"graphics\"\n};\nexport { GlGraphicsAdaptor };","map":{"version":3,"names":["GlGraphicsAdaptor","init","uniforms","UniformGroup","uColor","value","Float32Array","type","uTransformMatrix","Matrix","uRound","glProgram","compileHighShaderGlProgram","name","bits","colorBitGl","generateTextureBatchBitGl","MAX_TEXTURES","localUniformBitGl","roundPixelsBitGl","shader","Shader","resources","localUniforms","batchSamplers","batchSamplersUniformGroup","execute","graphicsPipe","renderable","context","customShader","renderer","contextSystem","graphicsContext","geometry","instructions","getContextRenderData","groups","globalUniforms","bindGroup","state","set","bind","batches","i","instructionSize","batch","size","j","textures","length","texture","draw","start","destroy","extension","ExtensionType","WebGLPipesAdaptor"],"sources":["/home/ryoitsu/node_modules/pixi.js/src/scene/graphics/gl/GlGraphicsAdaptor.ts"],"sourcesContent":["import { ExtensionType } from '../../../extensions/Extensions';\nimport { Matrix } from '../../../maths/matrix/Matrix';\nimport { MAX_TEXTURES } from '../../../rendering/batcher/shared/const';\nimport { compileHighShaderGlProgram } from '../../../rendering/high-shader/compileHighShaderToProgram';\nimport { colorBitGl } from '../../../rendering/high-shader/shader-bits/colorBit';\nimport { generateTextureBatchBitGl } from '../../../rendering/high-shader/shader-bits/generateTextureBatchBit';\nimport { localUniformBitGl } from '../../../rendering/high-shader/shader-bits/localUniformBit';\nimport { roundPixelsBitGl } from '../../../rendering/high-shader/shader-bits/roundPixelsBit';\nimport { batchSamplersUniformGroup } from '../../../rendering/renderers/gl/shader/batchSamplersUniformGroup';\nimport { Shader } from '../../../rendering/renderers/shared/shader/Shader';\nimport { UniformGroup } from '../../../rendering/renderers/shared/shader/UniformGroup';\n\nimport type { Batch } from '../../../rendering/batcher/shared/Batcher';\nimport type { WebGLRenderer } from '../../../rendering/renderers/gl/WebGLRenderer';\nimport type { Graphics } from '../shared/Graphics';\nimport type { GraphicsAdaptor, GraphicsPipe } from '../shared/GraphicsPipe';\n\n/**\n * A GraphicsAdaptor that uses WebGL to render graphics.\n * @memberof rendering\n * @ignore\n */\nexport class GlGraphicsAdaptor implements GraphicsAdaptor\n{\n    /** @ignore */\n    public static extension = {\n        type: [\n            ExtensionType.WebGLPipesAdaptor,\n        ],\n        name: 'graphics',\n    } as const;\n\n    public shader: Shader;\n\n    public init()\n    {\n        const uniforms = new UniformGroup({\n            uColor: { value: new Float32Array([1, 1, 1, 1]), type: 'vec4<f32>' },\n            uTransformMatrix: { value: new Matrix(), type: 'mat3x3<f32>' },\n            uRound: { value: 0, type: 'f32' },\n        });\n\n        const glProgram = compileHighShaderGlProgram({\n            name: 'graphics',\n            bits: [\n                colorBitGl,\n                generateTextureBatchBitGl(MAX_TEXTURES),\n                localUniformBitGl,\n                roundPixelsBitGl,\n            ]\n        });\n\n        this.shader = new Shader({\n            glProgram,\n            resources: {\n                localUniforms: uniforms,\n                batchSamplers: batchSamplersUniformGroup,\n            }\n        });\n    }\n\n    public execute(graphicsPipe: GraphicsPipe, renderable: Graphics): void\n    {\n        const context = renderable.context;\n        const shader = context.customShader || this.shader;\n        const renderer = graphicsPipe.renderer as WebGLRenderer;\n        const contextSystem = renderer.graphicsContext;\n\n        const {\n            geometry, instructions,\n        } = contextSystem.getContextRenderData(context);\n\n        // WebGL specific..\n        shader.groups[0] = renderer.globalUniforms.bindGroup;\n\n        renderer.state.set(graphicsPipe.state);\n\n        renderer.shader.bind(shader);\n\n        renderer.geometry.bind(geometry, shader.glProgram);\n\n        const batches = instructions.instructions as Batch[];\n\n        for (let i = 0; i < instructions.instructionSize; i++)\n        {\n            const batch = batches[i];\n\n            if (batch.size)\n            {\n                for (let j = 0; j < batch.textures.textures.length; j++)\n                {\n                    renderer.texture.bind(batch.textures.textures[j], j);\n                }\n\n                renderer.geometry.draw('triangle-list', batch.size, batch.start);\n            }\n        }\n    }\n\n    public destroy(): void\n    {\n        this.shader.destroy(true);\n        this.shader = null;\n    }\n}\n"],"mappings":";;;;;;;;;;;;AAsBO,MAAMA,iBACb;EAWWC,IACPA,CAAA;IACU,MAAAC,QAAA,GAAW,IAAIC,YAAa;MAC9BC,MAAQ;QAAEC,KAAO,MAAIC,YAAa,EAAC,CAAG,KAAG,CAAG,GAAC,CAAC;QAAGC,IAAA,EAAM;MAAY;MACnEC,gBAAA,EAAkB;QAAEH,KAAA,EAAO,IAAII,MAAO;QAAGF,IAAA,EAAM;MAAc;MAC7DG,MAAQ;QAAEL,KAAO;QAAGE,IAAA,EAAM;MAAM;IAAA,CACnC;IAED,MAAMI,SAAA,GAAYC,0BAA2B;MACzCC,IAAM;MACNC,IAAM,GACFC,UAAA,EACAC,yBAAA,CAA0BC,YAAY,GACtCC,iBAAA,EACAC,gBAAA;IACJ,CACH;IAEI,KAAAC,MAAA,GAAS,IAAIC,MAAO;MACrBV,SAAA;MACAW,SAAW;QACPC,aAAe,EAAArB,QAAA;QACfsB,aAAe,EAAAC;MAAA;IACnB,CACH;EAAA;EAGEC,QAAQC,YAAA,EAA4BC,UAC3C;IACI,MAAMC,OAAA,GAAUD,UAAW,CAAAC,OAAA;IACrB,MAAAT,MAAA,GAASS,OAAQ,CAAAC,YAAA,IAAgB,IAAK,CAAAV,MAAA;IAC5C,MAAMW,QAAA,GAAWJ,YAAa,CAAAI,QAAA;IAC9B,MAAMC,aAAA,GAAgBD,QAAS,CAAAE,eAAA;IAEzB;MACFC,QAAA;MAAUC;IAAA,CACd,GAAIH,aAAc,CAAAI,oBAAA,CAAqBP,OAAO;IAG9CT,MAAA,CAAOiB,MAAO,EAAC,CAAI,GAAAN,QAAA,CAASO,cAAe,CAAAC,SAAA;IAElCR,QAAA,CAAAS,KAAA,CAAMC,GAAI,CAAAd,YAAA,CAAaa,KAAK;IAE5BT,QAAA,CAAAX,MAAA,CAAOsB,IAAA,CAAKtB,MAAM;IAE3BW,QAAA,CAASG,QAAS,CAAAQ,IAAA,CAAKR,QAAU,EAAAd,MAAA,CAAOT,SAAS;IAEjD,MAAMgC,OAAA,GAAUR,YAAa,CAAAA,YAAA;IAE7B,SAASS,CAAI,MAAGA,CAAI,GAAAT,YAAA,CAAaU,eAAA,EAAiBD,CAClD;MACU,MAAAE,KAAA,GAAQH,OAAA,CAAQC,CAAC;MAEvB,IAAIE,KAAA,CAAMC,IACV;QACI,SAASC,CAAA,GAAI,CAAG,EAAAA,CAAA,GAAIF,KAAA,CAAMG,QAAS,CAAAA,QAAA,CAASC,MAAA,EAAQF,CACpD;UACIjB,QAAA,CAASoB,OAAA,CAAQT,IAAK,CAAAI,KAAA,CAAMG,QAAA,CAASA,QAAS,CAAAD,CAAC,GAAGA,CAAC;QAAA;QAGvDjB,QAAA,CAASG,QAAA,CAASkB,IAAK,kBAAiBN,KAAM,CAAAC,IAAA,EAAMD,KAAA,CAAMO,KAAK;MAAA;IACnE;EACJ;EAGGC,OACPA,CAAA;IACS,KAAAlC,MAAA,CAAOkC,OAAA,CAAQ,IAAI;IACxB,KAAKlC,MAAS;EAAA;AAEtB;AAAA;AAlFapB,iBAAA,CAGKuD,SAAY;EACtBhD,IAAM,GACFiD,aAAc,CAAAC,iBAAA,CAClB;EACA5C,IAAM;AACV","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}