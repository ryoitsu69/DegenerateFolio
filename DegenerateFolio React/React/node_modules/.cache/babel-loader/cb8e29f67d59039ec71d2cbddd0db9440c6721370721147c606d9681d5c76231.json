{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.decrypt = exports.encrypt = void 0;\nconst crypto_1 = require(\"@noble/hashes/crypto\");\nconst utils_js_1 = require(\"./utils.js\");\nconst crypto = {\n  web: crypto_1.crypto\n};\nfunction validateOpt(key, iv, mode) {\n  if (!mode.startsWith(\"aes-\")) {\n    throw new Error(`AES submodule doesn't support mode ${mode}`);\n  }\n  if (iv.length !== 16) {\n    throw new Error(\"AES: wrong IV length\");\n  }\n  if (mode.startsWith(\"aes-128\") && key.length !== 16 || mode.startsWith(\"aes-256\") && key.length !== 32) {\n    throw new Error(\"AES: wrong key length\");\n  }\n}\nasync function getBrowserKey(mode, key, iv) {\n  if (!crypto.web) {\n    throw new Error(\"Browser crypto not available.\");\n  }\n  let keyMode;\n  if ([\"aes-128-cbc\", \"aes-256-cbc\"].includes(mode)) {\n    keyMode = \"cbc\";\n  }\n  if ([\"aes-128-ctr\", \"aes-256-ctr\"].includes(mode)) {\n    keyMode = \"ctr\";\n  }\n  if (!keyMode) {\n    throw new Error(\"AES: unsupported mode\");\n  }\n  const wKey = await crypto.web.subtle.importKey(\"raw\", key, {\n    name: `AES-${keyMode.toUpperCase()}`,\n    length: key.length * 8\n  }, true, [\"encrypt\", \"decrypt\"]);\n  // node.js uses whole 128 bit as a counter, without nonce, instead of 64 bit\n  // recommended by NIST SP800-38A\n  return [wKey, {\n    name: `aes-${keyMode}`,\n    iv,\n    counter: iv,\n    length: 128\n  }];\n}\nasync function encrypt(msg, key, iv, mode = \"aes-128-ctr\", pkcs7PaddingEnabled = true) {\n  validateOpt(key, iv, mode);\n  if (crypto.web) {\n    const [wKey, wOpt] = await getBrowserKey(mode, key, iv);\n    const cipher = await crypto.web.subtle.encrypt(wOpt, wKey, msg);\n    // Remove PKCS7 padding on cbc mode by stripping end of message\n    let res = new Uint8Array(cipher);\n    if (!pkcs7PaddingEnabled && wOpt.name === \"aes-cbc\" && !(msg.length % 16)) {\n      res = res.slice(0, -16);\n    }\n    return res;\n  } else if (crypto.node) {\n    const cipher = crypto.node.createCipheriv(mode, key, iv);\n    cipher.setAutoPadding(pkcs7PaddingEnabled);\n    return (0, utils_js_1.concatBytes)(cipher.update(msg), cipher.final());\n  } else {\n    throw new Error(\"The environment doesn't have AES module\");\n  }\n}\nexports.encrypt = encrypt;\nasync function getPadding(cypherText, key, iv, mode) {\n  const lastBlock = cypherText.slice(-16);\n  for (let i = 0; i < 16; i++) {\n    // Undo xor of iv and fill with lastBlock ^ padding (16)\n    lastBlock[i] ^= iv[i] ^ 16;\n  }\n  const res = await encrypt(lastBlock, key, iv, mode);\n  return res.slice(0, 16);\n}\nasync function decrypt(cypherText, key, iv, mode = \"aes-128-ctr\", pkcs7PaddingEnabled = true) {\n  validateOpt(key, iv, mode);\n  if (crypto.web) {\n    const [wKey, wOpt] = await getBrowserKey(mode, key, iv);\n    // Add empty padding so Chrome will correctly decrypt message\n    if (!pkcs7PaddingEnabled && wOpt.name === \"aes-cbc\") {\n      const padding = await getPadding(cypherText, key, iv, mode);\n      cypherText = (0, utils_js_1.concatBytes)(cypherText, padding);\n    }\n    const msg = await crypto.web.subtle.decrypt(wOpt, wKey, cypherText);\n    const msgBytes = new Uint8Array(msg);\n    // Safari always ignores padding (if no padding -> broken message)\n    if (wOpt.name === \"aes-cbc\") {\n      const encrypted = await encrypt(msgBytes, key, iv, mode);\n      if (!(0, utils_js_1.equalsBytes)(encrypted, cypherText)) {\n        throw new Error(\"AES: wrong padding\");\n      }\n    }\n    return msgBytes;\n  } else if (crypto.node) {\n    const decipher = crypto.node.createDecipheriv(mode, key, iv);\n    decipher.setAutoPadding(pkcs7PaddingEnabled);\n    return (0, utils_js_1.concatBytes)(decipher.update(cypherText), decipher.final());\n  } else {\n    throw new Error(\"The environment doesn't have AES module\");\n  }\n}\nexports.decrypt = decrypt;","map":{"version":3,"names":["Object","defineProperty","exports","value","decrypt","encrypt","crypto_1","require","utils_js_1","crypto","web","validateOpt","key","iv","mode","startsWith","Error","length","getBrowserKey","keyMode","includes","wKey","subtle","importKey","name","toUpperCase","counter","msg","pkcs7PaddingEnabled","wOpt","cipher","res","Uint8Array","slice","node","createCipheriv","setAutoPadding","concatBytes","update","final","getPadding","cypherText","lastBlock","i","padding","msgBytes","encrypted","equalsBytes","decipher","createDecipheriv"],"sources":["/home/ryoitsu/Documents/test/react-todo-app/node_modules/ethereum-cryptography/aes.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.decrypt = exports.encrypt = void 0;\nconst crypto_1 = require(\"@noble/hashes/crypto\");\nconst utils_js_1 = require(\"./utils.js\");\nconst crypto = { web: crypto_1.crypto };\nfunction validateOpt(key, iv, mode) {\n    if (!mode.startsWith(\"aes-\")) {\n        throw new Error(`AES submodule doesn't support mode ${mode}`);\n    }\n    if (iv.length !== 16) {\n        throw new Error(\"AES: wrong IV length\");\n    }\n    if ((mode.startsWith(\"aes-128\") && key.length !== 16) ||\n        (mode.startsWith(\"aes-256\") && key.length !== 32)) {\n        throw new Error(\"AES: wrong key length\");\n    }\n}\nasync function getBrowserKey(mode, key, iv) {\n    if (!crypto.web) {\n        throw new Error(\"Browser crypto not available.\");\n    }\n    let keyMode;\n    if ([\"aes-128-cbc\", \"aes-256-cbc\"].includes(mode)) {\n        keyMode = \"cbc\";\n    }\n    if ([\"aes-128-ctr\", \"aes-256-ctr\"].includes(mode)) {\n        keyMode = \"ctr\";\n    }\n    if (!keyMode) {\n        throw new Error(\"AES: unsupported mode\");\n    }\n    const wKey = await crypto.web.subtle.importKey(\"raw\", key, { name: `AES-${keyMode.toUpperCase()}`, length: key.length * 8 }, true, [\"encrypt\", \"decrypt\"]);\n    // node.js uses whole 128 bit as a counter, without nonce, instead of 64 bit\n    // recommended by NIST SP800-38A\n    return [wKey, { name: `aes-${keyMode}`, iv, counter: iv, length: 128 }];\n}\nasync function encrypt(msg, key, iv, mode = \"aes-128-ctr\", pkcs7PaddingEnabled = true) {\n    validateOpt(key, iv, mode);\n    if (crypto.web) {\n        const [wKey, wOpt] = await getBrowserKey(mode, key, iv);\n        const cipher = await crypto.web.subtle.encrypt(wOpt, wKey, msg);\n        // Remove PKCS7 padding on cbc mode by stripping end of message\n        let res = new Uint8Array(cipher);\n        if (!pkcs7PaddingEnabled && wOpt.name === \"aes-cbc\" && !(msg.length % 16)) {\n            res = res.slice(0, -16);\n        }\n        return res;\n    }\n    else if (crypto.node) {\n        const cipher = crypto.node.createCipheriv(mode, key, iv);\n        cipher.setAutoPadding(pkcs7PaddingEnabled);\n        return (0, utils_js_1.concatBytes)(cipher.update(msg), cipher.final());\n    }\n    else {\n        throw new Error(\"The environment doesn't have AES module\");\n    }\n}\nexports.encrypt = encrypt;\nasync function getPadding(cypherText, key, iv, mode) {\n    const lastBlock = cypherText.slice(-16);\n    for (let i = 0; i < 16; i++) {\n        // Undo xor of iv and fill with lastBlock ^ padding (16)\n        lastBlock[i] ^= iv[i] ^ 16;\n    }\n    const res = await encrypt(lastBlock, key, iv, mode);\n    return res.slice(0, 16);\n}\nasync function decrypt(cypherText, key, iv, mode = \"aes-128-ctr\", pkcs7PaddingEnabled = true) {\n    validateOpt(key, iv, mode);\n    if (crypto.web) {\n        const [wKey, wOpt] = await getBrowserKey(mode, key, iv);\n        // Add empty padding so Chrome will correctly decrypt message\n        if (!pkcs7PaddingEnabled && wOpt.name === \"aes-cbc\") {\n            const padding = await getPadding(cypherText, key, iv, mode);\n            cypherText = (0, utils_js_1.concatBytes)(cypherText, padding);\n        }\n        const msg = await crypto.web.subtle.decrypt(wOpt, wKey, cypherText);\n        const msgBytes = new Uint8Array(msg);\n        // Safari always ignores padding (if no padding -> broken message)\n        if (wOpt.name === \"aes-cbc\") {\n            const encrypted = await encrypt(msgBytes, key, iv, mode);\n            if (!(0, utils_js_1.equalsBytes)(encrypted, cypherText)) {\n                throw new Error(\"AES: wrong padding\");\n            }\n        }\n        return msgBytes;\n    }\n    else if (crypto.node) {\n        const decipher = crypto.node.createDecipheriv(mode, key, iv);\n        decipher.setAutoPadding(pkcs7PaddingEnabled);\n        return (0, utils_js_1.concatBytes)(decipher.update(cypherText), decipher.final());\n    }\n    else {\n        throw new Error(\"The environment doesn't have AES module\");\n    }\n}\nexports.decrypt = decrypt;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}