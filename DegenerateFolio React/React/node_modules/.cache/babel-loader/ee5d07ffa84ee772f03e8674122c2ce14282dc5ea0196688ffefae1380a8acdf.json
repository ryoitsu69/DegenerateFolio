{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.getDataFeeEIP2930 = exports.getAccessListJSON = exports.verifyAccessList = exports.getAccessListData = exports.checkMaxInitCodeSize = void 0;\nconst web3_utils_1 = require(\"web3-utils\");\nconst utils_js_1 = require(\"../common/utils.js\");\nconst types_js_1 = require(\"./types.js\");\nconst checkMaxInitCodeSize = (common, length) => {\n  const maxInitCodeSize = common.param('vm', 'maxInitCodeSize');\n  if (maxInitCodeSize && BigInt(length) > maxInitCodeSize) {\n    throw new Error(\"the initcode size of this transaction is too large: it is \".concat(length, \" while the max is \").concat(common.param('vm', 'maxInitCodeSize')));\n  }\n};\nexports.checkMaxInitCodeSize = checkMaxInitCodeSize;\nconst getAccessListData = accessList => {\n  let AccessListJSON;\n  let uint8arrayAccessList;\n  if ((0, types_js_1.isAccessList)(accessList)) {\n    AccessListJSON = accessList;\n    const newAccessList = [];\n    // eslint-disable-next-line @typescript-eslint/prefer-for-of\n    for (let i = 0; i < accessList.length; i += 1) {\n      const item = accessList[i];\n      const addressBytes = (0, utils_js_1.toUint8Array)(item.address);\n      const storageItems = [];\n      // eslint-disable-next-line @typescript-eslint/prefer-for-of\n      for (let index = 0; index < item.storageKeys.length; index += 1) {\n        storageItems.push((0, utils_js_1.toUint8Array)(item.storageKeys[index]));\n      }\n      newAccessList.push([addressBytes, storageItems]);\n    }\n    uint8arrayAccessList = newAccessList;\n  } else {\n    uint8arrayAccessList = accessList !== null && accessList !== void 0 ? accessList : [];\n    // build the JSON\n    const json = [];\n    // eslint-disable-next-line @typescript-eslint/prefer-for-of\n    for (let i = 0; i < uint8arrayAccessList.length; i += 1) {\n      const data = uint8arrayAccessList[i];\n      const address = (0, web3_utils_1.bytesToHex)(data[0]);\n      const storageKeys = [];\n      // eslint-disable-next-line @typescript-eslint/prefer-for-of\n      for (let item = 0; item < data[1].length; item += 1) {\n        storageKeys.push((0, web3_utils_1.bytesToHex)(data[1][item]));\n      }\n      const jsonItem = {\n        address,\n        storageKeys\n      };\n      json.push(jsonItem);\n    }\n    AccessListJSON = json;\n  }\n  return {\n    AccessListJSON,\n    accessList: uint8arrayAccessList\n  };\n};\nexports.getAccessListData = getAccessListData;\nconst verifyAccessList = accessList => {\n  // eslint-disable-next-line @typescript-eslint/prefer-for-of\n  for (let key = 0; key < accessList.length; key += 1) {\n    const accessListItem = accessList[key];\n    const address = accessListItem[0];\n    const storageSlots = accessListItem[1];\n    // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access, @typescript-eslint/consistent-type-assertions\n    if (accessListItem[2] !== undefined) {\n      throw new Error('Access list item cannot have 3 elements. It can only have an address, and an array of storage slots.');\n    }\n    if (address.length !== 20) {\n      throw new Error('Invalid EIP-2930 transaction: address length should be 20 bytes');\n    }\n    // eslint-disable-next-line @typescript-eslint/prefer-for-of\n    for (let storageSlot = 0; storageSlot < storageSlots.length; storageSlot += 1) {\n      if (storageSlots[storageSlot].length !== 32) {\n        throw new Error('Invalid EIP-2930 transaction: storage slot length should be 32 bytes');\n      }\n    }\n  }\n};\nexports.verifyAccessList = verifyAccessList;\nconst getAccessListJSON = accessList => {\n  const accessListJSON = [];\n  // eslint-disable-next-line @typescript-eslint/prefer-for-of\n  for (let index = 0; index < accessList.length; index += 1) {\n    const item = accessList[index];\n    const JSONItem = {\n      // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access, @typescript-eslint/consistent-type-assertions\n      address: (0, web3_utils_1.bytesToHex)((0, utils_js_1.setLengthLeft)(item[0], 20)),\n      storageKeys: []\n    };\n    // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access, @typescript-eslint/no-unsafe-assignment, @typescript-eslint/prefer-optional-chain\n    const storageSlots = item && item[1];\n    // eslint-disable-next-line @typescript-eslint/prefer-for-of\n    for (let slot = 0; slot < storageSlots.length; slot += 1) {\n      const storageSlot = storageSlots[slot];\n      JSONItem.storageKeys.push((0, web3_utils_1.bytesToHex)((0, utils_js_1.setLengthLeft)(storageSlot, 32)));\n    }\n    accessListJSON.push(JSONItem);\n  }\n  return accessListJSON;\n};\nexports.getAccessListJSON = getAccessListJSON;\nconst getDataFeeEIP2930 = (accessList, common) => {\n  const accessListStorageKeyCost = common.param('gasPrices', 'accessListStorageKeyCost');\n  const accessListAddressCost = common.param('gasPrices', 'accessListAddressCost');\n  let slots = 0;\n  // eslint-disable-next-line @typescript-eslint/prefer-for-of\n  for (let index = 0; index < accessList.length; index += 1) {\n    const item = accessList[index];\n    const storageSlots = item[1];\n    slots += storageSlots.length;\n  }\n  const addresses = accessList.length;\n  return addresses * Number(accessListAddressCost) + slots * Number(accessListStorageKeyCost);\n};\nexports.getDataFeeEIP2930 = getDataFeeEIP2930;","map":{"version":3,"names":["web3_utils_1","require","utils_js_1","types_js_1","checkMaxInitCodeSize","common","length","maxInitCodeSize","param","BigInt","Error","concat","exports","getAccessListData","accessList","AccessListJSON","uint8arrayAccessList","isAccessList","newAccessList","i","item","addressBytes","toUint8Array","address","storageItems","index","storageKeys","push","json","data","bytesToHex","jsonItem","verifyAccessList","key","accessListItem","storageSlots","undefined","storageSlot","getAccessListJSON","accessListJSON","JSONItem","setLengthLeft","slot","getDataFeeEIP2930","accessListStorageKeyCost","accessListAddressCost","slots","addresses","Number"],"sources":["/home/ryoitsu/Documents/test/react-todo-app/node_modules/web3-eth-accounts/src/tx/utils.ts"],"sourcesContent":["/*\nThis file is part of web3.js.\n\nweb3.js is free software: you can redistribute it and/or modify\nit under the terms of the GNU Lesser General Public License as published by\nthe Free Software Foundation, either version 3 of the License, or\n(at your option) any later version.\n\nweb3.js is distributed in the hope that it will be useful,\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\nGNU Lesser General Public License for more details.\n\nYou should have received a copy of the GNU Lesser General Public License\nalong with web3.js.  If not, see <http://www.gnu.org/licenses/>.\n*/\nimport { HexString } from 'web3-types';\nimport { bytesToHex } from 'web3-utils';\nimport { setLengthLeft, toUint8Array } from '../common/utils.js';\nimport type { AccessList, AccessListUint8Array, AccessListItem } from './types.js';\nimport { isAccessList } from './types.js';\n\nimport type { Common } from '../common/common.js';\n\nexport const checkMaxInitCodeSize = (common: Common, length: number) => {\n\tconst maxInitCodeSize = common.param('vm', 'maxInitCodeSize');\n\tif (maxInitCodeSize && BigInt(length) > maxInitCodeSize) {\n\t\tthrow new Error(\n\t\t\t`the initcode size of this transaction is too large: it is ${length} while the max is ${common.param(\n\t\t\t\t'vm',\n\t\t\t\t'maxInitCodeSize',\n\t\t\t)}`,\n\t\t);\n\t}\n};\n\nexport const getAccessListData = (accessList: AccessListUint8Array | AccessList) => {\n\tlet AccessListJSON;\n\tlet uint8arrayAccessList;\n\tif (isAccessList(accessList)) {\n\t\tAccessListJSON = accessList;\n\t\tconst newAccessList: AccessListUint8Array = [];\n\t\t// eslint-disable-next-line @typescript-eslint/prefer-for-of\n\t\tfor (let i = 0; i < accessList.length; i += 1) {\n\t\t\tconst item: AccessListItem = accessList[i];\n\t\t\tconst addressBytes = toUint8Array(item.address);\n\t\t\tconst storageItems: Uint8Array[] = [];\n\t\t\t// eslint-disable-next-line @typescript-eslint/prefer-for-of\n\t\t\tfor (let index = 0; index < item.storageKeys.length; index += 1) {\n\t\t\t\tstorageItems.push(toUint8Array(item.storageKeys[index]));\n\t\t\t}\n\t\t\tnewAccessList.push([addressBytes, storageItems]);\n\t\t}\n\t\tuint8arrayAccessList = newAccessList;\n\t} else {\n\t\tuint8arrayAccessList = accessList ?? [];\n\t\t// build the JSON\n\t\tconst json: AccessList = [];\n\t\t// eslint-disable-next-line @typescript-eslint/prefer-for-of\n\t\tfor (let i = 0; i < uint8arrayAccessList.length; i += 1) {\n\t\t\tconst data = uint8arrayAccessList[i];\n\t\t\tconst address = bytesToHex(data[0]);\n\t\t\tconst storageKeys: string[] = [];\n\t\t\t// eslint-disable-next-line @typescript-eslint/prefer-for-of\n\t\t\tfor (let item = 0; item < data[1].length; item += 1) {\n\t\t\t\tstorageKeys.push(bytesToHex(data[1][item]));\n\t\t\t}\n\t\t\tconst jsonItem: AccessListItem = {\n\t\t\t\taddress,\n\t\t\t\tstorageKeys,\n\t\t\t};\n\t\t\tjson.push(jsonItem);\n\t\t}\n\t\tAccessListJSON = json;\n\t}\n\n\treturn {\n\t\tAccessListJSON,\n\t\taccessList: uint8arrayAccessList,\n\t};\n};\n\nexport const verifyAccessList = (accessList: AccessListUint8Array) => {\n\t// eslint-disable-next-line @typescript-eslint/prefer-for-of\n\tfor (let key = 0; key < accessList.length; key += 1) {\n\t\tconst accessListItem = accessList[key];\n\t\tconst address = accessListItem[0];\n\t\tconst storageSlots = accessListItem[1];\n\t\t// eslint-disable-next-line @typescript-eslint/no-unsafe-member-access, @typescript-eslint/consistent-type-assertions\n\t\tif ((<any>accessListItem)[2] !== undefined) {\n\t\t\tthrow new Error(\n\t\t\t\t'Access list item cannot have 3 elements. It can only have an address, and an array of storage slots.',\n\t\t\t);\n\t\t}\n\t\tif (address.length !== 20) {\n\t\t\tthrow new Error('Invalid EIP-2930 transaction: address length should be 20 bytes');\n\t\t}\n\t\t// eslint-disable-next-line @typescript-eslint/prefer-for-of\n\t\tfor (let storageSlot = 0; storageSlot < storageSlots.length; storageSlot += 1) {\n\t\t\tif (storageSlots[storageSlot].length !== 32) {\n\t\t\t\tthrow new Error(\n\t\t\t\t\t'Invalid EIP-2930 transaction: storage slot length should be 32 bytes',\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t}\n};\n\nexport const getAccessListJSON = (\n\taccessList: AccessListUint8Array,\n): {\n\taddress: HexString;\n\tstorageKeys: HexString[];\n}[] => {\n\tconst accessListJSON: { address: HexString; storageKeys: HexString[] }[] = [];\n\t// eslint-disable-next-line @typescript-eslint/prefer-for-of\n\tfor (let index = 0; index < accessList.length; index += 1) {\n\t\tconst item: any = accessList[index];\n\t\tconst JSONItem: { address: HexString; storageKeys: HexString[] } = {\n\t\t\t// eslint-disable-next-line @typescript-eslint/no-unsafe-member-access, @typescript-eslint/consistent-type-assertions\n\t\t\taddress: bytesToHex(setLengthLeft(<Uint8Array>item[0], 20)),\n\t\t\tstorageKeys: [],\n\t\t};\n\t\t// eslint-disable-next-line @typescript-eslint/no-unsafe-member-access, @typescript-eslint/no-unsafe-assignment, @typescript-eslint/prefer-optional-chain\n\t\tconst storageSlots: Uint8Array[] = item && item[1];\n\t\t// eslint-disable-next-line @typescript-eslint/prefer-for-of\n\t\tfor (let slot = 0; slot < storageSlots.length; slot += 1) {\n\t\t\tconst storageSlot = storageSlots[slot];\n\t\t\tJSONItem.storageKeys.push(bytesToHex(setLengthLeft(storageSlot, 32)));\n\t\t}\n\t\taccessListJSON.push(JSONItem);\n\t}\n\treturn accessListJSON;\n};\n\nexport const getDataFeeEIP2930 = (accessList: AccessListUint8Array, common: Common): number => {\n\tconst accessListStorageKeyCost = common.param('gasPrices', 'accessListStorageKeyCost');\n\tconst accessListAddressCost = common.param('gasPrices', 'accessListAddressCost');\n\n\tlet slots = 0;\n\t// eslint-disable-next-line @typescript-eslint/prefer-for-of\n\tfor (let index = 0; index < accessList.length; index += 1) {\n\t\tconst item = accessList[index];\n\t\tconst storageSlots = item[1];\n\t\tslots += storageSlots.length;\n\t}\n\n\tconst addresses = accessList.length;\n\treturn addresses * Number(accessListAddressCost) + slots * Number(accessListStorageKeyCost);\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}