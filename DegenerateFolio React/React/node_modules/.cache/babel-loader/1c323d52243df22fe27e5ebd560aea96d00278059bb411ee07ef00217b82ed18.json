{"ast":null,"code":"import { map, of } from 'rxjs';\nimport { BN_ZERO } from '@polkadot/util';\nimport { memo } from '../util/index.js';\nimport { filterCachedEras, getEraMultiCache, setEraMultiCache } from './cache.js';\nimport { erasHistoricApply, filterEras } from './util.js';\nconst CACHE_KEY = 'eraPoints';\nfunction mapValidators(_ref) {\n  let {\n    individual\n  } = _ref;\n  return [...individual.entries()].filter(_ref2 => {\n    let [, points] = _ref2;\n    return points.gt(BN_ZERO);\n  }).reduce((result, _ref3) => {\n    let [validatorId, points] = _ref3;\n    result[validatorId.toString()] = points;\n    return result;\n  }, {});\n}\nfunction mapPoints(eras, points) {\n  return eras.map((era, index) => ({\n    era,\n    eraPoints: points[index].total,\n    validators: mapValidators(points[index])\n  }));\n}\nexport function _erasPoints(instanceId, api) {\n  return memo(instanceId, (eras, withActive) => {\n    if (!eras.length) {\n      return of([]);\n    }\n    const cached = getEraMultiCache(CACHE_KEY, eras, withActive);\n    const remaining = filterEras(eras, cached);\n    return !remaining.length ? of(cached) : api.query.staking.erasRewardPoints.multi(remaining).pipe(map(p => filterCachedEras(eras, cached, setEraMultiCache(CACHE_KEY, withActive, mapPoints(remaining, p)))));\n  });\n}\nexport const erasPoints = /*#__PURE__*/erasHistoricApply('_erasPoints');","map":{"version":3,"names":["map","of","BN_ZERO","memo","filterCachedEras","getEraMultiCache","setEraMultiCache","erasHistoricApply","filterEras","CACHE_KEY","mapValidators","_ref","individual","entries","filter","_ref2","points","gt","reduce","result","_ref3","validatorId","toString","mapPoints","eras","era","index","eraPoints","total","validators","_erasPoints","instanceId","api","withActive","length","cached","remaining","query","staking","erasRewardPoints","multi","pipe","p","erasPoints"],"sources":["/home/ryoitsu/Documents/test/react-todo-app/node_modules/@polkadot/api-derive/staking/erasPoints.js"],"sourcesContent":["import { map, of } from 'rxjs';\nimport { BN_ZERO } from '@polkadot/util';\nimport { memo } from '../util/index.js';\nimport { filterCachedEras, getEraMultiCache, setEraMultiCache } from './cache.js';\nimport { erasHistoricApply, filterEras } from './util.js';\nconst CACHE_KEY = 'eraPoints';\nfunction mapValidators({ individual }) {\n    return [...individual.entries()]\n        .filter(([, points]) => points.gt(BN_ZERO))\n        .reduce((result, [validatorId, points]) => {\n        result[validatorId.toString()] = points;\n        return result;\n    }, {});\n}\nfunction mapPoints(eras, points) {\n    return eras.map((era, index) => ({\n        era,\n        eraPoints: points[index].total,\n        validators: mapValidators(points[index])\n    }));\n}\nexport function _erasPoints(instanceId, api) {\n    return memo(instanceId, (eras, withActive) => {\n        if (!eras.length) {\n            return of([]);\n        }\n        const cached = getEraMultiCache(CACHE_KEY, eras, withActive);\n        const remaining = filterEras(eras, cached);\n        return !remaining.length\n            ? of(cached)\n            : api.query.staking.erasRewardPoints.multi(remaining).pipe(map((p) => filterCachedEras(eras, cached, setEraMultiCache(CACHE_KEY, withActive, mapPoints(remaining, p)))));\n    });\n}\nexport const erasPoints = /*#__PURE__*/ erasHistoricApply('_erasPoints');\n"],"mappings":"AAAA,SAASA,GAAG,EAAEC,EAAE,QAAQ,MAAM;AAC9B,SAASC,OAAO,QAAQ,gBAAgB;AACxC,SAASC,IAAI,QAAQ,kBAAkB;AACvC,SAASC,gBAAgB,EAAEC,gBAAgB,EAAEC,gBAAgB,QAAQ,YAAY;AACjF,SAASC,iBAAiB,EAAEC,UAAU,QAAQ,WAAW;AACzD,MAAMC,SAAS,GAAG,WAAW;AAC7B,SAASC,aAAaA,CAAAC,IAAA,EAAiB;EAAA,IAAhB;IAAEC;EAAW,CAAC,GAAAD,IAAA;EACjC,OAAO,CAAC,GAAGC,UAAU,CAACC,OAAO,CAAC,CAAC,CAAC,CAC3BC,MAAM,CAACC,KAAA;IAAA,IAAC,GAAGC,MAAM,CAAC,GAAAD,KAAA;IAAA,OAAKC,MAAM,CAACC,EAAE,CAACf,OAAO,CAAC;EAAA,EAAC,CAC1CgB,MAAM,CAAC,CAACC,MAAM,EAAAC,KAAA,KAA4B;IAAA,IAA1B,CAACC,WAAW,EAAEL,MAAM,CAAC,GAAAI,KAAA;IACtCD,MAAM,CAACE,WAAW,CAACC,QAAQ,CAAC,CAAC,CAAC,GAAGN,MAAM;IACvC,OAAOG,MAAM;EACjB,CAAC,EAAE,CAAC,CAAC,CAAC;AACV;AACA,SAASI,SAASA,CAACC,IAAI,EAAER,MAAM,EAAE;EAC7B,OAAOQ,IAAI,CAACxB,GAAG,CAAC,CAACyB,GAAG,EAAEC,KAAK,MAAM;IAC7BD,GAAG;IACHE,SAAS,EAAEX,MAAM,CAACU,KAAK,CAAC,CAACE,KAAK;IAC9BC,UAAU,EAAEnB,aAAa,CAACM,MAAM,CAACU,KAAK,CAAC;EAC3C,CAAC,CAAC,CAAC;AACP;AACA,OAAO,SAASI,WAAWA,CAACC,UAAU,EAAEC,GAAG,EAAE;EACzC,OAAO7B,IAAI,CAAC4B,UAAU,EAAE,CAACP,IAAI,EAAES,UAAU,KAAK;IAC1C,IAAI,CAACT,IAAI,CAACU,MAAM,EAAE;MACd,OAAOjC,EAAE,CAAC,EAAE,CAAC;IACjB;IACA,MAAMkC,MAAM,GAAG9B,gBAAgB,CAACI,SAAS,EAAEe,IAAI,EAAES,UAAU,CAAC;IAC5D,MAAMG,SAAS,GAAG5B,UAAU,CAACgB,IAAI,EAAEW,MAAM,CAAC;IAC1C,OAAO,CAACC,SAAS,CAACF,MAAM,GAClBjC,EAAE,CAACkC,MAAM,CAAC,GACVH,GAAG,CAACK,KAAK,CAACC,OAAO,CAACC,gBAAgB,CAACC,KAAK,CAACJ,SAAS,CAAC,CAACK,IAAI,CAACzC,GAAG,CAAE0C,CAAC,IAAKtC,gBAAgB,CAACoB,IAAI,EAAEW,MAAM,EAAE7B,gBAAgB,CAACG,SAAS,EAAEwB,UAAU,EAAEV,SAAS,CAACa,SAAS,EAAEM,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;EAChL,CAAC,CAAC;AACN;AACA,OAAO,MAAMC,UAAU,GAAG,aAAcpC,iBAAiB,CAAC,aAAa,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}