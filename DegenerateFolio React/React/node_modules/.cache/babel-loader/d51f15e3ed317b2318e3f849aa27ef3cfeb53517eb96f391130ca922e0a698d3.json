{"ast":null,"code":"import { Container, UPDATE_COLOR, UPDATE_BLEND, UPDATE_VISIBLE } from '../Container.mjs';\nimport { mixColors } from './mixColors.mjs';\n\"use strict\";\nconst tempContainer = new Container();\nfunction updateRenderGroupTransforms(renderGroup, updateChildRenderGroups = false) {\n  updateRenderGroupTransform(renderGroup);\n  const childrenToUpdate = renderGroup.childrenToUpdate;\n  const updateTick = renderGroup.updateTick++;\n  for (const j in childrenToUpdate) {\n    const childrenAtDepth = childrenToUpdate[j];\n    const list = childrenAtDepth.list;\n    const index = childrenAtDepth.index;\n    for (let i = 0; i < index; i++) {\n      const child = list[i];\n      if (child.parentRenderGroup === renderGroup) {\n        updateTransformAndChildren(child, updateTick, 0);\n      }\n    }\n    childrenAtDepth.index = 0;\n  }\n  if (updateChildRenderGroups) {\n    for (let i = 0; i < renderGroup.renderGroupChildren.length; i++) {\n      updateRenderGroupTransforms(renderGroup.renderGroupChildren[i], updateChildRenderGroups);\n    }\n  }\n}\nfunction updateRenderGroupTransform(renderGroup) {\n  const root = renderGroup.root;\n  let worldAlpha;\n  if (renderGroup.renderGroupParent) {\n    const renderGroupParent = renderGroup.renderGroupParent;\n    renderGroup.worldTransform.appendFrom(root.relativeGroupTransform, renderGroupParent.worldTransform);\n    renderGroup.worldColor = mixColors(root.groupColor, renderGroupParent.worldColor);\n    worldAlpha = root.groupAlpha * renderGroupParent.worldAlpha;\n  } else {\n    renderGroup.worldTransform.copyFrom(root.localTransform);\n    renderGroup.worldColor = root.localColor;\n    worldAlpha = root.localAlpha;\n  }\n  worldAlpha = worldAlpha < 0 ? 0 : worldAlpha > 1 ? 1 : worldAlpha;\n  renderGroup.worldAlpha = worldAlpha;\n  renderGroup.worldColorAlpha = renderGroup.worldColor + ((worldAlpha * 255 | 0) << 24);\n}\nfunction updateTransformAndChildren(container, updateTick, updateFlags) {\n  if (updateTick === container.updateTick) return;\n  container.updateTick = updateTick;\n  container.didChange = false;\n  const localTransform = container.localTransform;\n  container.updateLocalTransform();\n  const parent = container.parent;\n  if (parent && !parent.renderGroup) {\n    updateFlags = updateFlags | container._updateFlags;\n    container.relativeGroupTransform.appendFrom(localTransform, parent.relativeGroupTransform);\n    if (updateFlags) {\n      updateColorBlendVisibility(container, parent, updateFlags);\n    }\n  } else {\n    updateFlags = container._updateFlags;\n    container.relativeGroupTransform.copyFrom(localTransform);\n    if (updateFlags) {\n      updateColorBlendVisibility(container, tempContainer, updateFlags);\n    }\n  }\n  if (!container.renderGroup) {\n    const children = container.children;\n    const length = children.length;\n    for (let i = 0; i < length; i++) {\n      updateTransformAndChildren(children[i], updateTick, updateFlags);\n    }\n    const renderGroup = container.parentRenderGroup;\n    if (container.renderPipeId && !renderGroup.structureDidChange) {\n      renderGroup.updateRenderable(container);\n    }\n  }\n}\nfunction updateColorBlendVisibility(container, parent, updateFlags) {\n  if (updateFlags & UPDATE_COLOR) {\n    container.groupColor = mixColors(container.localColor, parent.groupColor);\n    let groupAlpha = container.localAlpha * parent.groupAlpha;\n    groupAlpha = groupAlpha < 0 ? 0 : groupAlpha > 1 ? 1 : groupAlpha;\n    container.groupAlpha = groupAlpha;\n    container.groupColorAlpha = container.groupColor + ((groupAlpha * 255 | 0) << 24);\n  }\n  if (updateFlags & UPDATE_BLEND) {\n    container.groupBlendMode = container.localBlendMode === \"inherit\" ? parent.groupBlendMode : container.localBlendMode;\n  }\n  if (updateFlags & UPDATE_VISIBLE) {\n    container.globalDisplayStatus = container.localDisplayStatus & parent.globalDisplayStatus;\n  }\n  container._updateFlags = 0;\n}\nexport { updateRenderGroupTransform, updateRenderGroupTransforms, updateTransformAndChildren };","map":{"version":3,"names":["tempContainer","Container","updateRenderGroupTransforms","renderGroup","updateChildRenderGroups","updateRenderGroupTransform","childrenToUpdate","updateTick","j","childrenAtDepth","list","index","i","child","parentRenderGroup","updateTransformAndChildren","renderGroupChildren","length","root","worldAlpha","renderGroupParent","worldTransform","appendFrom","relativeGroupTransform","worldColor","mixColors","groupColor","groupAlpha","copyFrom","localTransform","localColor","localAlpha","worldColorAlpha","container","updateFlags","didChange","updateLocalTransform","parent","_updateFlags","updateColorBlendVisibility","children","renderPipeId","structureDidChange","updateRenderable","UPDATE_COLOR","groupColorAlpha","UPDATE_BLEND","groupBlendMode","localBlendMode","UPDATE_VISIBLE","globalDisplayStatus","localDisplayStatus"],"sources":["/home/ryoitsu/node_modules/pixi.js/src/scene/container/utils/updateRenderGroupTransforms.ts"],"sourcesContent":["import { Container, UPDATE_BLEND, UPDATE_COLOR, UPDATE_VISIBLE } from '../Container';\nimport { mixColors } from './mixColors';\n\nimport type { RenderGroup } from '../RenderGroup';\n\nconst tempContainer = new Container();\n\nexport function updateRenderGroupTransforms(renderGroup: RenderGroup, updateChildRenderGroups = false)\n{\n    updateRenderGroupTransform(renderGroup);\n\n    const childrenToUpdate = renderGroup.childrenToUpdate;\n\n    const updateTick = renderGroup.updateTick++;\n\n    for (const j in childrenToUpdate)\n    {\n        const childrenAtDepth = childrenToUpdate[j];\n\n        const list = childrenAtDepth.list;\n        const index = childrenAtDepth.index;\n\n        for (let i = 0; i < index; i++)\n        {\n            const child = list[i];\n\n            if (child.parentRenderGroup === renderGroup)\n            {\n                updateTransformAndChildren(child, updateTick, 0);\n            }\n        }\n\n        childrenAtDepth.index = 0;\n    }\n\n    if (updateChildRenderGroups)\n    {\n        for (let i = 0; i < renderGroup.renderGroupChildren.length; i++)\n        {\n            updateRenderGroupTransforms(renderGroup.renderGroupChildren[i], updateChildRenderGroups);\n        }\n    }\n}\n\nexport function updateRenderGroupTransform(renderGroup: RenderGroup)\n{\n    const root = renderGroup.root;\n\n    let worldAlpha;\n\n    if (renderGroup.renderGroupParent)\n    {\n        const renderGroupParent = renderGroup.renderGroupParent;\n\n        renderGroup.worldTransform.appendFrom(\n            root.relativeGroupTransform,\n            renderGroupParent.worldTransform,\n        );\n\n        renderGroup.worldColor = mixColors(\n            root.groupColor,\n            renderGroupParent.worldColor,\n        );\n\n        worldAlpha = root.groupAlpha * renderGroupParent.worldAlpha;\n    }\n    else\n    {\n        renderGroup.worldTransform.copyFrom(root.localTransform);\n        renderGroup.worldColor = root.localColor;\n        worldAlpha = root.localAlpha;\n    }\n\n    // eslint-disable-next-line no-nested-ternary\n    worldAlpha = worldAlpha < 0 ? 0 : (worldAlpha > 1 ? 1 : worldAlpha);\n    renderGroup.worldAlpha = worldAlpha;\n\n    renderGroup.worldColorAlpha = renderGroup.worldColor\n            + (((worldAlpha * 255) | 0) << 24);\n}\n\nexport function updateTransformAndChildren(container: Container, updateTick: number, updateFlags: number)\n{\n    if (updateTick === container.updateTick) return;\n    container.updateTick = updateTick;\n\n    container.didChange = false;\n\n    const localTransform = container.localTransform;\n\n    container.updateLocalTransform();\n\n    const parent = container.parent;\n\n    if ((parent && !parent.renderGroup))\n    {\n        updateFlags = updateFlags | container._updateFlags;\n\n        container.relativeGroupTransform.appendFrom(\n            localTransform,\n            parent.relativeGroupTransform,\n        );\n\n        if (updateFlags)\n        {\n            updateColorBlendVisibility(container, parent, updateFlags);\n        }\n    }\n    else\n    {\n        updateFlags = container._updateFlags;\n\n        container.relativeGroupTransform.copyFrom(localTransform);\n\n        if (updateFlags)\n        {\n            updateColorBlendVisibility(container, tempContainer, updateFlags);\n        }\n    }\n\n    // don't update children if its a layer..\n    if (!container.renderGroup)\n    {\n        const children = container.children;\n        const length = children.length;\n\n        for (let i = 0; i < length; i++)\n        {\n            updateTransformAndChildren(children[i], updateTick, updateFlags);\n        }\n\n        const renderGroup = container.parentRenderGroup;\n\n        if (container.renderPipeId && !renderGroup.structureDidChange)\n        {\n            renderGroup.updateRenderable(container);\n        }\n    }\n}\n\nfunction updateColorBlendVisibility(\n    container: Container,\n    parent: Container,\n    updateFlags: number,\n): void\n{\n    if (updateFlags & UPDATE_COLOR)\n    {\n        container.groupColor = mixColors(\n            container.localColor,\n            parent.groupColor\n        );\n\n        let groupAlpha = container.localAlpha * parent.groupAlpha;\n\n        // eslint-disable-next-line no-nested-ternary\n        groupAlpha = groupAlpha < 0 ? 0 : (groupAlpha > 1 ? 1 : groupAlpha);\n\n        container.groupAlpha = groupAlpha;\n        container.groupColorAlpha = container.groupColor + (((groupAlpha * 255) | 0) << 24);\n    }\n\n    if (updateFlags & UPDATE_BLEND)\n    {\n        container.groupBlendMode = container.localBlendMode === 'inherit' ? parent.groupBlendMode : container.localBlendMode;\n    }\n\n    if (updateFlags & UPDATE_VISIBLE)\n    {\n        container.globalDisplayStatus = container.localDisplayStatus & parent.globalDisplayStatus;\n    }\n\n    container._updateFlags = 0;\n}\n\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}