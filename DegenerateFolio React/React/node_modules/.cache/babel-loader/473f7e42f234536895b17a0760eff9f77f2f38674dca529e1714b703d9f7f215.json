{"ast":null,"code":"\"use strict\";\n\n/*\nThis file is part of web3.js.\n\nweb3.js is free software: you can redistribute it and/or modify\nit under the terms of the GNU Lesser General Public License as published by\nthe Free Software Foundation, either version 3 of the License, or\n(at your option) any later version.\n\nweb3.js is distributed in the hope that it will be useful,\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\nGNU Lesser General Public License for more details.\n\nYou should have received a copy of the GNU Lesser General Public License\nalong with web3.js.  If not, see <http://www.gnu.org/licenses/>.\n*/\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.decodeEventABI = void 0;\nconst web3_utils_1 = require(\"web3-utils\");\nconst web3_types_1 = require(\"web3-types\");\nconst web3_eth_abi_1 = require(\"web3-eth-abi\");\nconst schemas_js_1 = require(\"../schemas.js\");\nconst constants_js_1 = require(\"../constants.js\");\nconst decodeEventABI = function (event, data, jsonInterface) {\n  let returnFormat = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : web3_types_1.DEFAULT_RETURN_FORMAT;\n  var _a, _b, _c, _d, _e;\n  let modifiedEvent = Object.assign({}, event);\n  const result = (0, web3_utils_1.format)(schemas_js_1.logSchema, data, returnFormat);\n  // if allEvents get the right event\n  if ([constants_js_1.ALL_EVENTS, 'allEvents'].includes(modifiedEvent.name)) {\n    const matchedEvent = jsonInterface.find(j => j.signature === data.topics[0]);\n    if (matchedEvent) {\n      modifiedEvent = matchedEvent;\n    } else {\n      modifiedEvent = {\n        anonymous: true\n      };\n    }\n  }\n  // create empty inputs if none are present (e.g. anonymous events on allEvents)\n  modifiedEvent.inputs = (_b = (_a = modifiedEvent.inputs) !== null && _a !== void 0 ? _a : event.inputs) !== null && _b !== void 0 ? _b : [];\n  // Handle case where an event signature shadows the current ABI with non-identical\n  // arg indexing. If # of topics doesn't match, event is anon.\n  if (!modifiedEvent.anonymous) {\n    let indexedInputs = 0;\n    ((_c = modifiedEvent.inputs) !== null && _c !== void 0 ? _c : []).forEach(input => {\n      if (input.indexed) {\n        indexedInputs += 1;\n      }\n    });\n    if (indexedInputs > 0 && (data === null || data === void 0 ? void 0 : data.topics) && (data === null || data === void 0 ? void 0 : data.topics.length) !== indexedInputs + 1) {\n      // checks if event is anonymous\n      modifiedEvent = Object.assign(Object.assign({}, modifiedEvent), {\n        anonymous: true,\n        inputs: []\n      });\n    }\n  }\n  const argTopics = modifiedEvent.anonymous ? data.topics : ((_d = data.topics) !== null && _d !== void 0 ? _d : []).slice(1);\n  return Object.assign(Object.assign({}, result), {\n    returnValues: (0, web3_eth_abi_1.decodeLog)([...((_e = modifiedEvent.inputs) !== null && _e !== void 0 ? _e : [])], data.data, argTopics),\n    event: modifiedEvent.name,\n    signature: modifiedEvent.anonymous || !data.topics || data.topics.length === 0 || !data.topics[0] ? undefined : data.topics[0],\n    raw: {\n      data: data.data,\n      topics: data.topics\n    }\n  });\n};\nexports.decodeEventABI = decodeEventABI;","map":{"version":3,"names":["web3_utils_1","require","web3_types_1","web3_eth_abi_1","schemas_js_1","constants_js_1","decodeEventABI","event","data","jsonInterface","returnFormat","arguments","length","undefined","DEFAULT_RETURN_FORMAT","modifiedEvent","Object","assign","result","format","logSchema","ALL_EVENTS","includes","name","matchedEvent","find","j","signature","topics","anonymous","inputs","_b","_a","indexedInputs","_c","forEach","input","indexed","argTopics","_d","slice","returnValues","decodeLog","_e","raw","exports"],"sources":["/home/ryoitsu/Documents/test/react-todo-app/node_modules/web3-eth/src/utils/decoding.ts"],"sourcesContent":["ï»¿/*\nThis file is part of web3.js.\n\nweb3.js is free software: you can redistribute it and/or modify\nit under the terms of the GNU Lesser General Public License as published by\nthe Free Software Foundation, either version 3 of the License, or\n(at your option) any later version.\n\nweb3.js is distributed in the hope that it will be useful,\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\nGNU Lesser General Public License for more details.\n\nYou should have received a copy of the GNU Lesser General Public License\nalong with web3.js.  If not, see <http://www.gnu.org/licenses/>.\n*/\n\nimport { format } from 'web3-utils';\n\nimport {\n\tAbiEventFragment,\n\tLogsInput,\n\tDataFormat,\n\tDEFAULT_RETURN_FORMAT,\n\tEventLog,\n\tContractAbiWithSignature,\n} from 'web3-types';\n\nimport { decodeLog } from 'web3-eth-abi';\n\nimport { logSchema } from '../schemas.js';\nimport { ALL_EVENTS } from '../constants.js';\n\nexport const decodeEventABI = (\n\tevent: AbiEventFragment & { signature: string },\n\tdata: LogsInput,\n\tjsonInterface: ContractAbiWithSignature,\n\treturnFormat: DataFormat = DEFAULT_RETURN_FORMAT,\n): EventLog => {\n\tlet modifiedEvent = { ...event };\n\n\tconst result = format(logSchema, data, returnFormat);\n\n\t// if allEvents get the right event\n\tif ([ALL_EVENTS, 'allEvents'].includes(modifiedEvent.name)) {\n\t\tconst matchedEvent = jsonInterface.find(j => j.signature === data.topics[0]);\n\t\tif (matchedEvent) {\n\t\t\tmodifiedEvent = matchedEvent as AbiEventFragment & { signature: string };\n\t\t} else {\n\t\t\tmodifiedEvent = { anonymous: true } as unknown as AbiEventFragment & {\n\t\t\t\tsignature: string;\n\t\t\t};\n\t\t}\n\t}\n\n\t// create empty inputs if none are present (e.g. anonymous events on allEvents)\n\tmodifiedEvent.inputs = modifiedEvent.inputs ?? event.inputs ?? [];\n\n\t// Handle case where an event signature shadows the current ABI with non-identical\n\t// arg indexing. If # of topics doesn't match, event is anon.\n\tif (!modifiedEvent.anonymous) {\n\t\tlet indexedInputs = 0;\n\t\t(modifiedEvent.inputs ?? []).forEach(input => {\n\t\t\tif (input.indexed) {\n\t\t\t\tindexedInputs += 1;\n\t\t\t}\n\t\t});\n\n\t\tif (indexedInputs > 0 && data?.topics && data?.topics.length !== indexedInputs + 1) {\n\t\t\t// checks if event is anonymous\n\t\t\tmodifiedEvent = {\n\t\t\t\t...modifiedEvent,\n\t\t\t\tanonymous: true,\n\t\t\t\tinputs: [],\n\t\t\t};\n\t\t}\n\t}\n\n\tconst argTopics = modifiedEvent.anonymous ? data.topics : (data.topics ?? []).slice(1);\n\n\treturn {\n\t\t...result,\n\t\treturnValues: decodeLog([...(modifiedEvent.inputs ?? [])], data.data, argTopics),\n\t\tevent: modifiedEvent.name,\n\t\tsignature:\n\t\t\tmodifiedEvent.anonymous || !data.topics || data.topics.length === 0 || !data.topics[0]\n\t\t\t\t? undefined\n\t\t\t\t: data.topics[0],\n\n\t\traw: {\n\t\t\tdata: data.data,\n\t\t\ttopics: data.topics,\n\t\t},\n\t};\n};\n"],"mappings":";;AAAA;;;;;;;;;;;;;;;;;;;;AAiBA,MAAAA,YAAA,GAAAC,OAAA;AAEA,MAAAC,YAAA,GAAAD,OAAA;AASA,MAAAE,cAAA,GAAAF,OAAA;AAEA,MAAAG,YAAA,GAAAH,OAAA;AACA,MAAAI,cAAA,GAAAJ,OAAA;AAEO,MAAMK,cAAc,GAAG,SAAAA,CAC7BC,KAA+C,EAC/CC,IAAe,EACfC,aAAuC,EAE1B;EAAA,IADbC,YAAA,GAAAC,SAAA,CAAAC,MAAA,QAAAD,SAAA,QAAAE,SAAA,GAAAF,SAAA,MAA2BT,YAAA,CAAAY,qBAAqB;;EAEhD,IAAIC,aAAa,GAAAC,MAAA,CAAAC,MAAA,KAAQV,KAAK,CAAE;EAEhC,MAAMW,MAAM,GAAG,IAAAlB,YAAA,CAAAmB,MAAM,EAACf,YAAA,CAAAgB,SAAS,EAAEZ,IAAI,EAAEE,YAAY,CAAC;EAEpD;EACA,IAAI,CAACL,cAAA,CAAAgB,UAAU,EAAE,WAAW,CAAC,CAACC,QAAQ,CAACP,aAAa,CAACQ,IAAI,CAAC,EAAE;IAC3D,MAAMC,YAAY,GAAGf,aAAa,CAACgB,IAAI,CAACC,CAAC,IAAIA,CAAC,CAACC,SAAS,KAAKnB,IAAI,CAACoB,MAAM,CAAC,CAAC,CAAC,CAAC;IAC5E,IAAIJ,YAAY,EAAE;MACjBT,aAAa,GAAGS,YAAwD;KACxE,MAAM;MACNT,aAAa,GAAG;QAAEc,SAAS,EAAE;MAAI,CAEhC;;;EAIH;EACAd,aAAa,CAACe,MAAM,GAAG,CAAAC,EAAA,IAAAC,EAAA,GAAAjB,aAAa,CAACe,MAAM,cAAAE,EAAA,cAAAA,EAAA,GAAIzB,KAAK,CAACuB,MAAM,cAAAC,EAAA,cAAAA,EAAA,GAAI,EAAE;EAEjE;EACA;EACA,IAAI,CAAChB,aAAa,CAACc,SAAS,EAAE;IAC7B,IAAII,aAAa,GAAG,CAAC;IACrB,CAAC,CAAAC,EAAA,GAAAnB,aAAa,CAACe,MAAM,cAAAI,EAAA,cAAAA,EAAA,GAAI,EAAE,EAAEC,OAAO,CAACC,KAAK,IAAG;MAC5C,IAAIA,KAAK,CAACC,OAAO,EAAE;QAClBJ,aAAa,IAAI,CAAC;;IAEpB,CAAC,CAAC;IAEF,IAAIA,aAAa,GAAG,CAAC,KAAIzB,IAAI,aAAJA,IAAI,uBAAJA,IAAI,CAAEoB,MAAM,KAAI,CAAApB,IAAI,aAAJA,IAAI,uBAAJA,IAAI,CAAEoB,MAAM,CAAChB,MAAM,MAAKqB,aAAa,GAAG,CAAC,EAAE;MACnF;MACAlB,aAAa,GAAAC,MAAA,CAAAC,MAAA,CAAAD,MAAA,CAAAC,MAAA,KACTF,aAAa;QAChBc,SAAS,EAAE,IAAI;QACfC,MAAM,EAAE;MAAE,EACV;;;EAIH,MAAMQ,SAAS,GAAGvB,aAAa,CAACc,SAAS,GAAGrB,IAAI,CAACoB,MAAM,GAAG,CAAC,CAAAW,EAAA,GAAA/B,IAAI,CAACoB,MAAM,cAAAW,EAAA,cAAAA,EAAA,GAAI,EAAE,EAAEC,KAAK,CAAC,CAAC,CAAC;EAEtF,OAAAxB,MAAA,CAAAC,MAAA,CAAAD,MAAA,CAAAC,MAAA,KACIC,MAAM;IACTuB,YAAY,EAAE,IAAAtC,cAAA,CAAAuC,SAAS,EAAC,CAAC,IAAI,CAAAC,EAAA,GAAA5B,aAAa,CAACe,MAAM,cAAAa,EAAA,cAAAA,EAAA,GAAI,EAAE,CAAC,CAAC,EAAEnC,IAAI,CAACA,IAAI,EAAE8B,SAAS,CAAC;IAChF/B,KAAK,EAAEQ,aAAa,CAACQ,IAAI;IACzBI,SAAS,EACRZ,aAAa,CAACc,SAAS,IAAI,CAACrB,IAAI,CAACoB,MAAM,IAAIpB,IAAI,CAACoB,MAAM,CAAChB,MAAM,KAAK,CAAC,IAAI,CAACJ,IAAI,CAACoB,MAAM,CAAC,CAAC,CAAC,GACnFf,SAAS,GACTL,IAAI,CAACoB,MAAM,CAAC,CAAC,CAAC;IAElBgB,GAAG,EAAE;MACJpC,IAAI,EAAEA,IAAI,CAACA,IAAI;MACfoB,MAAM,EAAEpB,IAAI,CAACoB;;EACb;AAEH,CAAC;AA7DYiB,OAAA,CAAAvC,cAAc,GAAAA,cAAA","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}