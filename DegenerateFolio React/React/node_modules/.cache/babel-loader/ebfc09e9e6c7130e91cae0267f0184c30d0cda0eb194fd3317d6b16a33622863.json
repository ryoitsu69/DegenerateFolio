{"ast":null,"code":"import { combineLatest, map, of, switchMap } from 'rxjs';\nimport { objectSpread } from '@polkadot/util';\nimport { memo } from '../util/index.js';\nfunction withProgressField(field) {\n  return (instanceId, api) => memo(instanceId, () => api.derive.session.progress().pipe(map(info => info[field])));\n}\nfunction createDerive(api, info, [currentSlot, epochIndex, epochOrGenesisStartSlot, activeEraStartSessionIndex]) {\n  const epochStartSlot = epochIndex.mul(info.sessionLength).iadd(epochOrGenesisStartSlot);\n  const sessionProgress = currentSlot.sub(epochStartSlot);\n  const eraProgress = info.currentIndex.sub(activeEraStartSessionIndex).imul(info.sessionLength).iadd(sessionProgress);\n  return objectSpread({\n    eraProgress: api.registry.createType('BlockNumber', eraProgress),\n    sessionProgress: api.registry.createType('BlockNumber', sessionProgress)\n  }, info);\n}\nfunction queryAura(api) {\n  return api.derive.session.info().pipe(map(info => objectSpread({\n    eraProgress: api.registry.createType('BlockNumber'),\n    sessionProgress: api.registry.createType('BlockNumber')\n  }, info)));\n}\nfunction queryBabe(api) {\n  return api.derive.session.info().pipe(switchMap(info => combineLatest([of(info),\n  // we may have no staking, but have babe (permissioned)\n  api.query.staking?.erasStartSessionIndex ? api.queryMulti([api.query.babe.currentSlot, api.query.babe.epochIndex, api.query.babe.genesisSlot, [api.query.staking.erasStartSessionIndex, info.activeEra]]) : api.queryMulti([api.query.babe.currentSlot, api.query.babe.epochIndex, api.query.babe.genesisSlot])])), map(([info, [currentSlot, epochIndex, genesisSlot, optStartIndex]]) => [info, [currentSlot, epochIndex, genesisSlot, optStartIndex && optStartIndex.isSome ? optStartIndex.unwrap() : api.registry.createType('SessionIndex', 1)]]));\n}\n/**\n * @description Retrieves all the session and era query and calculates specific values on it as the length of the session and eras\n */\nexport function progress(instanceId, api) {\n  return memo(instanceId, () => api.query.babe ? queryBabe(api).pipe(map(([info, slots]) => createDerive(api, info, slots))) : queryAura(api));\n}\nexport const eraLength = /*#__PURE__*/withProgressField('eraLength');\nexport const eraProgress = /*#__PURE__*/withProgressField('eraProgress');\nexport const sessionProgress = /*#__PURE__*/withProgressField('sessionProgress');","map":{"version":3,"names":["combineLatest","map","of","switchMap","objectSpread","memo","withProgressField","field","instanceId","api","derive","session","progress","pipe","info","createDerive","currentSlot","epochIndex","epochOrGenesisStartSlot","activeEraStartSessionIndex","epochStartSlot","mul","sessionLength","iadd","sessionProgress","sub","eraProgress","currentIndex","imul","registry","createType","queryAura","queryBabe","query","staking","erasStartSessionIndex","queryMulti","babe","genesisSlot","activeEra","optStartIndex","isSome","unwrap","slots","eraLength"],"sources":["/home/ryoitsu/Documents/test/react-todo-app/node_modules/@polkadot/api-derive/session/progress.js"],"sourcesContent":["import { combineLatest, map, of, switchMap } from 'rxjs';\nimport { objectSpread } from '@polkadot/util';\nimport { memo } from '../util/index.js';\nfunction withProgressField(field) {\n    return (instanceId, api) => memo(instanceId, () => api.derive.session.progress().pipe(map((info) => info[field])));\n}\nfunction createDerive(api, info, [currentSlot, epochIndex, epochOrGenesisStartSlot, activeEraStartSessionIndex]) {\n    const epochStartSlot = epochIndex.mul(info.sessionLength).iadd(epochOrGenesisStartSlot);\n    const sessionProgress = currentSlot.sub(epochStartSlot);\n    const eraProgress = info.currentIndex.sub(activeEraStartSessionIndex).imul(info.sessionLength).iadd(sessionProgress);\n    return objectSpread({\n        eraProgress: api.registry.createType('BlockNumber', eraProgress),\n        sessionProgress: api.registry.createType('BlockNumber', sessionProgress)\n    }, info);\n}\nfunction queryAura(api) {\n    return api.derive.session.info().pipe(map((info) => objectSpread({\n        eraProgress: api.registry.createType('BlockNumber'),\n        sessionProgress: api.registry.createType('BlockNumber')\n    }, info)));\n}\nfunction queryBabe(api) {\n    return api.derive.session.info().pipe(switchMap((info) => combineLatest([\n        of(info),\n        // we may have no staking, but have babe (permissioned)\n        api.query.staking?.erasStartSessionIndex\n            ? api.queryMulti([\n                api.query.babe.currentSlot,\n                api.query.babe.epochIndex,\n                api.query.babe.genesisSlot,\n                [api.query.staking.erasStartSessionIndex, info.activeEra]\n            ])\n            : api.queryMulti([\n                api.query.babe.currentSlot,\n                api.query.babe.epochIndex,\n                api.query.babe.genesisSlot\n            ])\n    ])), map(([info, [currentSlot, epochIndex, genesisSlot, optStartIndex]]) => [\n        info, [currentSlot, epochIndex, genesisSlot, optStartIndex && optStartIndex.isSome ? optStartIndex.unwrap() : api.registry.createType('SessionIndex', 1)]\n    ]));\n}\n/**\n * @description Retrieves all the session and era query and calculates specific values on it as the length of the session and eras\n */\nexport function progress(instanceId, api) {\n    return memo(instanceId, () => api.query.babe\n        ? queryBabe(api).pipe(map(([info, slots]) => createDerive(api, info, slots)))\n        : queryAura(api));\n}\nexport const eraLength = /*#__PURE__*/ withProgressField('eraLength');\nexport const eraProgress = /*#__PURE__*/ withProgressField('eraProgress');\nexport const sessionProgress = /*#__PURE__*/ withProgressField('sessionProgress');\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}