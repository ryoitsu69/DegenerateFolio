{"ast":null,"code":"import { map, of, switchMap } from 'rxjs';\nimport { BN_ZERO, isFunction } from '@polkadot/util';\nimport { firstMemo, memo } from '../util/index.js';\nimport { getImageHashBounded } from './util.js';\nfunction getUnrequestedTicket(status) {\n  return status.ticket || status.deposit;\n}\nfunction getRequestedTicket(status) {\n  return (status.maybeTicket || status.deposit).unwrapOrDefault();\n}\nfunction isDemocracyPreimage(api, imageOpt) {\n  return !!imageOpt && !api.query.democracy['dispatchQueue'];\n}\nfunction constructProposal(api, [bytes, proposer, balance, at]) {\n  let proposal;\n  try {\n    proposal = api.registry.createType('Call', bytes.toU8a(true));\n  } catch (error) {\n    console.error(error);\n  }\n  return {\n    at,\n    balance,\n    proposal,\n    proposer\n  };\n}\nfunction parseDemocracy(api, imageOpt) {\n  if (imageOpt.isNone) {\n    return;\n  }\n  if (isDemocracyPreimage(api, imageOpt)) {\n    const status = imageOpt.unwrap();\n    if (status.isMissing) {\n      return;\n    }\n    const {\n      data,\n      deposit,\n      provider,\n      since\n    } = status.asAvailable;\n    return constructProposal(api, [data, provider, deposit, since]);\n  }\n  return constructProposal(api, imageOpt.unwrap());\n}\nfunction parseImage(api, [proposalHash, status, bytes]) {\n  if (!status) {\n    return undefined;\n  }\n  const [proposer, balance] = status.isUnrequested ? getUnrequestedTicket(status.asUnrequested) : getRequestedTicket(status.asRequested);\n  let proposal;\n  if (bytes) {\n    try {\n      proposal = api.registry.createType('Call', bytes.toU8a(true));\n    } catch (error) {\n      console.error(error);\n    }\n  }\n  return {\n    at: BN_ZERO,\n    balance,\n    proposal,\n    proposalHash,\n    proposer\n  };\n}\nfunction getDemocracyImages(api, bounded) {\n  const hashes = bounded.map(b => getImageHashBounded(b));\n  return api.query.democracy['preimages'].multi(hashes).pipe(map(images => images.map(imageOpt => parseDemocracy(api, imageOpt))));\n}\nfunction getImages(api, bounded) {\n  const hashes = bounded.map(b => getImageHashBounded(b));\n  const bytesType = api.registry.lookup.getTypeDef(api.query.preimage.preimageFor.creator.meta.type.asMap.key).type;\n  return api.query.preimage.statusFor.multi(hashes).pipe(switchMap(optStatus => {\n    const statuses = optStatus.map(o => o.unwrapOr(null));\n    const keys = statuses.map((s, i) => s ? bytesType === 'H256'\n    // first generation\n    ? hashes[i]\n    // current generation (H256,u32)\n    : s.isRequested ? [hashes[i], s.asRequested.len.unwrapOr(0)] : [hashes[i], s.asUnrequested.len] : null).filter(p => !!p);\n    return api.query.preimage.preimageFor.multi(keys).pipe(map(optBytes => {\n      let ptr = -1;\n      return statuses.map((s, i) => s ? [hashes[i], s, optBytes[++ptr].unwrapOr(null)] : [hashes[i], null, null]).map(v => parseImage(api, v));\n    }));\n  }));\n}\nexport function preimages(instanceId, api) {\n  return memo(instanceId, hashes => hashes.length ? isFunction(api.query.democracy['preimages']) ? getDemocracyImages(api, hashes) : isFunction(api.query.preimage.preimageFor) ? getImages(api, hashes) : of([]) : of([]));\n}\nexport const preimage = /*#__PURE__*/firstMemo((api, hash) => api.derive.democracy.preimages([hash]));","map":{"version":3,"names":["map","of","switchMap","BN_ZERO","isFunction","firstMemo","memo","getImageHashBounded","getUnrequestedTicket","status","ticket","deposit","getRequestedTicket","maybeTicket","unwrapOrDefault","isDemocracyPreimage","api","imageOpt","query","democracy","constructProposal","bytes","proposer","balance","at","proposal","registry","createType","toU8a","error","console","parseDemocracy","isNone","unwrap","isMissing","data","provider","since","asAvailable","parseImage","proposalHash","undefined","isUnrequested","asUnrequested","asRequested","getDemocracyImages","bounded","hashes","b","multi","pipe","images","getImages","bytesType","lookup","getTypeDef","preimage","preimageFor","creator","meta","type","asMap","key","statusFor","optStatus","statuses","o","unwrapOr","keys","s","i","isRequested","len","filter","p","optBytes","ptr","v","preimages","instanceId","length","hash","derive"],"sources":["/home/ryoitsu/Documents/test/react-todo-app/node_modules/@polkadot/api-derive/democracy/preimages.js"],"sourcesContent":["import { map, of, switchMap } from 'rxjs';\nimport { BN_ZERO, isFunction } from '@polkadot/util';\nimport { firstMemo, memo } from '../util/index.js';\nimport { getImageHashBounded } from './util.js';\nfunction getUnrequestedTicket(status) {\n    return status.ticket || status.deposit;\n}\nfunction getRequestedTicket(status) {\n    return (status.maybeTicket || status.deposit).unwrapOrDefault();\n}\nfunction isDemocracyPreimage(api, imageOpt) {\n    return !!imageOpt && !api.query.democracy['dispatchQueue'];\n}\nfunction constructProposal(api, [bytes, proposer, balance, at]) {\n    let proposal;\n    try {\n        proposal = api.registry.createType('Call', bytes.toU8a(true));\n    }\n    catch (error) {\n        console.error(error);\n    }\n    return { at, balance, proposal, proposer };\n}\nfunction parseDemocracy(api, imageOpt) {\n    if (imageOpt.isNone) {\n        return;\n    }\n    if (isDemocracyPreimage(api, imageOpt)) {\n        const status = imageOpt.unwrap();\n        if (status.isMissing) {\n            return;\n        }\n        const { data, deposit, provider, since } = status.asAvailable;\n        return constructProposal(api, [data, provider, deposit, since]);\n    }\n    return constructProposal(api, imageOpt.unwrap());\n}\nfunction parseImage(api, [proposalHash, status, bytes]) {\n    if (!status) {\n        return undefined;\n    }\n    const [proposer, balance] = status.isUnrequested\n        ? getUnrequestedTicket(status.asUnrequested)\n        : getRequestedTicket(status.asRequested);\n    let proposal;\n    if (bytes) {\n        try {\n            proposal = api.registry.createType('Call', bytes.toU8a(true));\n        }\n        catch (error) {\n            console.error(error);\n        }\n    }\n    return { at: BN_ZERO, balance, proposal, proposalHash, proposer };\n}\nfunction getDemocracyImages(api, bounded) {\n    const hashes = bounded.map((b) => getImageHashBounded(b));\n    return api.query.democracy['preimages'].multi(hashes).pipe(map((images) => images.map((imageOpt) => parseDemocracy(api, imageOpt))));\n}\nfunction getImages(api, bounded) {\n    const hashes = bounded.map((b) => getImageHashBounded(b));\n    const bytesType = api.registry.lookup.getTypeDef(api.query.preimage.preimageFor.creator.meta.type.asMap.key).type;\n    return api.query.preimage.statusFor.multi(hashes).pipe(switchMap((optStatus) => {\n        const statuses = optStatus.map((o) => o.unwrapOr(null));\n        const keys = statuses\n            .map((s, i) => s\n            ? bytesType === 'H256'\n                // first generation\n                ? hashes[i]\n                // current generation (H256,u32)\n                : s.isRequested\n                    ? [hashes[i], s.asRequested.len.unwrapOr(0)]\n                    : [hashes[i], s.asUnrequested.len]\n            : null)\n            .filter((p) => !!p);\n        return api.query.preimage.preimageFor.multi(keys).pipe(map((optBytes) => {\n            let ptr = -1;\n            return statuses\n                .map((s, i) => s\n                ? [hashes[i], s, optBytes[++ptr].unwrapOr(null)]\n                : [hashes[i], null, null])\n                .map((v) => parseImage(api, v));\n        }));\n    }));\n}\nexport function preimages(instanceId, api) {\n    return memo(instanceId, (hashes) => hashes.length\n        ? isFunction(api.query.democracy['preimages'])\n            ? getDemocracyImages(api, hashes)\n            : isFunction(api.query.preimage.preimageFor)\n                ? getImages(api, hashes)\n                : of([])\n        : of([]));\n}\nexport const preimage = /*#__PURE__*/ firstMemo((api, hash) => api.derive.democracy.preimages([hash]));\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}