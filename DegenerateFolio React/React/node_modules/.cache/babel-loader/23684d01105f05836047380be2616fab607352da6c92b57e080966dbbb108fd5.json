{"ast":null,"code":"import { map, of, switchMap } from 'rxjs';\nimport { BN_ZERO, isUndefined } from '@polkadot/util';\nimport { memo } from '../util/index.js';\nconst LOCKUPS = [0, 1, 2, 4, 8, 16, 32];\nfunction parseEnd(api, vote, {\n  approved,\n  end\n}) {\n  return [end, approved.isTrue && vote.isAye || approved.isFalse && vote.isNay ? end.add((api.consts.democracy.voteLockingPeriod || api.consts.democracy.enactmentPeriod).muln(LOCKUPS[vote.conviction.index])) : BN_ZERO];\n}\nfunction parseLock(api, [referendumId, accountVote], referendum) {\n  const {\n    balance,\n    vote\n  } = accountVote.asStandard;\n  const [referendumEnd, unlockAt] = referendum.isFinished ? parseEnd(api, vote, referendum.asFinished) : [BN_ZERO, BN_ZERO];\n  return {\n    balance,\n    isDelegated: false,\n    isFinished: referendum.isFinished,\n    referendumEnd,\n    referendumId,\n    unlockAt,\n    vote\n  };\n}\nfunction delegateLocks(api, {\n  balance,\n  conviction,\n  target\n}) {\n  return api.derive.democracy.locks(target).pipe(map(available => available.map(({\n    isFinished,\n    referendumEnd,\n    referendumId,\n    unlockAt,\n    vote\n  }) => ({\n    balance,\n    isDelegated: true,\n    isFinished,\n    referendumEnd,\n    referendumId,\n    unlockAt: unlockAt.isZero() ? unlockAt : referendumEnd.add((api.consts.democracy.voteLockingPeriod || api.consts.democracy.enactmentPeriod).muln(LOCKUPS[conviction.index])),\n    vote: api.registry.createType('Vote', {\n      aye: vote.isAye,\n      conviction\n    })\n  }))));\n}\nfunction directLocks(api, {\n  votes\n}) {\n  if (!votes.length) {\n    return of([]);\n  }\n  return api.query.democracy.referendumInfoOf.multi(votes.map(([referendumId]) => referendumId)).pipe(map(referendums => votes.map((vote, index) => [vote, referendums[index].unwrapOr(null)]).filter(item => !!item[1] && isUndefined(item[1].end) && item[0][1].isStandard).map(([directVote, referendum]) => parseLock(api, directVote, referendum))));\n}\nexport function locks(instanceId, api) {\n  return memo(instanceId, accountId => api.query.democracy.votingOf ? api.query.democracy.votingOf(accountId).pipe(switchMap(voting => voting.isDirect ? directLocks(api, voting.asDirect) : voting.isDelegating ? delegateLocks(api, voting.asDelegating) : of([]))) : of([]));\n}","map":{"version":3,"names":["map","of","switchMap","BN_ZERO","isUndefined","memo","LOCKUPS","parseEnd","api","vote","approved","end","isTrue","isAye","isFalse","isNay","add","consts","democracy","voteLockingPeriod","enactmentPeriod","muln","conviction","index","parseLock","referendumId","accountVote","referendum","balance","asStandard","referendumEnd","unlockAt","isFinished","asFinished","isDelegated","delegateLocks","target","derive","locks","pipe","available","isZero","registry","createType","aye","directLocks","votes","length","query","referendumInfoOf","multi","referendums","unwrapOr","filter","item","isStandard","directVote","instanceId","accountId","votingOf","voting","isDirect","asDirect","isDelegating","asDelegating"],"sources":["/home/ryoitsu/Documents/test/react-todo-app/node_modules/@polkadot/api-derive/democracy/locks.js"],"sourcesContent":["import { map, of, switchMap } from 'rxjs';\nimport { BN_ZERO, isUndefined } from '@polkadot/util';\nimport { memo } from '../util/index.js';\nconst LOCKUPS = [0, 1, 2, 4, 8, 16, 32];\nfunction parseEnd(api, vote, { approved, end }) {\n    return [\n        end,\n        (approved.isTrue && vote.isAye) || (approved.isFalse && vote.isNay)\n            ? end.add((api.consts.democracy.voteLockingPeriod ||\n                api.consts.democracy.enactmentPeriod).muln(LOCKUPS[vote.conviction.index]))\n            : BN_ZERO\n    ];\n}\nfunction parseLock(api, [referendumId, accountVote], referendum) {\n    const { balance, vote } = accountVote.asStandard;\n    const [referendumEnd, unlockAt] = referendum.isFinished\n        ? parseEnd(api, vote, referendum.asFinished)\n        : [BN_ZERO, BN_ZERO];\n    return { balance, isDelegated: false, isFinished: referendum.isFinished, referendumEnd, referendumId, unlockAt, vote };\n}\nfunction delegateLocks(api, { balance, conviction, target }) {\n    return api.derive.democracy.locks(target).pipe(map((available) => available.map(({ isFinished, referendumEnd, referendumId, unlockAt, vote }) => ({\n        balance,\n        isDelegated: true,\n        isFinished,\n        referendumEnd,\n        referendumId,\n        unlockAt: unlockAt.isZero()\n            ? unlockAt\n            : referendumEnd.add((api.consts.democracy.voteLockingPeriod ||\n                api.consts.democracy.enactmentPeriod).muln(LOCKUPS[conviction.index])),\n        vote: api.registry.createType('Vote', { aye: vote.isAye, conviction })\n    }))));\n}\nfunction directLocks(api, { votes }) {\n    if (!votes.length) {\n        return of([]);\n    }\n    return api.query.democracy.referendumInfoOf.multi(votes.map(([referendumId]) => referendumId)).pipe(map((referendums) => votes\n        .map((vote, index) => [vote, referendums[index].unwrapOr(null)])\n        .filter((item) => !!item[1] && isUndefined(item[1].end) && item[0][1].isStandard)\n        .map(([directVote, referendum]) => parseLock(api, directVote, referendum))));\n}\nexport function locks(instanceId, api) {\n    return memo(instanceId, (accountId) => api.query.democracy.votingOf\n        ? api.query.democracy.votingOf(accountId).pipe(switchMap((voting) => voting.isDirect\n            ? directLocks(api, voting.asDirect)\n            : voting.isDelegating\n                ? delegateLocks(api, voting.asDelegating)\n                : of([])))\n        : of([]));\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}