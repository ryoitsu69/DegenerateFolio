{"ast":null,"code":"import { BN, bnSqrt, isHex, isString, isU8a, objectSpread, stringToHex, u8aToHex } from '@polkadot/util';\nfunction isOldInfo(info) {\n  return !!info.proposalHash;\n}\nfunction isCurrentStatus(status) {\n  return !!status.tally;\n}\nexport function compareRationals(n1, d1, n2, d2) {\n  while (true) {\n    const q1 = n1.div(d1);\n    const q2 = n2.div(d2);\n    if (q1.lt(q2)) {\n      return true;\n    } else if (q2.lt(q1)) {\n      return false;\n    }\n    const r1 = n1.mod(d1);\n    const r2 = n2.mod(d2);\n    if (r2.isZero()) {\n      return false;\n    } else if (r1.isZero()) {\n      return true;\n    }\n    n1 = d2;\n    n2 = d1;\n    d1 = r2;\n    d2 = r1;\n  }\n}\nfunction calcPassingOther(threshold, sqrtElectorate, _ref) {\n  let {\n    votedAye,\n    votedNay,\n    votedTotal\n  } = _ref;\n  const sqrtVoters = bnSqrt(votedTotal);\n  return sqrtVoters.isZero() ? false : threshold.isSuperMajorityApprove ? compareRationals(votedNay, sqrtVoters, votedAye, sqrtElectorate) : compareRationals(votedNay, sqrtElectorate, votedAye, sqrtVoters);\n}\nexport function calcPassing(threshold, sqrtElectorate, state) {\n  return threshold.isSimpleMajority ? state.votedAye.gt(state.votedNay) : calcPassingOther(threshold, sqrtElectorate, state);\n}\nfunction calcVotesPrev(votesFor) {\n  return votesFor.reduce((state, derived) => {\n    const {\n      balance,\n      vote\n    } = derived;\n    const isDefault = vote.conviction.index === 0;\n    const counted = balance.muln(isDefault ? 1 : vote.conviction.index).divn(isDefault ? 10 : 1);\n    if (vote.isAye) {\n      state.allAye.push(derived);\n      state.voteCountAye++;\n      state.votedAye.iadd(counted);\n    } else {\n      state.allNay.push(derived);\n      state.voteCountNay++;\n      state.votedNay.iadd(counted);\n    }\n    state.voteCount++;\n    state.votedTotal.iadd(counted);\n    return state;\n  }, {\n    allAye: [],\n    allNay: [],\n    voteCount: 0,\n    voteCountAye: 0,\n    voteCountNay: 0,\n    votedAye: new BN(0),\n    votedNay: new BN(0),\n    votedTotal: new BN(0)\n  });\n}\nfunction calcVotesCurrent(tally, votes) {\n  const allAye = [];\n  const allNay = [];\n  votes.forEach(derived => {\n    if (derived.vote.isAye) {\n      allAye.push(derived);\n    } else {\n      allNay.push(derived);\n    }\n  });\n  return {\n    allAye,\n    allNay,\n    voteCount: allAye.length + allNay.length,\n    voteCountAye: allAye.length,\n    voteCountNay: allNay.length,\n    votedAye: tally.ayes,\n    votedNay: tally.nays,\n    votedTotal: tally.turnout\n  };\n}\nexport function calcVotes(sqrtElectorate, referendum, votes) {\n  const state = isCurrentStatus(referendum.status) ? calcVotesCurrent(referendum.status.tally, votes) : calcVotesPrev(votes);\n  return objectSpread({}, state, {\n    isPassing: calcPassing(referendum.status.threshold, sqrtElectorate, state),\n    votes\n  });\n}\nexport function getStatus(info) {\n  if (info.isNone) {\n    return null;\n  }\n  const unwrapped = info.unwrap();\n  return isOldInfo(unwrapped) ? unwrapped : unwrapped.isOngoing ? unwrapped.asOngoing\n  // done, we don't include it here... only currently active\n  : null;\n}\nexport function getImageHashBounded(hash) {\n  return hash.isLegacy ? hash.asLegacy.hash_.toHex() : hash.isLookup ? hash.asLookup.hash_.toHex()\n  // for inline, use the actual Bytes hash\n  : hash.isInline ? hash.asInline.hash.toHex() : isString(hash) ? isHex(hash) ? hash : stringToHex(hash) : isU8a(hash) ? u8aToHex(hash) : hash.toHex();\n}\nexport function getImageHash(status) {\n  return getImageHashBounded(status.proposal || status.proposalHash);\n}","map":{"version":3,"names":["BN","bnSqrt","isHex","isString","isU8a","objectSpread","stringToHex","u8aToHex","isOldInfo","info","proposalHash","isCurrentStatus","status","tally","compareRationals","n1","d1","n2","d2","q1","div","q2","lt","r1","mod","r2","isZero","calcPassingOther","threshold","sqrtElectorate","_ref","votedAye","votedNay","votedTotal","sqrtVoters","isSuperMajorityApprove","calcPassing","state","isSimpleMajority","gt","calcVotesPrev","votesFor","reduce","derived","balance","vote","isDefault","conviction","index","counted","muln","divn","isAye","allAye","push","voteCountAye","iadd","allNay","voteCountNay","voteCount","calcVotesCurrent","votes","forEach","length","ayes","nays","turnout","calcVotes","referendum","isPassing","getStatus","isNone","unwrapped","unwrap","isOngoing","asOngoing","getImageHashBounded","hash","isLegacy","asLegacy","hash_","toHex","isLookup","asLookup","isInline","asInline","getImageHash","proposal"],"sources":["/home/ryoitsu/Documents/test/react-todo-app/node_modules/@polkadot/api-derive/democracy/util.js"],"sourcesContent":["import { BN, bnSqrt, isHex, isString, isU8a, objectSpread, stringToHex, u8aToHex } from '@polkadot/util';\nfunction isOldInfo(info) {\n    return !!info.proposalHash;\n}\nfunction isCurrentStatus(status) {\n    return !!status.tally;\n}\nexport function compareRationals(n1, d1, n2, d2) {\n    while (true) {\n        const q1 = n1.div(d1);\n        const q2 = n2.div(d2);\n        if (q1.lt(q2)) {\n            return true;\n        }\n        else if (q2.lt(q1)) {\n            return false;\n        }\n        const r1 = n1.mod(d1);\n        const r2 = n2.mod(d2);\n        if (r2.isZero()) {\n            return false;\n        }\n        else if (r1.isZero()) {\n            return true;\n        }\n        n1 = d2;\n        n2 = d1;\n        d1 = r2;\n        d2 = r1;\n    }\n}\nfunction calcPassingOther(threshold, sqrtElectorate, { votedAye, votedNay, votedTotal }) {\n    const sqrtVoters = bnSqrt(votedTotal);\n    return sqrtVoters.isZero()\n        ? false\n        : threshold.isSuperMajorityApprove\n            ? compareRationals(votedNay, sqrtVoters, votedAye, sqrtElectorate)\n            : compareRationals(votedNay, sqrtElectorate, votedAye, sqrtVoters);\n}\nexport function calcPassing(threshold, sqrtElectorate, state) {\n    return threshold.isSimpleMajority\n        ? state.votedAye.gt(state.votedNay)\n        : calcPassingOther(threshold, sqrtElectorate, state);\n}\nfunction calcVotesPrev(votesFor) {\n    return votesFor.reduce((state, derived) => {\n        const { balance, vote } = derived;\n        const isDefault = vote.conviction.index === 0;\n        const counted = balance\n            .muln(isDefault ? 1 : vote.conviction.index)\n            .divn(isDefault ? 10 : 1);\n        if (vote.isAye) {\n            state.allAye.push(derived);\n            state.voteCountAye++;\n            state.votedAye.iadd(counted);\n        }\n        else {\n            state.allNay.push(derived);\n            state.voteCountNay++;\n            state.votedNay.iadd(counted);\n        }\n        state.voteCount++;\n        state.votedTotal.iadd(counted);\n        return state;\n    }, { allAye: [], allNay: [], voteCount: 0, voteCountAye: 0, voteCountNay: 0, votedAye: new BN(0), votedNay: new BN(0), votedTotal: new BN(0) });\n}\nfunction calcVotesCurrent(tally, votes) {\n    const allAye = [];\n    const allNay = [];\n    votes.forEach((derived) => {\n        if (derived.vote.isAye) {\n            allAye.push(derived);\n        }\n        else {\n            allNay.push(derived);\n        }\n    });\n    return {\n        allAye,\n        allNay,\n        voteCount: allAye.length + allNay.length,\n        voteCountAye: allAye.length,\n        voteCountNay: allNay.length,\n        votedAye: tally.ayes,\n        votedNay: tally.nays,\n        votedTotal: tally.turnout\n    };\n}\nexport function calcVotes(sqrtElectorate, referendum, votes) {\n    const state = isCurrentStatus(referendum.status)\n        ? calcVotesCurrent(referendum.status.tally, votes)\n        : calcVotesPrev(votes);\n    return objectSpread({}, state, {\n        isPassing: calcPassing(referendum.status.threshold, sqrtElectorate, state),\n        votes\n    });\n}\nexport function getStatus(info) {\n    if (info.isNone) {\n        return null;\n    }\n    const unwrapped = info.unwrap();\n    return isOldInfo(unwrapped)\n        ? unwrapped\n        : unwrapped.isOngoing\n            ? unwrapped.asOngoing\n            // done, we don't include it here... only currently active\n            : null;\n}\nexport function getImageHashBounded(hash) {\n    return hash.isLegacy\n        ? hash.asLegacy.hash_.toHex()\n        : hash.isLookup\n            ? hash.asLookup.hash_.toHex()\n            // for inline, use the actual Bytes hash\n            : hash.isInline\n                ? hash.asInline.hash.toHex()\n                : isString(hash)\n                    ? isHex(hash)\n                        ? hash\n                        : stringToHex(hash)\n                    : isU8a(hash)\n                        ? u8aToHex(hash)\n                        : hash.toHex();\n}\nexport function getImageHash(status) {\n    return getImageHashBounded(status.proposal ||\n        status.proposalHash);\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}