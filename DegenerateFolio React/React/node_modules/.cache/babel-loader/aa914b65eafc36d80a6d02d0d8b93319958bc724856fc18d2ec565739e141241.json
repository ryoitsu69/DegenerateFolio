{"ast":null,"code":"import { map, of, switchMap } from 'rxjs';\nimport { BN_ZERO, isUndefined } from '@polkadot/util';\nimport { memo } from '../util/index.js';\nconst LOCKUPS = [0, 1, 2, 4, 8, 16, 32];\nfunction parseEnd(api, vote, _ref) {\n  let {\n    approved,\n    end\n  } = _ref;\n  return [end, approved.isTrue && vote.isAye || approved.isFalse && vote.isNay ? end.add((api.consts.democracy.voteLockingPeriod || api.consts.democracy.enactmentPeriod).muln(LOCKUPS[vote.conviction.index])) : BN_ZERO];\n}\nfunction parseLock(api, _ref2, referendum) {\n  let [referendumId, accountVote] = _ref2;\n  const {\n    balance,\n    vote\n  } = accountVote.asStandard;\n  const [referendumEnd, unlockAt] = referendum.isFinished ? parseEnd(api, vote, referendum.asFinished) : [BN_ZERO, BN_ZERO];\n  return {\n    balance,\n    isDelegated: false,\n    isFinished: referendum.isFinished,\n    referendumEnd,\n    referendumId,\n    unlockAt,\n    vote\n  };\n}\nfunction delegateLocks(api, _ref3) {\n  let {\n    balance,\n    conviction,\n    target\n  } = _ref3;\n  return api.derive.democracy.locks(target).pipe(map(available => available.map(_ref4 => {\n    let {\n      isFinished,\n      referendumEnd,\n      referendumId,\n      unlockAt,\n      vote\n    } = _ref4;\n    return {\n      balance,\n      isDelegated: true,\n      isFinished,\n      referendumEnd,\n      referendumId,\n      unlockAt: unlockAt.isZero() ? unlockAt : referendumEnd.add((api.consts.democracy.voteLockingPeriod || api.consts.democracy.enactmentPeriod).muln(LOCKUPS[conviction.index])),\n      vote: api.registry.createType('Vote', {\n        aye: vote.isAye,\n        conviction\n      })\n    };\n  })));\n}\nfunction directLocks(api, _ref5) {\n  let {\n    votes\n  } = _ref5;\n  if (!votes.length) {\n    return of([]);\n  }\n  return api.query.democracy.referendumInfoOf.multi(votes.map(_ref6 => {\n    let [referendumId] = _ref6;\n    return referendumId;\n  })).pipe(map(referendums => votes.map((vote, index) => [vote, referendums[index].unwrapOr(null)]).filter(item => !!item[1] && isUndefined(item[1].end) && item[0][1].isStandard).map(_ref7 => {\n    let [directVote, referendum] = _ref7;\n    return parseLock(api, directVote, referendum);\n  })));\n}\nexport function locks(instanceId, api) {\n  return memo(instanceId, accountId => api.query.democracy.votingOf ? api.query.democracy.votingOf(accountId).pipe(switchMap(voting => voting.isDirect ? directLocks(api, voting.asDirect) : voting.isDelegating ? delegateLocks(api, voting.asDelegating) : of([]))) : of([]));\n}","map":{"version":3,"names":["map","of","switchMap","BN_ZERO","isUndefined","memo","LOCKUPS","parseEnd","api","vote","_ref","approved","end","isTrue","isAye","isFalse","isNay","add","consts","democracy","voteLockingPeriod","enactmentPeriod","muln","conviction","index","parseLock","_ref2","referendum","referendumId","accountVote","balance","asStandard","referendumEnd","unlockAt","isFinished","asFinished","isDelegated","delegateLocks","_ref3","target","derive","locks","pipe","available","_ref4","isZero","registry","createType","aye","directLocks","_ref5","votes","length","query","referendumInfoOf","multi","_ref6","referendums","unwrapOr","filter","item","isStandard","_ref7","directVote","instanceId","accountId","votingOf","voting","isDirect","asDirect","isDelegating","asDelegating"],"sources":["/home/ryoitsu/Documents/test/react-todo-app/node_modules/@polkadot/api-derive/democracy/locks.js"],"sourcesContent":["import { map, of, switchMap } from 'rxjs';\nimport { BN_ZERO, isUndefined } from '@polkadot/util';\nimport { memo } from '../util/index.js';\nconst LOCKUPS = [0, 1, 2, 4, 8, 16, 32];\nfunction parseEnd(api, vote, { approved, end }) {\n    return [\n        end,\n        (approved.isTrue && vote.isAye) || (approved.isFalse && vote.isNay)\n            ? end.add((api.consts.democracy.voteLockingPeriod ||\n                api.consts.democracy.enactmentPeriod).muln(LOCKUPS[vote.conviction.index]))\n            : BN_ZERO\n    ];\n}\nfunction parseLock(api, [referendumId, accountVote], referendum) {\n    const { balance, vote } = accountVote.asStandard;\n    const [referendumEnd, unlockAt] = referendum.isFinished\n        ? parseEnd(api, vote, referendum.asFinished)\n        : [BN_ZERO, BN_ZERO];\n    return { balance, isDelegated: false, isFinished: referendum.isFinished, referendumEnd, referendumId, unlockAt, vote };\n}\nfunction delegateLocks(api, { balance, conviction, target }) {\n    return api.derive.democracy.locks(target).pipe(map((available) => available.map(({ isFinished, referendumEnd, referendumId, unlockAt, vote }) => ({\n        balance,\n        isDelegated: true,\n        isFinished,\n        referendumEnd,\n        referendumId,\n        unlockAt: unlockAt.isZero()\n            ? unlockAt\n            : referendumEnd.add((api.consts.democracy.voteLockingPeriod ||\n                api.consts.democracy.enactmentPeriod).muln(LOCKUPS[conviction.index])),\n        vote: api.registry.createType('Vote', { aye: vote.isAye, conviction })\n    }))));\n}\nfunction directLocks(api, { votes }) {\n    if (!votes.length) {\n        return of([]);\n    }\n    return api.query.democracy.referendumInfoOf.multi(votes.map(([referendumId]) => referendumId)).pipe(map((referendums) => votes\n        .map((vote, index) => [vote, referendums[index].unwrapOr(null)])\n        .filter((item) => !!item[1] && isUndefined(item[1].end) && item[0][1].isStandard)\n        .map(([directVote, referendum]) => parseLock(api, directVote, referendum))));\n}\nexport function locks(instanceId, api) {\n    return memo(instanceId, (accountId) => api.query.democracy.votingOf\n        ? api.query.democracy.votingOf(accountId).pipe(switchMap((voting) => voting.isDirect\n            ? directLocks(api, voting.asDirect)\n            : voting.isDelegating\n                ? delegateLocks(api, voting.asDelegating)\n                : of([])))\n        : of([]));\n}\n"],"mappings":"AAAA,SAASA,GAAG,EAAEC,EAAE,EAAEC,SAAS,QAAQ,MAAM;AACzC,SAASC,OAAO,EAAEC,WAAW,QAAQ,gBAAgB;AACrD,SAASC,IAAI,QAAQ,kBAAkB;AACvC,MAAMC,OAAO,GAAG,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,EAAE,EAAE,EAAE,CAAC;AACvC,SAASC,QAAQA,CAACC,GAAG,EAAEC,IAAI,EAAAC,IAAA,EAAqB;EAAA,IAAnB;IAAEC,QAAQ;IAAEC;EAAI,CAAC,GAAAF,IAAA;EAC1C,OAAO,CACHE,GAAG,EACFD,QAAQ,CAACE,MAAM,IAAIJ,IAAI,CAACK,KAAK,IAAMH,QAAQ,CAACI,OAAO,IAAIN,IAAI,CAACO,KAAM,GAC7DJ,GAAG,CAACK,GAAG,CAAC,CAACT,GAAG,CAACU,MAAM,CAACC,SAAS,CAACC,iBAAiB,IAC7CZ,GAAG,CAACU,MAAM,CAACC,SAAS,CAACE,eAAe,EAAEC,IAAI,CAAChB,OAAO,CAACG,IAAI,CAACc,UAAU,CAACC,KAAK,CAAC,CAAC,CAAC,GAC7ErB,OAAO,CAChB;AACL;AACA,SAASsB,SAASA,CAACjB,GAAG,EAAAkB,KAAA,EAA+BC,UAAU,EAAE;EAAA,IAAzC,CAACC,YAAY,EAAEC,WAAW,CAAC,GAAAH,KAAA;EAC/C,MAAM;IAAEI,OAAO;IAAErB;EAAK,CAAC,GAAGoB,WAAW,CAACE,UAAU;EAChD,MAAM,CAACC,aAAa,EAAEC,QAAQ,CAAC,GAAGN,UAAU,CAACO,UAAU,GACjD3B,QAAQ,CAACC,GAAG,EAAEC,IAAI,EAAEkB,UAAU,CAACQ,UAAU,CAAC,GAC1C,CAAChC,OAAO,EAAEA,OAAO,CAAC;EACxB,OAAO;IAAE2B,OAAO;IAAEM,WAAW,EAAE,KAAK;IAAEF,UAAU,EAAEP,UAAU,CAACO,UAAU;IAAEF,aAAa;IAAEJ,YAAY;IAAEK,QAAQ;IAAExB;EAAK,CAAC;AAC1H;AACA,SAAS4B,aAAaA,CAAC7B,GAAG,EAAA8B,KAAA,EAAmC;EAAA,IAAjC;IAAER,OAAO;IAAEP,UAAU;IAAEgB;EAAO,CAAC,GAAAD,KAAA;EACvD,OAAO9B,GAAG,CAACgC,MAAM,CAACrB,SAAS,CAACsB,KAAK,CAACF,MAAM,CAAC,CAACG,IAAI,CAAC1C,GAAG,CAAE2C,SAAS,IAAKA,SAAS,CAAC3C,GAAG,CAAC4C,KAAA;IAAA,IAAC;MAAEV,UAAU;MAAEF,aAAa;MAAEJ,YAAY;MAAEK,QAAQ;MAAExB;IAAK,CAAC,GAAAmC,KAAA;IAAA,OAAM;MAC9Id,OAAO;MACPM,WAAW,EAAE,IAAI;MACjBF,UAAU;MACVF,aAAa;MACbJ,YAAY;MACZK,QAAQ,EAAEA,QAAQ,CAACY,MAAM,CAAC,CAAC,GACrBZ,QAAQ,GACRD,aAAa,CAACf,GAAG,CAAC,CAACT,GAAG,CAACU,MAAM,CAACC,SAAS,CAACC,iBAAiB,IACvDZ,GAAG,CAACU,MAAM,CAACC,SAAS,CAACE,eAAe,EAAEC,IAAI,CAAChB,OAAO,CAACiB,UAAU,CAACC,KAAK,CAAC,CAAC,CAAC;MAC9Ef,IAAI,EAAED,GAAG,CAACsC,QAAQ,CAACC,UAAU,CAAC,MAAM,EAAE;QAAEC,GAAG,EAAEvC,IAAI,CAACK,KAAK;QAAES;MAAW,CAAC;IACzE,CAAC;EAAA,CAAC,CAAC,CAAC,CAAC;AACT;AACA,SAAS0B,WAAWA,CAACzC,GAAG,EAAA0C,KAAA,EAAa;EAAA,IAAX;IAAEC;EAAM,CAAC,GAAAD,KAAA;EAC/B,IAAI,CAACC,KAAK,CAACC,MAAM,EAAE;IACf,OAAOnD,EAAE,CAAC,EAAE,CAAC;EACjB;EACA,OAAOO,GAAG,CAAC6C,KAAK,CAAClC,SAAS,CAACmC,gBAAgB,CAACC,KAAK,CAACJ,KAAK,CAACnD,GAAG,CAACwD,KAAA;IAAA,IAAC,CAAC5B,YAAY,CAAC,GAAA4B,KAAA;IAAA,OAAK5B,YAAY;EAAA,EAAC,CAAC,CAACc,IAAI,CAAC1C,GAAG,CAAEyD,WAAW,IAAKN,KAAK,CACzHnD,GAAG,CAAC,CAACS,IAAI,EAAEe,KAAK,KAAK,CAACf,IAAI,EAAEgD,WAAW,CAACjC,KAAK,CAAC,CAACkC,QAAQ,CAAC,IAAI,CAAC,CAAC,CAAC,CAC/DC,MAAM,CAAEC,IAAI,IAAK,CAAC,CAACA,IAAI,CAAC,CAAC,CAAC,IAAIxD,WAAW,CAACwD,IAAI,CAAC,CAAC,CAAC,CAAChD,GAAG,CAAC,IAAIgD,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAACC,UAAU,CAAC,CAChF7D,GAAG,CAAC8D,KAAA;IAAA,IAAC,CAACC,UAAU,EAAEpC,UAAU,CAAC,GAAAmC,KAAA;IAAA,OAAKrC,SAAS,CAACjB,GAAG,EAAEuD,UAAU,EAAEpC,UAAU,CAAC;EAAA,EAAC,CAAC,CAAC;AACpF;AACA,OAAO,SAASc,KAAKA,CAACuB,UAAU,EAAExD,GAAG,EAAE;EACnC,OAAOH,IAAI,CAAC2D,UAAU,EAAGC,SAAS,IAAKzD,GAAG,CAAC6C,KAAK,CAAClC,SAAS,CAAC+C,QAAQ,GAC7D1D,GAAG,CAAC6C,KAAK,CAAClC,SAAS,CAAC+C,QAAQ,CAACD,SAAS,CAAC,CAACvB,IAAI,CAACxC,SAAS,CAAEiE,MAAM,IAAKA,MAAM,CAACC,QAAQ,GAC9EnB,WAAW,CAACzC,GAAG,EAAE2D,MAAM,CAACE,QAAQ,CAAC,GACjCF,MAAM,CAACG,YAAY,GACfjC,aAAa,CAAC7B,GAAG,EAAE2D,MAAM,CAACI,YAAY,CAAC,GACvCtE,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC,GAChBA,EAAE,CAAC,EAAE,CAAC,CAAC;AACjB","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}