{"ast":null,"code":"import { ExtensionType } from '../../extensions/Extensions.mjs';\nimport { BigPool } from '../../utils/pool/PoolGroup.mjs';\nimport { BatchableMesh } from '../mesh/shared/BatchableMesh.mjs';\nimport { NineSliceGeometry } from './NineSliceGeometry.mjs';\n\"use strict\";\nclass NineSliceSpritePipe {\n  constructor(renderer) {\n    this._gpuSpriteHash = /* @__PURE__ */Object.create(null);\n    this._renderer = renderer;\n  }\n  addRenderable(sprite, _instructionSet) {\n    const gpuSprite = this._getGpuSprite(sprite);\n    if (sprite._didSpriteUpdate) this._updateBatchableSprite(sprite, gpuSprite);\n    this._renderer.renderPipes.batch.addToBatch(gpuSprite);\n  }\n  updateRenderable(sprite) {\n    const gpuSprite = this._gpuSpriteHash[sprite.uid];\n    if (sprite._didSpriteUpdate) this._updateBatchableSprite(sprite, gpuSprite);\n    gpuSprite.batcher.updateElement(gpuSprite);\n  }\n  validateRenderable(sprite) {\n    const texture = sprite._texture;\n    const gpuSprite = this._getGpuSprite(sprite);\n    if (gpuSprite.texture._source !== texture._source) {\n      return !gpuSprite.batcher.checkAndUpdateTexture(gpuSprite, texture);\n    }\n    return false;\n  }\n  destroyRenderable(sprite) {\n    const batchableSprite = this._gpuSpriteHash[sprite.uid];\n    BigPool.return(batchableSprite);\n    this._gpuSpriteHash[sprite.uid] = null;\n  }\n  _updateBatchableSprite(sprite, batchableSprite) {\n    sprite._didSpriteUpdate = false;\n    batchableSprite.geometry.update(sprite);\n    batchableSprite.texture = sprite._texture;\n  }\n  _getGpuSprite(sprite) {\n    return this._gpuSpriteHash[sprite.uid] || this._initGPUSprite(sprite);\n  }\n  _initGPUSprite(sprite) {\n    const batchableMesh = new BatchableMesh();\n    batchableMesh.geometry = new NineSliceGeometry();\n    batchableMesh.mesh = sprite;\n    batchableMesh.texture = sprite._texture;\n    batchableMesh.roundPixels = this._renderer._roundPixels | sprite._roundPixels;\n    this._gpuSpriteHash[sprite.uid] = batchableMesh;\n    sprite.on(\"destroyed\", () => {\n      this.destroyRenderable(sprite);\n    });\n    return batchableMesh;\n  }\n  destroy() {\n    for (const i in this._gpuSpriteHash) {\n      const batchableMesh = this._gpuSpriteHash[i];\n      batchableMesh.geometry.destroy();\n    }\n    this._gpuSpriteHash = null;\n    this._renderer = null;\n  }\n}\n/** @ignore */\nNineSliceSpritePipe.extension = {\n  type: [ExtensionType.WebGLPipes, ExtensionType.WebGPUPipes, ExtensionType.CanvasPipes],\n  name: \"nineSliceSprite\"\n};\nexport { NineSliceSpritePipe };","map":{"version":3,"names":["NineSliceSpritePipe","constructor","renderer","_gpuSpriteHash","Object","create","_renderer","addRenderable","sprite","_instructionSet","gpuSprite","_getGpuSprite","_didSpriteUpdate","_updateBatchableSprite","renderPipes","batch","addToBatch","updateRenderable","uid","batcher","updateElement","validateRenderable","texture","_texture","_source","checkAndUpdateTexture","destroyRenderable","batchableSprite","BigPool","return","geometry","update","_initGPUSprite","batchableMesh","BatchableMesh","NineSliceGeometry","mesh","roundPixels","_roundPixels","on","destroy","i","extension","type","ExtensionType","WebGLPipes","WebGPUPipes","CanvasPipes","name"],"sources":["/home/ryoitsu/node_modules/pixi.js/src/scene/sprite-nine-slice/NineSliceSpritePipe.ts"],"sourcesContent":["import { ExtensionType } from '../../extensions/Extensions';\nimport { BigPool } from '../../utils/pool/PoolGroup';\nimport { BatchableMesh } from '../mesh/shared/BatchableMesh';\nimport { NineSliceGeometry } from './NineSliceGeometry';\n\nimport type { InstructionSet } from '../../rendering/renderers/shared/instructions/InstructionSet';\nimport type { RenderPipe } from '../../rendering/renderers/shared/instructions/RenderPipe';\nimport type { Renderer } from '../../rendering/renderers/types';\nimport type { PoolItem } from '../../utils/pool/Pool';\nimport type { NineSliceSprite } from './NineSliceSprite';\n\nexport class NineSliceSpritePipe implements RenderPipe<NineSliceSprite>\n{\n    /** @ignore */\n    public static extension = {\n        type: [\n            ExtensionType.WebGLPipes,\n            ExtensionType.WebGPUPipes,\n            ExtensionType.CanvasPipes,\n        ],\n        name: 'nineSliceSprite',\n    } as const;\n\n    private readonly _renderer: Renderer;\n    private readonly _gpuSpriteHash: Record<number, BatchableMesh> = Object.create(null);\n\n    constructor(renderer: Renderer)\n    {\n        this._renderer = renderer;\n    }\n\n    public addRenderable(sprite: NineSliceSprite, _instructionSet: InstructionSet)\n    {\n        const gpuSprite = this._getGpuSprite(sprite);\n\n        if (sprite._didSpriteUpdate) this._updateBatchableSprite(sprite, gpuSprite);\n\n        this._renderer.renderPipes.batch.addToBatch(gpuSprite);\n    }\n\n    public updateRenderable(sprite: NineSliceSprite)\n    {\n        const gpuSprite = this._gpuSpriteHash[sprite.uid];\n\n        if (sprite._didSpriteUpdate) this._updateBatchableSprite(sprite, gpuSprite);\n\n        gpuSprite.batcher.updateElement(gpuSprite);\n    }\n\n    public validateRenderable(sprite: NineSliceSprite): boolean\n    {\n        const texture = sprite._texture;\n        const gpuSprite = this._getGpuSprite(sprite);\n\n        if (gpuSprite.texture._source !== texture._source)\n        {\n            return !gpuSprite.batcher.checkAndUpdateTexture(gpuSprite, texture);\n        }\n\n        return false;\n    }\n\n    public destroyRenderable(sprite: NineSliceSprite)\n    {\n        const batchableSprite = this._gpuSpriteHash[sprite.uid];\n\n        // this will call reset!\n        BigPool.return(batchableSprite as PoolItem);\n\n        this._gpuSpriteHash[sprite.uid] = null;\n    }\n\n    private _updateBatchableSprite(sprite: NineSliceSprite, batchableSprite: BatchableMesh)\n    {\n        sprite._didSpriteUpdate = false;\n        (batchableSprite.geometry as NineSliceGeometry)\n            .update(sprite);\n\n        // = sprite.bounds;\n        batchableSprite.texture = sprite._texture;\n    }\n\n    private _getGpuSprite(sprite: NineSliceSprite): BatchableMesh\n    {\n        return this._gpuSpriteHash[sprite.uid] || this._initGPUSprite(sprite);\n    }\n\n    private _initGPUSprite(sprite: NineSliceSprite): BatchableMesh\n    {\n        const batchableMesh = new BatchableMesh();\n\n        batchableMesh.geometry = new NineSliceGeometry();\n\n        batchableMesh.mesh = sprite;\n\n        batchableMesh.texture = sprite._texture;\n        batchableMesh.roundPixels = (this._renderer._roundPixels | sprite._roundPixels) as 0 | 1;\n\n        this._gpuSpriteHash[sprite.uid] = batchableMesh;\n\n        // TODO perhaps manage this outside this pipe? (a bit like how we update / add)\n        sprite.on('destroyed', () =>\n        {\n            this.destroyRenderable(sprite);\n        });\n\n        return batchableMesh;\n    }\n\n    public destroy()\n    {\n        for (const i in this._gpuSpriteHash)\n        {\n            const batchableMesh = this._gpuSpriteHash[i];\n\n            batchableMesh.geometry.destroy();\n        }\n\n        (this._gpuSpriteHash as null) = null;\n        (this._renderer as null) = null;\n    }\n}\n"],"mappings":";;;;;AAWO,MAAMA,mBACb;EAcIC,YAAYC,QACZ;IAHiB,KAAAC,cAAA,kBAAuDC,MAAA,CAAAC,MAAA,CAAO,IAAI;IAI/E,KAAKC,SAAY,GAAAJ,QAAA;EAAA;EAGdK,cAAcC,MAAA,EAAyBC,eAC9C;IACU,MAAAC,SAAA,GAAY,IAAK,CAAAC,aAAA,CAAcH,MAAM;IAE3C,IAAIA,MAAO,CAAAI,gBAAA,EAAuB,KAAAC,sBAAA,CAAuBL,MAAA,EAAQE,SAAS;IAE1E,KAAKJ,SAAU,CAAAQ,WAAA,CAAYC,KAAM,CAAAC,UAAA,CAAWN,SAAS;EAAA;EAGlDO,iBAAiBT,MACxB;IACI,MAAME,SAAY,QAAKP,cAAe,CAAAK,MAAA,CAAOU,GAAG;IAEhD,IAAIV,MAAO,CAAAI,gBAAA,EAAuB,KAAAC,sBAAA,CAAuBL,MAAA,EAAQE,SAAS;IAEhEA,SAAA,CAAAS,OAAA,CAAQC,aAAA,CAAcV,SAAS;EAAA;EAGtCW,mBAAmBb,MAC1B;IACI,MAAMc,OAAA,GAAUd,MAAO,CAAAe,QAAA;IACjB,MAAAb,SAAA,GAAY,IAAK,CAAAC,aAAA,CAAcH,MAAM;IAE3C,IAAIE,SAAU,CAAAY,OAAA,CAAQE,OAAY,KAAAF,OAAA,CAAQE,OAC1C;MACI,OAAO,CAACd,SAAA,CAAUS,OAAQ,CAAAM,qBAAA,CAAsBf,SAAA,EAAWY,OAAO;IAAA;IAG/D;EAAA;EAGJI,kBAAkBlB,MACzB;IACI,MAAMmB,eAAkB,QAAKxB,cAAe,CAAAK,MAAA,CAAOU,GAAG;IAGtDU,OAAA,CAAQC,MAAA,CAAOF,eAA2B;IAErC,KAAAxB,cAAA,CAAeK,MAAO,CAAAU,GAAG,CAAI;EAAA;EAG9BL,uBAAuBL,MAAA,EAAyBmB,eACxD;IACInB,MAAA,CAAOI,gBAAmB;IACzBe,eAAA,CAAgBG,QACZ,CAAAC,MAAA,CAAOvB,MAAM;IAGlBmB,eAAA,CAAgBL,OAAA,GAAUd,MAAO,CAAAe,QAAA;EAAA;EAG7BZ,cAAcH,MACtB;IACI,OAAO,KAAKL,cAAe,CAAAK,MAAA,CAAOU,GAAG,CAAK,SAAKc,cAAA,CAAexB,MAAM;EAAA;EAGhEwB,eAAexB,MACvB;IACU,MAAAyB,aAAA,GAAgB,IAAIC,aAAc;IAE1BD,aAAA,CAAAH,QAAA,GAAW,IAAIK,iBAAkB;IAE/CF,aAAA,CAAcG,IAAO,GAAA5B,MAAA;IAErByB,aAAA,CAAcX,OAAA,GAAUd,MAAO,CAAAe,QAAA;IAC/BU,aAAA,CAAcI,WAAe,QAAK/B,SAAU,CAAAgC,YAAA,GAAe9B,MAAO,CAAA8B,YAAA;IAE7D,KAAAnC,cAAA,CAAeK,MAAO,CAAAU,GAAG,CAAI,GAAAe,aAAA;IAG3BzB,MAAA,CAAA+B,EAAA,CAAG,aAAa,MACvB;MACI,KAAKb,iBAAA,CAAkBlB,MAAM;IAAA,CAChC;IAEM,OAAAyB,aAAA;EAAA;EAGJO,OACPA,CAAA;IACe,WAAAC,CAAA,IAAK,KAAKtC,cACrB;MACU,MAAA8B,aAAA,GAAgB,IAAK,CAAA9B,cAAA,CAAesC,CAAC;MAE3CR,aAAA,CAAcH,QAAA,CAASU,OAAQ;IAAA;IAGlC,KAAKrC,cAA0B;IAC/B,KAAKG,SAAqB;EAAA;AAEnC;AAAA;AA9GaN,mBAAA,CAGK0C,SAAY;EACtBC,IAAM,GACFC,aAAc,CAAAC,UAAA,EACdD,aAAc,CAAAE,WAAA,EACdF,aAAc,CAAAG,WAAA,CAClB;EACAC,IAAM;AACV","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}