{"ast":null,"code":"import { deriveNoopCache } from './cacheImpl.js';\nconst CHACHE_EXPIRY = 7 * (24 * 60) * (60 * 1000);\nlet deriveCache;\nfunction wrapCache(keyStart, cache) {\n  return {\n    del: partial => cache.del(\"\".concat(keyStart).concat(partial)),\n    forEach: cache.forEach,\n    get: partial => {\n      const key = \"\".concat(keyStart).concat(partial);\n      const cached = cache.get(key);\n      if (cached) {\n        cached.x = Date.now();\n        cache.set(key, cached);\n        return cached.v;\n      }\n      return undefined;\n    },\n    set: (partial, v) => {\n      cache.set(\"\".concat(keyStart).concat(partial), {\n        v,\n        x: Date.now()\n      });\n    }\n  };\n}\nfunction clearCache(cache) {\n  // clear all expired values\n  const now = Date.now();\n  const all = [];\n  cache.forEach((key, _ref) => {\n    let {\n      x\n    } = _ref;\n    now - x > CHACHE_EXPIRY && all.push(key);\n  });\n  // don't do delete inside loop, just in-case\n  all.forEach(key => cache.del(key));\n}\nexport function setDeriveCache() {\n  let prefix = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : '';\n  let cache = arguments.length > 1 ? arguments[1] : undefined;\n  deriveCache = cache ? wrapCache(\"derive:\".concat(prefix, \":\"), cache) : deriveNoopCache;\n  if (cache) {\n    clearCache(cache);\n  }\n}\nsetDeriveCache();\nexport { deriveCache };","map":{"version":3,"names":["deriveNoopCache","CHACHE_EXPIRY","deriveCache","wrapCache","keyStart","cache","del","partial","concat","forEach","get","key","cached","x","Date","now","set","v","undefined","clearCache","all","_ref","push","setDeriveCache","prefix","arguments","length"],"sources":["/home/ryoitsu/Documents/test/react-todo-app/node_modules/@polkadot/api-derive/util/cache.js"],"sourcesContent":["import { deriveNoopCache } from './cacheImpl.js';\nconst CHACHE_EXPIRY = 7 * (24 * 60) * (60 * 1000);\nlet deriveCache;\nfunction wrapCache(keyStart, cache) {\n    return {\n        del: (partial) => cache.del(`${keyStart}${partial}`),\n        forEach: cache.forEach,\n        get: (partial) => {\n            const key = `${keyStart}${partial}`;\n            const cached = cache.get(key);\n            if (cached) {\n                cached.x = Date.now();\n                cache.set(key, cached);\n                return cached.v;\n            }\n            return undefined;\n        },\n        set: (partial, v) => {\n            cache.set(`${keyStart}${partial}`, { v, x: Date.now() });\n        }\n    };\n}\nfunction clearCache(cache) {\n    // clear all expired values\n    const now = Date.now();\n    const all = [];\n    cache.forEach((key, { x }) => {\n        ((now - x) > CHACHE_EXPIRY) && all.push(key);\n    });\n    // don't do delete inside loop, just in-case\n    all.forEach((key) => cache.del(key));\n}\nexport function setDeriveCache(prefix = '', cache) {\n    deriveCache = cache\n        ? wrapCache(`derive:${prefix}:`, cache)\n        : deriveNoopCache;\n    if (cache) {\n        clearCache(cache);\n    }\n}\nsetDeriveCache();\nexport { deriveCache };\n"],"mappings":"AAAA,SAASA,eAAe,QAAQ,gBAAgB;AAChD,MAAMC,aAAa,GAAG,CAAC,IAAI,EAAE,GAAG,EAAE,CAAC,IAAI,EAAE,GAAG,IAAI,CAAC;AACjD,IAAIC,WAAW;AACf,SAASC,SAASA,CAACC,QAAQ,EAAEC,KAAK,EAAE;EAChC,OAAO;IACHC,GAAG,EAAGC,OAAO,IAAKF,KAAK,CAACC,GAAG,IAAAE,MAAA,CAAIJ,QAAQ,EAAAI,MAAA,CAAGD,OAAO,CAAE,CAAC;IACpDE,OAAO,EAAEJ,KAAK,CAACI,OAAO;IACtBC,GAAG,EAAGH,OAAO,IAAK;MACd,MAAMI,GAAG,MAAAH,MAAA,CAAMJ,QAAQ,EAAAI,MAAA,CAAGD,OAAO,CAAE;MACnC,MAAMK,MAAM,GAAGP,KAAK,CAACK,GAAG,CAACC,GAAG,CAAC;MAC7B,IAAIC,MAAM,EAAE;QACRA,MAAM,CAACC,CAAC,GAAGC,IAAI,CAACC,GAAG,CAAC,CAAC;QACrBV,KAAK,CAACW,GAAG,CAACL,GAAG,EAAEC,MAAM,CAAC;QACtB,OAAOA,MAAM,CAACK,CAAC;MACnB;MACA,OAAOC,SAAS;IACpB,CAAC;IACDF,GAAG,EAAEA,CAACT,OAAO,EAAEU,CAAC,KAAK;MACjBZ,KAAK,CAACW,GAAG,IAAAR,MAAA,CAAIJ,QAAQ,EAAAI,MAAA,CAAGD,OAAO,GAAI;QAAEU,CAAC;QAAEJ,CAAC,EAAEC,IAAI,CAACC,GAAG,CAAC;MAAE,CAAC,CAAC;IAC5D;EACJ,CAAC;AACL;AACA,SAASI,UAAUA,CAACd,KAAK,EAAE;EACvB;EACA,MAAMU,GAAG,GAAGD,IAAI,CAACC,GAAG,CAAC,CAAC;EACtB,MAAMK,GAAG,GAAG,EAAE;EACdf,KAAK,CAACI,OAAO,CAAC,CAACE,GAAG,EAAAU,IAAA,KAAY;IAAA,IAAV;MAAER;IAAE,CAAC,GAAAQ,IAAA;IACnBN,GAAG,GAAGF,CAAC,GAAIZ,aAAa,IAAKmB,GAAG,CAACE,IAAI,CAACX,GAAG,CAAC;EAChD,CAAC,CAAC;EACF;EACAS,GAAG,CAACX,OAAO,CAAEE,GAAG,IAAKN,KAAK,CAACC,GAAG,CAACK,GAAG,CAAC,CAAC;AACxC;AACA,OAAO,SAASY,cAAcA,CAAA,EAAqB;EAAA,IAApBC,MAAM,GAAAC,SAAA,CAAAC,MAAA,QAAAD,SAAA,QAAAP,SAAA,GAAAO,SAAA,MAAG,EAAE;EAAA,IAAEpB,KAAK,GAAAoB,SAAA,CAAAC,MAAA,OAAAD,SAAA,MAAAP,SAAA;EAC7ChB,WAAW,GAAGG,KAAK,GACbF,SAAS,WAAAK,MAAA,CAAWgB,MAAM,QAAKnB,KAAK,CAAC,GACrCL,eAAe;EACrB,IAAIK,KAAK,EAAE;IACPc,UAAU,CAACd,KAAK,CAAC;EACrB;AACJ;AACAkB,cAAc,CAAC,CAAC;AAChB,SAASrB,WAAW","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}