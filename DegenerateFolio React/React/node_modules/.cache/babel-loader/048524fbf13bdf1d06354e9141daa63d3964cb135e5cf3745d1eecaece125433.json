{"ast":null,"code":"import { combineLatest, map, of, switchMap } from 'rxjs';\nimport { memo } from '../util/index.js';\nfunction parseResult(api, {\n  allIds,\n  allProposals,\n  approvalIds,\n  councilProposals,\n  proposalCount\n}) {\n  const approvals = [];\n  const proposals = [];\n  const councilTreasury = councilProposals.filter(({\n    proposal\n  }) => proposal && (api.tx.treasury.approveProposal.is(proposal) || api.tx.treasury.rejectProposal.is(proposal)));\n  allIds.forEach((id, index) => {\n    if (allProposals[index].isSome) {\n      const council = councilTreasury.filter(({\n        proposal\n      }) => proposal && id.eq(proposal.args[0])).sort((a, b) => a.proposal && b.proposal ? a.proposal.method.localeCompare(b.proposal.method) : a.proposal ? -1 : 1);\n      const isApproval = approvalIds.some(approvalId => approvalId.eq(id));\n      const derived = {\n        council,\n        id,\n        proposal: allProposals[index].unwrap()\n      };\n      if (isApproval) {\n        approvals.push(derived);\n      } else {\n        proposals.push(derived);\n      }\n    }\n  });\n  return {\n    approvals,\n    proposalCount,\n    proposals\n  };\n}\nfunction retrieveProposals(api, proposalCount, approvalIds) {\n  const proposalIds = [];\n  const count = proposalCount.toNumber();\n  for (let index = 0; index < count; index++) {\n    if (!approvalIds.some(id => id.eqn(index))) {\n      proposalIds.push(api.registry.createType('ProposalIndex', index));\n    }\n  }\n  const allIds = [...proposalIds, ...approvalIds];\n  return combineLatest([api.query.treasury.proposals.multi(allIds), api.derive.council ? api.derive.council.proposals() : of([])]).pipe(map(([allProposals, councilProposals]) => parseResult(api, {\n    allIds,\n    allProposals,\n    approvalIds,\n    councilProposals,\n    proposalCount\n  })));\n}\n/**\n * @description Retrieve all active and approved treasury proposals, along with their info\n */\nexport function proposals(instanceId, api) {\n  return memo(instanceId, () => api.query.treasury ? combineLatest([api.query.treasury.proposalCount(), api.query.treasury.approvals()]).pipe(switchMap(([proposalCount, approvalIds]) => retrieveProposals(api, proposalCount, approvalIds))) : of({\n    approvals: [],\n    proposalCount: api.registry.createType('ProposalIndex'),\n    proposals: []\n  }));\n}","map":{"version":3,"names":["combineLatest","map","of","switchMap","memo","parseResult","api","allIds","allProposals","approvalIds","councilProposals","proposalCount","approvals","proposals","councilTreasury","filter","proposal","tx","treasury","approveProposal","is","rejectProposal","forEach","id","index","isSome","council","eq","args","sort","a","b","method","localeCompare","isApproval","some","approvalId","derived","unwrap","push","retrieveProposals","proposalIds","count","toNumber","eqn","registry","createType","query","multi","derive","pipe","instanceId"],"sources":["/home/ryoitsu/Documents/test/react-todo-app/node_modules/@polkadot/api-derive/treasury/proposals.js"],"sourcesContent":["import { combineLatest, map, of, switchMap } from 'rxjs';\nimport { memo } from '../util/index.js';\nfunction parseResult(api, { allIds, allProposals, approvalIds, councilProposals, proposalCount }) {\n    const approvals = [];\n    const proposals = [];\n    const councilTreasury = councilProposals.filter(({ proposal }) => proposal && (api.tx.treasury.approveProposal.is(proposal) ||\n        api.tx.treasury.rejectProposal.is(proposal)));\n    allIds.forEach((id, index) => {\n        if (allProposals[index].isSome) {\n            const council = councilTreasury\n                .filter(({ proposal }) => proposal && id.eq(proposal.args[0]))\n                .sort((a, b) => a.proposal && b.proposal\n                ? a.proposal.method.localeCompare(b.proposal.method)\n                : a.proposal\n                    ? -1\n                    : 1);\n            const isApproval = approvalIds.some((approvalId) => approvalId.eq(id));\n            const derived = { council, id, proposal: allProposals[index].unwrap() };\n            if (isApproval) {\n                approvals.push(derived);\n            }\n            else {\n                proposals.push(derived);\n            }\n        }\n    });\n    return { approvals, proposalCount, proposals };\n}\nfunction retrieveProposals(api, proposalCount, approvalIds) {\n    const proposalIds = [];\n    const count = proposalCount.toNumber();\n    for (let index = 0; index < count; index++) {\n        if (!approvalIds.some((id) => id.eqn(index))) {\n            proposalIds.push(api.registry.createType('ProposalIndex', index));\n        }\n    }\n    const allIds = [...proposalIds, ...approvalIds];\n    return combineLatest([\n        api.query.treasury.proposals.multi(allIds),\n        api.derive.council\n            ? api.derive.council.proposals()\n            : of([])\n    ]).pipe(map(([allProposals, councilProposals]) => parseResult(api, { allIds, allProposals, approvalIds, councilProposals, proposalCount })));\n}\n/**\n * @description Retrieve all active and approved treasury proposals, along with their info\n */\nexport function proposals(instanceId, api) {\n    return memo(instanceId, () => api.query.treasury\n        ? combineLatest([\n            api.query.treasury.proposalCount(),\n            api.query.treasury.approvals()\n        ]).pipe(switchMap(([proposalCount, approvalIds]) => retrieveProposals(api, proposalCount, approvalIds)))\n        : of({\n            approvals: [],\n            proposalCount: api.registry.createType('ProposalIndex'),\n            proposals: []\n        }));\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}