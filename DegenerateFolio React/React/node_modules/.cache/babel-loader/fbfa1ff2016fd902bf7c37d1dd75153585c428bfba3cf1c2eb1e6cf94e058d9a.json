{"ast":null,"code":"import { Color } from '../../../../color/Color.mjs';\nimport { DOMAdapter } from '../../../../environment/adapter.mjs';\nimport { Matrix } from '../../../../maths/matrix/Matrix.mjs';\nimport { ImageSource } from '../../../../rendering/renderers/shared/texture/sources/ImageSource.mjs';\nimport { Texture } from '../../../../rendering/renderers/shared/texture/Texture.mjs';\nimport { uid } from '../../../../utils/data/uid.mjs';\n\"use strict\";\nconst _FillGradient = class _FillGradient {\n  constructor(x0, y0, x1, y1) {\n    this.uid = uid(\"fillGradient\");\n    this.type = \"linear\";\n    this.gradientStops = [];\n    this.x0 = x0;\n    this.y0 = y0;\n    this.x1 = x1;\n    this.y1 = y1;\n  }\n  addColorStop(offset, color) {\n    this.gradientStops.push({\n      offset,\n      color: Color.shared.setValue(color).toHex()\n    });\n    return this;\n  }\n  // TODO move to the system!\n  buildLinearGradient() {\n    const defaultSize = _FillGradient.defaultTextureSize;\n    const {\n      gradientStops\n    } = this;\n    const canvas = DOMAdapter.get().createCanvas();\n    canvas.width = defaultSize;\n    canvas.height = defaultSize;\n    const ctx = canvas.getContext(\"2d\");\n    const gradient = ctx.createLinearGradient(0, 0, _FillGradient.defaultTextureSize, 1);\n    for (let i = 0; i < gradientStops.length; i++) {\n      const stop = gradientStops[i];\n      gradient.addColorStop(stop.offset, stop.color);\n    }\n    ctx.fillStyle = gradient;\n    ctx.fillRect(0, 0, defaultSize, defaultSize);\n    this.texture = new Texture({\n      source: new ImageSource({\n        resource: canvas,\n        addressModeU: \"clamp-to-edge\",\n        addressModeV: \"repeat\"\n      })\n    });\n    const {\n      x0,\n      y0,\n      x1,\n      y1\n    } = this;\n    const m = new Matrix();\n    const dx = x1 - x0;\n    const dy = y1 - y0;\n    const dist = Math.sqrt(dx * dx + dy * dy);\n    const angle = Math.atan2(dy, dx);\n    m.translate(-x0, -y0);\n    m.scale(1 / defaultSize, 1 / defaultSize);\n    m.rotate(-angle);\n    m.scale(256 / dist, 1);\n    this.transform = m;\n  }\n};\n_FillGradient.defaultTextureSize = 256;\nlet FillGradient = _FillGradient;\nexport { FillGradient };","map":{"version":3,"names":["_FillGradient","constructor","x0","y0","x1","y1","uid","type","gradientStops","addColorStop","offset","color","push","Color","shared","setValue","toHex","buildLinearGradient","defaultSize","defaultTextureSize","canvas","DOMAdapter","get","createCanvas","width","height","ctx","getContext","gradient","createLinearGradient","i","length","stop","fillStyle","fillRect","texture","Texture","source","ImageSource","resource","addressModeU","addressModeV","m","Matrix","dx","dy","dist","Math","sqrt","angle","atan2","translate","scale","rotate","transform","FillGradient"],"sources":["/home/ryoitsu/node_modules/pixi.js/src/scene/graphics/shared/fill/FillGradient.ts"],"sourcesContent":["import { Color } from '../../../../color/Color';\nimport { DOMAdapter } from '../../../../environment/adapter';\nimport { Matrix } from '../../../../maths/matrix/Matrix';\nimport { ImageSource } from '../../../../rendering/renderers/shared/texture/sources/ImageSource';\nimport { Texture } from '../../../../rendering/renderers/shared/texture/Texture';\nimport { uid } from '../../../../utils/data/uid';\n\nimport type { ColorSource } from '../../../../color/Color';\n\nexport type GradientType = 'linear' | 'radial';\n\n// export type GradientSource =\n//     string // CSS gradient string: 'linear-gradient(...)'\n//     | IGradientOptions // Gradient options: { x0, y0, x1, y1, ...}\n//     | Gradient; // class Gradient itself\n\nexport interface LinearGradientFillStyle\n{\n    x0: number;\n    y0: number;\n    x1: number;\n    y1: number;\n    colors: number[];\n    stops: number[];\n}\n\nexport class FillGradient implements CanvasGradient\n{\n    public static defaultTextureSize = 256;\n\n    public readonly uid = uid('fillGradient');\n    public readonly type: GradientType = 'linear';\n\n    public x0: number;\n    public y0: number;\n    public x1: number;\n    public y1: number;\n\n    public texture: Texture;\n    public transform: Matrix;\n    public gradientStops: Array<{ offset: number, color: string }> = [];\n\n    constructor(x0: number, y0: number, x1: number, y1: number)\n    {\n        this.x0 = x0;\n        this.y0 = y0;\n\n        this.x1 = x1;\n        this.y1 = y1;\n    }\n\n    public addColorStop(offset: number, color: ColorSource): this\n    {\n        this.gradientStops.push({ offset, color: Color.shared.setValue(color).toHex() });\n\n        return this;\n    }\n\n    // TODO move to the system!\n    public buildLinearGradient(): void\n    {\n        const defaultSize = FillGradient.defaultTextureSize;\n\n        const { gradientStops } = this;\n\n        const canvas = DOMAdapter.get().createCanvas();\n\n        canvas.width = defaultSize;\n        canvas.height = defaultSize;\n\n        const ctx = canvas.getContext('2d');\n\n        const gradient = ctx.createLinearGradient(0, 0, FillGradient.defaultTextureSize, 1);\n\n        for (let i = 0; i < gradientStops.length; i++)\n        {\n            const stop = gradientStops[i];\n\n            gradient.addColorStop(stop.offset, stop.color);\n        }\n\n        ctx.fillStyle = gradient;\n        ctx.fillRect(0, 0, defaultSize, defaultSize);\n\n        this.texture = new Texture({\n            source: new ImageSource({\n                resource: canvas,\n                addressModeU: 'clamp-to-edge',\n                addressModeV: 'repeat',\n            }),\n        });\n\n        // generate some UVS based on the gradient direction sent\n\n        const { x0, y0, x1, y1 } = this;\n\n        const m = new Matrix();\n\n        // get angle\n        const dx = x1 - x0;\n        const dy = y1 - y0;\n\n        const dist = Math.sqrt((dx * dx) + (dy * dy));\n\n        const angle = Math.atan2(dy, dx);\n\n        m.translate(-x0, -y0);\n        m.scale(1 / defaultSize, 1 / defaultSize);\n        m.rotate(-angle);\n        m.scale(256 / dist, 1);\n\n        this.transform = m;\n    }\n}\n"],"mappings":";;;;;;;AA0BO,MAAMA,aAAA,GAAN,MAAMA,aACb;EAeIC,WAAYA,CAAAC,EAAA,EAAYC,EAAY,EAAAC,EAAA,EAAYC,EAChD;IAbgB,KAAAC,GAAA,GAAMA,GAAA,CAAI,cAAc;IACxC,KAAgBC,IAAqB;IASrC,KAAOC,aAAA,GAA0D,EAAC;IAI9D,KAAKN,EAAK,GAAAA,EAAA;IACV,KAAKC,EAAK,GAAAA,EAAA;IAEV,KAAKC,EAAK,GAAAA,EAAA;IACV,KAAKC,EAAK,GAAAA,EAAA;EAAA;EAGPI,aAAaC,MAAA,EAAgBC,KACpC;IACI,KAAKH,aAAc,CAAAI,IAAA,CAAK;MAAEF,MAAA;MAAQC,KAAO,EAAAE,KAAA,CAAMC,MAAO,CAAAC,QAAA,CAASJ,KAAK,EAAEK,KAAM;IAAA,CAAG;IAExE;EAAA;EACX;EAGOC,mBACPA,CAAA;IACI,MAAMC,WAAA,GAAclB,aAAa,CAAAmB,kBAAA;IAE3B;MAAEX;IAAA,CAAkB;IAE1B,MAAMY,MAAS,GAAAC,UAAA,CAAWC,GAAI,GAAEC,YAAa;IAE7CH,MAAA,CAAOI,KAAQ,GAAAN,WAAA;IACfE,MAAA,CAAOK,MAAS,GAAAP,WAAA;IAEV,MAAAQ,GAAA,GAAMN,MAAO,CAAAO,UAAA,CAAW,IAAI;IAElC,MAAMC,QAAA,GAAWF,GAAI,CAAAG,oBAAA,CAAqB,GAAG,CAAG,EAAA7B,aAAA,CAAamB,kBAAA,EAAoB,CAAC;IAElF,SAASW,CAAI,MAAGA,CAAI,GAAAtB,aAAA,CAAcuB,MAAA,EAAQD,CAC1C;MACU,MAAAE,IAAA,GAAOxB,aAAA,CAAcsB,CAAC;MAE5BF,QAAA,CAASnB,YAAa,CAAAuB,IAAA,CAAKtB,MAAQ,EAAAsB,IAAA,CAAKrB,KAAK;IAAA;IAGjDe,GAAA,CAAIO,SAAY,GAAAL,QAAA;IAChBF,GAAA,CAAIQ,QAAS,IAAG,CAAG,EAAAhB,WAAA,EAAaA,WAAW;IAEtC,KAAAiB,OAAA,GAAU,IAAIC,OAAQ;MACvBC,MAAA,EAAQ,IAAIC,WAAY;QACpBC,QAAU,EAAAnB,MAAA;QACVoB,YAAc;QACdC,YAAc;MAAA,CACjB;IAAA,CACJ;IAID,MAAM;MAAEvC,EAAA;MAAIC,EAAI;MAAAC,EAAA;MAAIC;IAAA,CAAO;IAErB,MAAAqC,CAAA,GAAI,IAAIC,MAAO;IAGrB,MAAMC,EAAA,GAAKxC,EAAK,GAAAF,EAAA;IAChB,MAAM2C,EAAA,GAAKxC,EAAK,GAAAF,EAAA;IAEhB,MAAM2C,IAAA,GAAOC,IAAK,CAAAC,IAAA,CAAMJ,EAAK,GAAAA,EAAA,GAAOC,EAAA,GAAKA,EAAG;IAE5C,MAAMI,KAAQ,GAAAF,IAAA,CAAKG,KAAM,CAAAL,EAAA,EAAID,EAAE;IAE/BF,CAAA,CAAES,SAAU,EAACjD,EAAI,GAACC,EAAE;IACpBuC,CAAA,CAAEU,KAAM,KAAIlC,WAAa,MAAIA,WAAW;IACtCwB,CAAA,CAAAW,MAAA,CAAO,CAACJ,KAAK;IACbP,CAAA,CAAAU,KAAA,CAAM,GAAM,GAAAN,IAAA,EAAM,CAAC;IAErB,KAAKQ,SAAY,GAAAZ,CAAA;EAAA;AAEzB;AAvFa1C,aAAA,CAEKmB,kBAAqB;AAFhC,IAAMoC,YAAN,GAAAvD,aAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}