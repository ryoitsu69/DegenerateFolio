"use strict";var G=Object.defineProperty;var ct=Object.getOwnPropertyDescriptor;var pt=Object.getOwnPropertyNames;var ut=Object.prototype.hasOwnProperty;var mt=(n,t,e)=>t in n?G(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var bt=(n,t)=>{for(var e in t)G(n,e,{get:t[e],enumerable:!0})},dt=(n,t,e,s)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of pt(t))!ut.call(n,o)&&o!==e&&G(n,o,{get:()=>t[o],enumerable:!(s=ct(t,o))||s.enumerable});return n};var gt=n=>dt(G({},"__esModule",{value:!0}),n);var ue=(n,t,e)=>(mt(n,typeof t!="symbol"?t+"":t,e),e);var Rt={};bt(Rt,{AccountId:()=>I.AccountId,Binary:()=>I.Binary,BlockPrunedError:()=>W,Enum:()=>I.Enum,NotBestBlockError:()=>V,_Enum:()=>I._Enum,createClient:()=>At,getObservableClient:()=>ye});module.exports=gt(Rt);var tt=require("@polkadot-api/substrate-client"),he=require("rxjs");var H=require("rxjs");var J=require("rxjs"),D=(0,J.share)({connector:()=>new J.ReplaySubject(1),resetOnError:!0,resetOnComplete:!0,resetOnRefCountZero:!0});var ke=require("rxjs");function Q(n,t){return new Promise((e,s)=>{let o=t?()=>{p.unsubscribe()}:ke.noop,a=!1,p=n.subscribe({next:u=>{e(u),a=!0,p?.unsubscribe()},error:u=>{s(u),t?.removeEventListener("abort",o)},complete:()=>{s(new Error("Observable completed without emitting")),t?.removeEventListener("abort",o)}});a?p.unsubscribe():t?.addEventListener("abort",o)})}var X=require("rxjs"),Y=(n,t=1/0)=>e=>new X.Observable(s=>{let o=new Map,a=new Map,p=new Map,u=0,g=0,m=0,i=()=>{let r=o.get(g);if(!r){b.closed&&a.size===0&&s.complete();return}let l=g++;o.delete(l),m!==l&&p.set(l,[]),a.set(l,r.subscribe({next(c){m===l?s.next(c):p.get(l).push(c)},complete(){if(a.delete(l),l===m)for(m++;p.has(m)&&(p.get(m).forEach(c=>s.next(c)),p.delete(m),!a.has(m));)m++;i()},error(c){s.error(c)}}))},b=e.subscribe({next(r){let l=u++;o.set(l,(0,X.defer)(()=>n(r,l))),a.size<t&&i()},error(r){s.error(r)},complete(){a.size===0&&s.complete()}});return()=>{a.forEach(r=>r.unsubscribe()),b.unsubscribe(),o.clear(),p.clear()}});var we=require("rxjs"),Oe=n=>new we.Observable(t=>n.subscribe({next(e){t.next(e)},error(e){t.error(e)}}));var N=require("rxjs"),ee=require("rxjs/operators"),Ae=()=>{let n=new N.BehaviorSubject(new N.Subject);return[n.pipe((0,ee.switchAll)()),()=>(0,ee.tap)({next:t=>n.value.next(t),error:t=>{n.value.error(t),n.next(new N.Subject)},complete:()=>{n.value.complete(),n.next(new N.Subject)}})]};var Re=require("rxjs"),Ce=n=>t=>new Re.Observable(e=>{let s=!1,o=t.subscribe({next(a){s=!0,e.next(a)},error(a){e.error(a)},complete(){e.complete()}});return s||e.next(n),o});var Ee=(n,t,e,s)=>{let o=m=>{let i=m.checksumBuilder.buildEvent(t,e);if(n!==i)throw new Error(`Incompatible runtime entry Event(${t}.${e})`)},a=s.finalized$.pipe(s.withRuntime(m=>m.hash),Y(([m,i])=>(o(i),s.eventsAt$(m.hash).pipe((0,H.map)(b=>b.filter(l=>l.event.type===t&&l.event.value.type===e).map(l=>({meta:{phase:l.phase,block:m},payload:l.event.value.value})))))),D);return{watch:m=>a.pipe((0,H.mergeMap)(i=>m?i.filter(b=>m(b.payload)):i)),pull:()=>(0,H.firstValueFrom)(a),filter:m=>m.filter(i=>i.type===t&&i.value.type===e).map(i=>i.value.value)}};var Ne=require("@polkadot-api/substrate-bindings"),He=require("@polkadot-api/substrate-client"),v=require("rxjs");var L=require("rxjs"),Se=n=>{let t,e=L.noop,s=new L.Observable(o=>{t=n(!0,a=>{o.next(a)},a=>{console.warn("chainHead crashed"),console.error(a),o.error(a)}),e=()=>{o.complete(),t.unfollow()}}).pipe((0,L.share)());return{getFollower:()=>{if(!t)throw new Error("Missing chainHead subscription");return t},unfollow:()=>{e()},follow$:s}};var _=require("@polkadot-api/metadata-builders"),S=require("@polkadot-api/substrate-bindings"),Be=require("@polkadot-api/utils"),te=require("rxjs"),yt=(0,S.Option)((0,S.Tuple)(S.compact,S.metadata)),ft=(0,Be.toHex)(S.u32.enc(15)),Pe=n=>t=>{let e=new Set([t]),s=n(t,"Metadata_metadata_at_version",ft).pipe((0,te.map)(a=>{let p=yt.dec(a)[1];if(p.metadata.tag!=="v15")throw new Error("Wrong metadata version");let u=p.metadata.value,g=(0,_.getChecksumBuilder)(u),m=(0,_.getDynamicBuilder)(u),i=m.buildStorage("System","Events"),b=p.metadata.value.extrinsic.signedExtensions.find(c=>c.identifier==="ChargeAssetTxPayment"),r=null;if(b){let c=(0,_.getLookupFn)(p.metadata.value.lookup)(b.type);if(c.type==="struct"){let y=c.value.asset_id;y.type==="option"&&(r=y.value.id)}}return{asset:r===null?[S._void.enc,null]:[m.buildDefinition(r).enc,g.buildDefinition(r)],metadata:u,checksumBuilder:g,dynamicBuilder:m,events:{key:i.enc(),dec:i.dec},accountId:(0,S.AccountId)(m.ss58Prefix)}}),(0,te.shareReplay)(1)),o={at:t,runtime:s,addBlock:a=>(e.add(a),o),deleteBlocks:a=>(a.forEach(p=>{e.delete(p)}),e.size),usages:e};return s.subscribe(),o};var T=require("rxjs");var $e=(n,t,e,s,o)=>{let a=Pe(e),p=n.pipe((0,T.concatMap)(r=>r.type!=="initialized"?(0,T.of)(r):t(r.finalizedBlockHashes.slice(-1)[0]).then(l=>({...r,number:l.number,parentHash:l.parentHash})))),[u,g]=Ae(),m=new T.Subject,i=(0,T.merge)(m,(0,T.interval)(100).pipe((0,T.withLatestFrom)((0,T.defer)(()=>b)),(0,T.map)(([,r])=>{let l=new Set,c=r.blocks.get(r.finalized);for(;r.blocks.has(c.parent);)c=r.blocks.get(c.parent),c.refCount||l.add(c.hash);return l}),(0,T.pairwise)(),(0,T.map)(([r,l])=>[...l].filter(c=>r.has(c))),(0,T.filter)(r=>r.length>0))).pipe(g(),(0,T.tap)(o),r=>new T.Observable(l=>{let c=null,y=setTimeout(()=>{c=r.subscribe({error(x){l.error(x)}}),c.add(n.subscribe({complete(){l.complete()}}))},0);return()=>{clearTimeout(y),c?.unsubscribe()}})),b=(0,T.merge)(s,p,u.pipe((0,T.map)(r=>({type:"unpin",hashes:r}))),i).pipe((0,T.scan)((r,l)=>{switch(l.type){case"initialized":let[c]=l.finalizedBlockHashes.slice(-1);return r.finalized=r.best=c,r.blocks.set(c,{hash:c,parent:l.parentHash,children:new Set,runtime:c,refCount:0,number:l.number}),r.runtimes[c]=a(c),r.finalizedRuntime=r.runtimes[c],r;case"newBlock":{let{parentBlockHash:y,blockHash:x}=l,h=r.blocks.get(y);h.children.add(x),l.newRuntime&&(r.runtimes[x]=a(x),r.runtimes[x].runtime.subscribe());let O={hash:x,number:h.number+1,parent:y,children:new Set,runtime:l.newRuntime?x:h.runtime,refCount:0};return r.blocks.set(x,O),r.runtimes[O.runtime].addBlock(x),r}case"bestBlockChanged":return r.best=l.bestBlockHash,r;case"finalized":return r.finalized=l.finalizedBlockHashes.slice(-1)[0],r.finalizedRuntime=r.runtimes[r.blocks.get(r.finalized).runtime],l.prunedBlockHashes.length>0&&m.next(l.prunedBlockHashes),r;case"blockUsage":return r.blocks.get(l.value.hash).refCount+=l.value.type==="hold"?1:-1,r;case"unpin":return l.hashes.forEach(y=>{r.blocks.has(y)&&(r.blocks.get(r.blocks.get(y).parent)?.children.delete(y),r.blocks.delete(y))}),Object.entries(r.runtimes).map(([y,x])=>({key:y,usages:x.deleteBlocks(l.hashes)})).filter(y=>y.usages===0).map(y=>y.key).forEach(y=>{delete r.runtimes[y]}),r}},{best:"",finalized:"",runtimes:{},blocks:new Map,finalizedRuntime:{}}),(0,T.map)(r=>({...r})),D);return b};var De=require("@polkadot-api/substrate-client"),Fe=require("rxjs");var re=class{constructor(){ue(this,"first");ue(this,"last")}getRemoveFn(t){return()=>{t.prev?t.prev.next=t.next:this.first=t.next,t.next?t.next.prev=t.prev:this.last=t.prev,delete t.prev,delete t.next}}push(t){let e={value:t};return this.last===void 0?this.last=this.first=e:(this.last.next=e,e.prev=this.last,this.last=e),this.getRemoveFn(e)}unshift(t){return this.first={value:t,next:this.first},this.first.next&&(this.first.next.prev=this.first),this.last||(this.last=this.first),this.getRemoveFn(this.first)}pop(){let t=this.first?.value;return this.first&&(this.first=this.first.next,this.first?(delete this.first.prev?.next,delete this.first.prev):this.last=void 0),t}isEmpty(){return!this.first}},me=()=>{let n=new Map,t=(r,l)=>{n.set(r,()=>{n.delete(r),l()})},e=r=>{n.get(r)?.()},s=new re,o=s.unshift.bind(s),a=s.push.bind(s),p=(r,l)=>{let c=l?o:a;t(r.source$,c(r))},u=()=>{let r=s.pop();r&&(n.delete(r.source$),g(r))},g=r=>{let{source$:l,observer:c}=r,y=l.subscribe({next(x){c.next(x)},error(x){if(e(l),x instanceof De.OperationLimitError)return p(r,!0);c.error(x),u()},complete(){c.complete(),u()}});c.closed||t(l,()=>{y.unsubscribe()})},m=(r=!1)=>l=>new Fe.Observable(c=>{let y={observer:c,source$:l};return s.isEmpty()?g(y):p(y,r),()=>{e(l)}}),i=m();return{withRecovery:m,withRecoveryFn:r=>(...l)=>i(r(...l))}};var C=require("rxjs"),ze=Symbol("DONE"),ht=n=>new C.Observable(t=>{let e=n.subscribe(t);return()=>{setTimeout(()=>{e.unsubscribe()},0)}}),be=n=>{let t=n.pipe((0,C.take)(1),Oe,(0,C.share)({connector:()=>new C.ReplaySubject(1),resetOnError:!0,resetOnRefCountZero:!0,resetOnComplete:!1}),ht);return e=>(s,...o)=>s?e(s,...o):t.pipe((0,C.mergeMap)(a=>(0,C.concat)(e(a,...o),(0,C.of)(ze))),(0,C.takeWhile)(a=>a!==ze))};var Ie=require("rxjs"),ne=n=>(...t)=>new Ie.Observable(e=>{let s=new AbortController;return n(...t,s.signal).then(o=>{e.next(o),e.complete()},o=>{e.error(o)}),()=>{e.unsubscribe(),s.abort(),s=void 0}});var de=n=>t=>(...e)=>n()[t](...e);var P=require("rxjs");var E=require("rxjs"),Me=n=>t=>t.pipe((0,E.takeWhile)(e=>e.blocks.has(n)),(0,E.distinctUntilChanged)((e,s)=>e.finalized===s.finalized),(0,E.filter)(e=>e.blocks.get(e.finalized).number>=e.blocks.get(n).number),(0,E.take)(1),(0,E.map)(e=>{let{number:s}=e.blocks.get(n),o=e.blocks.get(e.finalized);for(;o.number>s;)o=e.blocks.get(o.parent);return o.hash===n})),se=n=>t=>t.pipe((0,E.takeWhile)(e=>e.blocks.has(n)),(0,E.distinctUntilChanged)((e,s)=>e.best===s.best),(0,E.filter)(e=>e.blocks.get(e.best).number>=e.blocks.get(n).number),(0,E.map)(e=>{let{number:s}=e.blocks.get(n),o=e.blocks.get(e.best),a=e.finalized===o.hash;for(;o.number>s;)o=e.blocks.get(o.parent),a=a||e.finalized===o.hash;return{isBest:o.hash===n,isFinalized:a}}),(0,E.takeWhile)(({isFinalized:e})=>!e,!0),(0,E.map)(({isBest:e})=>e));var W=class extends Error{constructor(){super("Block pruned"),this.name="BlockPrunedError"}},V=class extends Error{constructor(){super("Block is not best block or finalized"),this.name="NotBestBlockError"}};function ge(n,t,e){return(s,...o)=>e(s,...o).pipe(xt(s,t.pipe((0,P.filter)(a=>a.type==="finalized"),(0,P.mergeMap)(a=>a.prunedBlockHashes))),vt(s,n))}var vt=(n,t)=>e=>t.pipe(se(n),(0,P.take)(1),(0,P.switchMap)(s=>s?e:(0,P.throwError)(()=>new V))),xt=(n,t)=>e=>new P.Observable(s=>{let o=t.pipe((0,P.filter)(p=>p===n)).subscribe(()=>{s.error(new W)}),a=e.subscribe(s);return()=>{o.unsubscribe(),a.unsubscribe()}});var We=require("@polkadot-api/substrate-client"),F=require("rxjs"),Tt=n=>{let t=n.pipe((0,F.catchError)(e=>e instanceof We.OperationInaccessibleError?(0,F.timer)(750).pipe((0,F.concatMap)(()=>t)):(0,F.throwError)(()=>e)));return t},oe=n=>(...t)=>Tt(n(...t));var ie=require("rxjs"),Ve=(n,t)=>{let e=(s,o,a,p)=>new ie.Observable(u=>n().storageSubscription(s,o,a??null,g=>{u.next(g)},g=>{u.error(g)},()=>{u.complete()},g=>{g!==0&&u.next(e(s,o.slice(-g),a,!0))})).pipe((0,ie.mergeAll)(),t(p));return e};var k=require("rxjs");var Ue=(n,t)=>e=>n.pipe((0,k.take)(1),(0,k.concatMap)(s=>{let o=new Set(s.blocks.keys()),a=u=>o.has(u)?(0,k.of)(-1):t(u).pipe((0,k.takeUntil)(n.pipe((0,k.filter)(({blocks:g})=>!g.has(u)))),(0,k.map)(g=>g.indexOf(e))),p=u=>a(u).pipe((0,k.concatMap)(g=>g>-1?(0,k.of)({hash:u,idx:g}):n.pipe((0,k.takeWhile)(m=>m.blocks.has(u)),(0,k.mergeMap)(m=>m.blocks.get(u).children),(0,k.distinct)(),(0,k.mergeMap)(p))));return p(s.finalized).pipe((0,k.mergeMap)(({hash:u,idx:g})=>(0,k.concat)(n.pipe(se(u),(0,k.filter)(Boolean),(0,k.take)(1),(0,k.map)(()=>({type:"bestChainBlockIncluded",block:{hash:u,index:g}}))),n.pipe(Me(u),(0,k.filter)(Boolean),(0,k.map)(()=>({type:"finalized",block:{hash:u,index:g}}))))))}),(0,k.takeWhile)(s=>s.type!=="finalized",!0));var Ke=({hash:n,number:t,parent:e})=>({hash:n,number:t,parent:e}),Le=n=>{let{getFollower:t,unfollow:e,follow$:s}=Se(n),o=de(t),{withRecovery:a,withRecoveryFn:p}=me(),u=new v.Subject,g=d=>(f,...R)=>new v.Observable(B=>{u.next({type:"blockUsage",value:{type:"hold",hash:f}});let $=d(f,...R).subscribe(B);return()=>{u.next({type:"blockUsage",value:{type:"release",hash:f}}),$.unsubscribe()}}),m=d=>t().header(d).then(Ne.blockHeader.dec),i=d=>t().unpin(d).catch(f=>{if(!(f instanceof He.DisjointError))throw f}),b=d=>g(ge(c,s,oe(p(ne(d))))),r=oe(p(ne(o("call")))),l=new Map,c=$e(s,m,r,u,d=>{i(d),d.forEach(f=>{l.delete(f)})}),y=d=>c.pipe((0,v.take)(1),(0,v.mergeMap)(f=>f.runtimes[f.blocks.get(d).runtime].runtime)),x=d=>f=>f.pipe(Y(R=>y(d(R)).pipe((0,v.map)(B=>[R,B])))),h=(d,f,R)=>{let B=l.get(d)?.get(f);if(B)return B;l.has(d)||l.set(d,new Map);let $=R.pipe((0,v.share)({connector:()=>new v.ReplaySubject,resetOnError:!0,resetOnRefCountZero:!0,resetOnComplete:!1}));return l.get(d).set(f,$),$},O=c.pipe((0,v.distinctUntilChanged)((d,f)=>d.finalized===f.finalized),(0,v.map)(d=>Ke(d.blocks.get(d.finalized))),D),A=c.pipe((0,v.distinctUntilChanged)((d,f)=>d.finalized===f.finalized&&d.best===f.best),(0,v.scan)((d,f)=>{let R=f.best,B=new Map;for(;R!==f.finalized;){let $=d.get(R)||Ke(f.blocks.get(R));B.set(R,$),R=$.parent}return B},new Map),(0,v.map)(d=>[...d.values()]),D),U=c.pipe((0,v.distinctUntilChanged)((d,f)=>d.finalizedRuntime===f.finalizedRuntime),(0,v.switchMap)(({finalizedRuntime:{runtime:d}})=>d.pipe(Ce(null))),D),K=U.pipe((0,v.map)(d=>d?.metadata??null)),M=be(O.pipe((0,v.map)(d=>d.hash))),ce=b(o("body")),ve=d=>h(d,"body",ce(d)),rt=Ue(c,ve),nt=b(o("storage")),xe=M((d,f,R,B=null,$)=>c.pipe((0,v.take)(1),(0,v.mergeMap)(q=>q.runtimes[q.blocks.get(d).runtime].runtime),(0,v.mergeMap)(q=>{let pe=R(q),Te=h(d,`storage-${f}-${pe}-${B??""}`,nt(d,f,pe,B));return $?h(d,`storage-${f}-${pe}-${B??""}-dec`,Te.pipe((0,v.map)(lt=>$(lt,q)))):Te}))),st=Ve(t,a),ot=oe(M(g((d,f,R)=>st(d,f,R??null,!1)))),it=M(g(d=>(0,v.from)(m(d))));(0,v.merge)(U,A).subscribe();let at=d=>xe(d,"value",f=>f.events.key,null,(f,R)=>R.events.dec(f));return{follow$:s,finalized$:O,bestBlocks$:A,runtime$:U,metadata$:K,header$:it,body$:ve,call$:M(g(r)),storage$:xe,storageQueries$:ot,eventsAt$:at,trackTx$:rt,withRuntime:x,getRuntimeContext$:M(y),unfollow:e}};var _e=require("rxjs"),kt=new Set(["error","finalized","invalid","dropped"]),je=n=>t=>new _e.Observable(e=>n(t,s=>{if(s.type==="error")return e.error(new Error(s.error));e.next(s),kt.has(s.type)&&e.complete()},s=>{e.error(s)}));var ye=({chainHead:n,transaction:t,destroy:e})=>({chainHead$:()=>Le(n),tx$:je(t),destroy:e});var ae=require("rxjs"),fe=require("@polkadot-api/utils"),qe=(n,t)=>{let e=(0,fe.mapObject)(n.pallets,(p,u)=>{let g=t.metadata.pallets.find(i=>i.name===u),m={};return g?.constants.forEach(i=>{m[i.name]={cache:!1,value:i.value}}),new Proxy({},{get(i,b){let r=m[b];return r.cache?r.value:(r.cache=!0,r.value=t.dynamicBuilder.buildConstant(u,b).dec(r.value))}})}),s=(p,u)=>(0,fe.mapObject)(n.pallets,(g,m)=>new Proxy({},{get(i,b){return t.checksumBuilder[u](m,b)===g[p][b]}})),o={query:s(0,"buildStorage"),tx:s(1,"buildCall"),event:s(2,"buildEvent"),const:s(4,"buildConstant")};return{constants:e,isCompatible:p=>p(o)}},Qe=(n,t)=>{let e,s=null;e=new Promise(a=>{s=a}),t.runtime$.subscribe(a=>{a?(s(qe(n,a)),s=null):s||(e=new Promise(p=>{s=p}))});let o=t.runtime$.pipe((0,ae.filter)(Boolean),(0,ae.map)(a=>qe(n,a)));return o.latest=()=>e,o};var le=require("rxjs");var Ze=require("@polkadot-api/utils"),wt=n=>typeof n!="object"?!1:Object.keys(n).every(t=>t==="at"&&typeof n.at=="string"||t==="signal"&&n.signal instanceof AbortSignal),Ge=(n,t,e,s)=>{let o=`${t}_${e}`,a=p=>{let u=p.checksumBuilder.buildRuntimeCall(t,e);if(n!==u)throw new Error(`Incompatible runtime entry RuntimeCall(${o})`)};return(...p)=>{let u=p[p.length-1],g=wt(u),{signal:m,at:i}=g?u:{},b=i??null,r=s.getRuntimeContext$(b).pipe((0,le.mergeMap)(l=>{a(l);let c=l.dynamicBuilder.buildRuntimeCall(t,e);return s.call$(b,o,(0,Ze.toHex)(c.args.enc(p))).pipe((0,le.map)(c.value.dec))}));return Q(r,m)}};var z=require("rxjs");var Je=n=>typeof n!="object"?!1:Object.keys(n).every(t=>t==="at"&&typeof n.at=="string"||t==="signal"&&n.signal instanceof AbortSignal),Xe=(n,t,e,s)=>{let o=i=>{let b=i.checksumBuilder.buildStorage(t,e);if(n!==b)throw new Error(`Incompatible runtime entry Storage(${t}.${e})`)},a=i=>new Error(`Invalid Arguments calling ${t}.${e}(${i})`),p=(...i)=>s.finalized$.pipe((0,z.debounceTime)(0),s.withRuntime(b=>b.hash),(0,z.exhaustMap)(([b,r])=>{o(r);let l=r.dynamicBuilder.buildStorage(t,e);return s.storage$(b.hash,"value",()=>l.enc(...i)).pipe((0,z.distinctUntilChanged)(),(0,z.map)(c=>c===null?l.fallback:l.dec(c)))})),u=(...i)=>{let b=i[i.length-1],r=Je(b),{signal:l,at:c}=r?b:{},y=c??null,x=s.storage$(y,"value",h=>{let O=h.dynamicBuilder.buildStorage(t,e),A=i.length===O.len?i:i.slice(0,-1);if(i!==A&&!r)throw a(i);return o(h),O.enc(...A)},null,(h,O)=>{let A=O.dynamicBuilder.buildStorage(t,e);return h===null?A.fallback:A.dec(h)});return Q(x,l)};return{getValue:u,getValues:(i,b)=>Promise.all(i.map(r=>u(...b?[...r,b]:r))),getEntries:(...i)=>{let b=i[i.length-1],r=Je(b),{signal:l,at:c}=r?b:{},y=c??null,x=s.storage$(y,"descendantsValues",h=>{let O=h.dynamicBuilder.buildStorage(t,e);if(i.length>O.len)throw a(i);let A=i.length>0&&r?i.slice(0,-1):i;if(i.length===O.len&&A===i)throw a(i);return o(h),O.enc(...A)},null,(h,O)=>{let A=O.dynamicBuilder.buildStorage(t,e);return h.map(({key:U,value:K})=>({keyArgs:A.keyDecoder(U),value:A.dec(K)}))});return Q(x,l)},watchValue:p}};var Z=require("@polkadot-api/substrate-bindings"),w=require("rxjs"),j=require("@polkadot-api/utils"),Ye=(n,t)=>{let e=n.filter(a=>a.phase.type==="ApplyExtrinsic"&&a.phase.value===t).map(a=>a.event),s=e[e.length-1];return{ok:s.type==="System"&&s.value.type==="ExtrinsicSuccess",events:e}},et=(n,t,e,s,o,a,p)=>u=>{let g=c=>(0,w.concat)(a.tx$(c).pipe((0,w.takeWhile)(y=>y.type!=="broadcasted",!0)),o.trackTx$(c)),m=(c,y={})=>o.getRuntimeContext$(null).pipe((0,w.map)(({checksumBuilder:x,dynamicBuilder:h,asset:[O,A]})=>{if(x.buildCall(t,e)!==n)throw new Error(`Incompatible runtime entry Tx(${t}.${e})`);let K=y;if(y.asset){if(s!==A)throw new Error("Incompatible runtime asset");K={...y,asset:O(y.asset)}}let{location:M,args:ce}=h.buildCall(t,e);return{callData:Z.Binary.fromBytes((0,j.mergeUint8)(new Uint8Array(M),ce.enc(c))),hinted:K}})),i=()=>(0,w.firstValueFrom)(m(u).pipe((0,w.map)(c=>c.callData))),b=(c,y)=>(0,w.firstValueFrom)(m(u,y).pipe((0,w.mergeMap)(({callData:x,hinted:h})=>p(c,x.asBytes(),h)),(0,w.map)(j.toHex))),r=async(c,y)=>{let x=await(0,w.firstValueFrom)(m(u,y).pipe((0,w.mergeMap)(({callData:O,hinted:A})=>p(c,O.asBytes(),A).then(j.toHex)))),h=await(0,w.lastValueFrom)(g(x));switch(h.type){case"invalid":throw new Error("Invalid");case"dropped":throw new Error("Dropped");case"finalized":{let O=await(0,w.firstValueFrom)(o.eventsAt$(h.block.hash));return Ye(O,Number(h.block.index))}default:return{ok:!0,events:[]}}},l=(c,y)=>m(u,y).pipe((0,w.mergeMap)(({callData:x,hinted:h})=>p(c,x.asBytes(),h)),(0,w.take)(1),(0,w.mergeMap)(x=>g((0,j.toHex)(x)).pipe((0,w.mergeMap)(h=>{switch(h.type){case"invalid":throw new Error("Invalid");case"dropped":throw new Error("Dropped");case"finalized":return o.eventsAt$(h.block.hash).pipe((0,w.map)(O=>({...h,...Ye(O,Number(h.block.index))})));default:return(0,w.of)(h)}}))));return{callData:(0,Z.Enum)(t,(0,Z.Enum)(e,u)),getEncodedData:i,getTx:b,submit:r,submit$:l}};var Ot=(n,t,e,s)=>{let{pallets:o,apis:a}=n,p={};for(let i in o){p[i]||(p[i]={});let[b]=o[i];for(let r in b)p[i][r]=Xe(b[r],i,r,e)}let u={};for(let i in o){u[i]||(u[i]={});let[,b]=o[i];for(let r in b)u[i][r]=et(b[r],i,r,n.asset,e,s,t)}let g={};for(let i in o){g[i]||(g[i]={});let[,,b]=o[i];for(let r in b)g[i][r]=Ee(b[r],i,r,e)}let m={};for(let i in a){m[i]||(m[i]={});let b=a[i];for(let r in b)m[i][r]=Ge(b[r],i,r,e)}return{query:p,tx:u,event:g,apis:m,runtime:Qe(n,e)}},At=n=>{let t,e=(0,tt.createClient)(p=>{let u=n(p);return t=u.createTx,u}),s=ye(e),o=s.chainHead$(),a=async(p,u,g)=>{let m;if(p instanceof Uint8Array)m=p;else{let{accountId:i}=await(0,he.firstValueFrom)(o.getRuntimeContext$(null));m=i.enc(p)}return t(m,u,g)};return{finalized$:o.finalized$,bestBlocks$:o.bestBlocks$,getBlockHeader:p=>(0,he.firstValueFrom)(o.header$(p??null)),getBlockBody:o.body$,destroy:()=>{o.unfollow(),s.destroy()},getTypedApi:p=>Ot(p,a,o,s)}};var I=require("@polkadot-api/substrate-bindings");
//# sourceMappingURL=index.js.map